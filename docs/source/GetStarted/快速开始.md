# å¿«é€Ÿå¼€å§‹

ms-swiftæ˜¯é­”æ­ç¤¾åŒºæä¾›çš„å¤§æ¨¡å‹ä¸å¤šæ¨¡æ€å¤§æ¨¡å‹è®­ç»ƒéƒ¨ç½²æ¡†æ¶ï¼Œç°å·²æ”¯æŒ400+å¤§æ¨¡å‹ä¸150+å¤šæ¨¡æ€å¤§æ¨¡å‹çš„è®­ç»ƒï¼ˆé¢„è®­ç»ƒã€å¾®è°ƒã€äººç±»å¯¹é½ï¼‰ã€æ¨ç†ã€è¯„æµ‹ã€é‡åŒ–ä¸éƒ¨ç½²ã€‚æ¨¡å‹å¼€å‘è€…å¯ä»¥åœ¨ms-swiftæ¡†æ¶ä¸­ä¸€ç«™å¼å®Œæˆå›´ç»•å¤§æ¨¡å‹çš„å„ç±»éœ€æ±‚ã€‚ç›®å‰ms-swiftçš„ä¸»è¦èƒ½åŠ›åŒ…å«ï¼š

- ğŸ æ¨¡å‹ç±»å‹ï¼šæ”¯æŒ400+çº¯æ–‡æœ¬å¤§æ¨¡å‹ã€150+å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼ŒAll-to-Allå…¨æ¨¡æ€æ¨¡å‹çš„è®­ç»ƒåˆ°éƒ¨ç½²å…¨æµç¨‹ã€‚
- æ•°æ®é›†ç±»å‹ï¼šå†…ç½®150+é¢„è®­ç»ƒã€å¾®è°ƒã€äººç±»å¯¹é½ã€å¤šæ¨¡æ€ç­‰å„ç§ç±»å‹çš„æ•°æ®é›†ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰æ•°æ®é›†ã€‚
- ç¡¬ä»¶æ”¯æŒï¼šCPUã€RTXç³»åˆ—ã€T4/V100ã€A10/A100/H100ã€Ascend NPUç­‰ã€‚
- ğŸŠ è½»é‡è®­ç»ƒï¼šæ”¯æŒäº†LoRAã€QLoRAã€DoRAã€LoRA+ã€ReFTã€RS-LoRAã€LLaMAProã€Adapterã€GaLoreã€Q-Galoreã€LISAã€UnSlothã€Liger-Kernelç­‰è½»é‡å¾®è°ƒæ–¹å¼ã€‚
- åˆ†å¸ƒå¼è®­ç»ƒï¼šæ”¯æŒåˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œï¼ˆDDPï¼‰ã€device_mapç®€æ˜“æ¨¡å‹å¹¶è¡Œã€DeepSpeed ZeRO2 ZeRO3ã€FSDPç­‰åˆ†å¸ƒå¼è®­ç»ƒæŠ€æœ¯ã€‚
- é‡åŒ–è®­ç»ƒï¼šæ”¯æŒå¯¹BNBã€AWQã€GPTQã€AQLMã€HQQã€EETQé‡åŒ–æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚
- RLHFè®­ç»ƒï¼šæ”¯æŒçº¯æ–‡æœ¬å¤§æ¨¡å‹å’Œå¤šæ¨¡æ€å¤§æ¨¡å‹çš„DPOã€CPOã€SimPOã€ORPOã€KTOã€RMã€PPOç­‰äººç±»å¯¹é½è®­ç»ƒæ–¹æ³•ã€‚
- ğŸ“ å¤šæ¨¡æ€è®­ç»ƒï¼šæ”¯æŒå¯¹å›¾åƒã€è§†é¢‘å’Œè¯­éŸ³ä¸åŒæ¨¡æ€æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œæ”¯æŒVQAã€Captionã€OCRã€Groundingä»»åŠ¡çš„è®­ç»ƒã€‚
- ç•Œé¢è®­ç»ƒï¼šä»¥ç•Œé¢çš„æ–¹å¼æä¾›è®­ç»ƒã€æ¨ç†ã€è¯„æµ‹ã€é‡åŒ–çš„èƒ½åŠ›ï¼Œå®Œæˆå¤§æ¨¡å‹çš„å…¨é“¾è·¯ã€‚
- æ’ä»¶åŒ–ä¸æ‹“å±•ï¼šæ”¯æŒè‡ªå®šä¹‰æ¨¡å‹å’Œæ•°æ®é›†æ‹“å±•ï¼Œæ”¯æŒå¯¹lossã€metricã€trainerã€loss-scaleã€callbackã€optimizerç­‰ç»„ä»¶è¿›è¡Œè‡ªå®šä¹‰ã€‚
- ğŸ‰ å·¥å…·ç®±èƒ½åŠ›ï¼šé™¤äº†å¯¹å¤§æ¨¡å‹å’Œå¤šæ¨¡æ€å¤§æ¨¡å‹çš„è®­ç»ƒæ”¯æŒå¤–ï¼Œè¿˜æ”¯æŒå…¶æ¨ç†ã€è¯„æµ‹ã€é‡åŒ–å’Œéƒ¨ç½²å…¨æµç¨‹ã€‚
- æ¨ç†åŠ é€Ÿï¼šæ”¯æŒPyTorchã€vLLMã€LmDeployæ¨ç†åŠ é€Ÿå¼•æ“ï¼Œå¹¶æä¾›OpenAIæ¥å£ï¼Œä¸ºæ¨ç†ã€éƒ¨ç½²å’Œè¯„æµ‹æ¨¡å—æä¾›åŠ é€Ÿã€‚
- æ¨¡å‹è¯„æµ‹ï¼šä»¥EvalScopeä½œä¸ºè¯„æµ‹åç«¯ï¼Œæ”¯æŒ100+è¯„æµ‹æ•°æ®é›†å¯¹çº¯æ–‡æœ¬å’Œå¤šæ¨¡æ€æ¨¡å‹è¿›è¡Œè¯„æµ‹ã€‚
- æ¨¡å‹é‡åŒ–ï¼šæ”¯æŒAWQã€GPTQå’ŒBNBçš„é‡åŒ–å¯¼å‡ºï¼Œå¯¼å‡ºçš„æ¨¡å‹æ”¯æŒä½¿ç”¨vLLM/LmDeployæ¨ç†åŠ é€Ÿï¼Œå¹¶æ”¯æŒç»§ç»­è®­ç»ƒã€‚


## å®‰è£…

ms-swiftçš„å®‰è£…è¯·å‚è€ƒ[å®‰è£…æ–‡æ¡£](./SWIFTå®‰è£….md)ã€‚

## ä½¿ç”¨æ ·ä¾‹

10åˆ†é’Ÿåœ¨å•å¡3090ä¸Šå¯¹Qwen2.5-7B-Instructè¿›è¡Œè‡ªæˆ‘è®¤çŸ¥å¾®è°ƒï¼š
```shell
# 22GB
CUDA_VISIBLE_DEVICES=0 \
swift sft \
    --model Qwen/Qwen2.5-7B-Instruct \
    --train_type lora \
    --dataset 'AI-ModelScope/alpaca-gpt4-data-zh#500' \
              'AI-ModelScope/alpaca-gpt4-data-en#500' \
              'swift/self-cognition#500' \
    --torch_dtype bfloat16 \
    --num_train_epochs 1 \
    --per_device_train_batch_size 1 \
    --per_device_eval_batch_size 1 \
    --learning_rate 1e-4 \
    --lora_rank 8 \
    --lora_alpha 32 \
    --target_modules all-linear \
    --gradient_accumulation_steps 16 \
    --eval_steps 50 \
    --save_steps 50 \
    --save_total_limit 5 \
    --logging_steps 5 \
    --max_length 2048 \
    --output_dir output \
    --system 'You are a helpful assistant.' \
    --warmup_ratio 0.05 \
    --dataloader_num_workers 4 \
    --model_author swift \
    --model_name swift-robot
```

è®­ç»ƒå®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¹è®­ç»ƒåçš„æƒé‡è¿›è¡Œæ¨ç†ï¼Œè¿™é‡Œçš„`--adapters`æ›¿æ¢æˆè®­ç»ƒç”Ÿæˆçš„last checkpointæ–‡ä»¶å¤¹. ç”±äºadaptersæ–‡ä»¶å¤¹ä¸­åŒ…å«äº†è®­ç»ƒçš„å‚æ•°æ–‡ä»¶ï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–æŒ‡å®š`--model`, `--system`.

```shell
# ä½¿ç”¨äº¤äº’å¼å‘½ä»¤è¡Œè¿›è¡Œæ¨ç†
CUDA_VISIBLE_DEVICES=0 \
swift infer \
    --adapters output/vx-xxx/checkpoint-xxx \
    --stream true \
    --temperature 0 \
    --max_new_tokens 2048

# merge-loraå¹¶ä½¿ç”¨vLLMè¿›è¡Œæ¨ç†åŠ é€Ÿ
CUDA_VISIBLE_DEVICES=0 \
swift infer \
    --adapters output/vx-xxx/checkpoint-xxx \
    --stream true \
    --merge_lora true \
    --infer_backend vllm \
    --max_model_len 8192 \
    --temperature 0 \
    --max_new_tokens 2048
```

> [!TIP]
> æ›´å¤šä¾‹å­å¯ä»¥æŸ¥çœ‹ï¼š[examples](https://github.com/modelscope/ms-swift/tree/main/examples)
>
> ä»¥pythonæ–¹å¼è¿›è¡Œè®­ç»ƒå’Œæ¨ç†çš„ä¾‹å­å¯ä»¥æŸ¥çœ‹ï¼š[notebook](https://github.com/modelscope/ms-swift/tree/main/examples/notebook)
