# å‘½ä»¤è¡Œå‚æ•°

## ç›®å½•

- [sft å‚æ•°](#sft-å‚æ•°)
- [pt å‚æ•°](#pt-å‚æ•°)
- [rlhf å‚æ•°](#rlhf-å‚æ•°)
- [infer merge-lora å‚æ•°](#infer-merge-lora-å‚æ•°)
- [export å‚æ•°](#export-å‚æ•°)
- [evalå‚æ•°](#evalå‚æ•°)
- [app-ui å‚æ•°](#app-ui-å‚æ•°)
- [deploy å‚æ•°](#deploy-å‚æ•°)

## sft å‚æ•°

- `--ğŸ”¥model_type`: è¡¨ç¤ºä½ é€‰æ‹©çš„æ¨¡å‹ç±»å‹, é»˜è®¤æ˜¯`None`. `model_type`æŒ‡å®šäº†å¯¹åº”æ¨¡å‹é»˜è®¤çš„`target_modules`, `template_type`ç­‰ä¿¡æ¯. ä½ å¯ä»¥é€šè¿‡åªæŒ‡å®š`model_type`è¿›è¡Œå¾®è°ƒ. å¯¹åº”çš„`model_id_or_path`ä¼šä½¿ç”¨é»˜è®¤çš„è®¾ç½®, ä»ModelScopeè¿›è¡Œä¸‹è½½, å¹¶ä½¿ç”¨é»˜è®¤çš„ç¼“å­˜è·¯å¾„. model_typeå’Œmodel_id_or_pathå¿…é¡»æŒ‡å®šå…¶ä¸­çš„ä¸€ä¸ª. å¯ä»¥é€‰æ‹©çš„`model_type`å¯ä»¥æŸ¥çœ‹[æ”¯æŒçš„æ¨¡å‹](æ”¯æŒçš„æ¨¡å‹å’Œæ•°æ®é›†.md#æ¨¡å‹). ä½ å¯ä»¥è®¾ç½®`USE_HF`ç¯å¢ƒå˜é‡æ¥æ§åˆ¶ä»HF Hubä¸‹è½½æ¨¡å‹å’Œæ•°æ®é›†, å‚è€ƒ[HuggingFaceç”Ÿæ€å…¼å®¹æ–‡æ¡£](../LLM/HuggingFaceç”Ÿæ€å…¼å®¹.md).
- `--ğŸ”¥model_id_or_path`: è¡¨ç¤ºæ¨¡å‹åœ¨ModelScope/HuggingFace Hubä¸­çš„`model_id`æˆ–è€…æœ¬åœ°è·¯å¾„, é»˜è®¤ä¸º`None`. å¦‚æœä¼ å…¥çš„`model_id_or_path`å·²ç»è¢«æ³¨å†Œ, åˆ™ä¼šæ ¹æ®`model_id_or_path`æ¨æ–­å‡º`model_type`. å¦‚æœæœªè¢«æ³¨å†Œ, åˆ™éœ€è¦åŒæ—¶æŒ‡å®š`model_type`, e.g. `--model_type <model_type> --model_id_or_path <model_id_or_path>`.
- `--model_revision`: è¡¨ç¤ºæ¨¡å‹åœ¨ModelScope Hubä¸­å¯¹åº”`model_id`çš„ç‰ˆæœ¬å·, é»˜è®¤ä¸º`None`. `model_revision`æŒ‡å®šä¸º`None`, åˆ™ä½¿ç”¨æ³¨å†Œåœ¨`MODEL_MAPPING`ä¸­çš„revision. å¦åˆ™å¼ºåˆ¶ä½¿ç”¨å‘½ä»¤è¡Œä¼ å…¥çš„`model_revision`.
- `--local_repo_path`: éƒ¨åˆ†æ¨¡å‹åœ¨åŠ è½½æ—¶ä¾èµ–äºgithub repo. ä¸ºäº†é¿å…`git clone`æ—¶é‡åˆ°ç½‘ç»œé—®é¢˜, å¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°repo. è¯¥å‚æ•°éœ€è¦ä¼ å…¥æœ¬åœ°repoçš„è·¯å¾„, é»˜è®¤ä¸º`None`. è¿™éƒ¨åˆ†æ¨¡å‹åŒ…æ‹¬:
  - mPLUG-Owlæ¨¡å‹: `https://github.com/X-PLUG/mPLUG-Owl`
  - DeepSeek-VLæ¨¡å‹: `https://github.com/deepseek-ai/DeepSeek-VL`
  - YI-VLæ¨¡å‹: `https://github.com/01-ai/Yi`
  - LLAVAæ¨¡å‹: `https://github.com/haotian-liu/LLaVA.git`
- `--ğŸ”¥sft_type`: è¡¨ç¤ºå¾®è°ƒçš„æ–¹å¼, é»˜è®¤æ˜¯`'lora'`. ä½ å¯ä»¥é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'lora', 'full', 'longlora', 'adalora', 'ia3', 'llamapro', 'adapter', 'vera', 'boft', 'fourierft', 'reft'. å¦‚æœä½ è¦ä½¿ç”¨qlora, ä½ éœ€è®¾ç½®`--sft_type lora --quantization_bit 4`.
- `--packing`: packæ•°æ®é›†åˆ°`max-length`, é»˜è®¤å€¼`False`.
- `--full_determinism`: å›ºå®šæ‰€æœ‰çš„éšæœºæ€§, é»˜è®¤å€¼`False`.
- `--auto_find_batch_size`: æ ¹æ®æ˜¾å­˜å€¼è‡ªå®šæ‰¾åˆ°batch_size, é»˜è®¤å€¼`False`.
- `--streaming`: æ˜¯å¦ä½¿ç”¨æµå¼æ•°æ®å¤„ç†, é»˜è®¤å€¼`False`.
- `--freeze_parameters`: å½“sft_typeæŒ‡å®šä¸º'full'æ—¶, å°†ä»¥freeze_parametersä¸ºå‰ç¼€çš„å±‚è¿›è¡Œfreeze. é»˜è®¤ä¸º`[]`. ä¾‹å¦‚: `--freeze_parameters visual`.
- `--ğŸ”¥freeze_vit`: å½“sft_typeæŒ‡å®šä¸º'full', ä¸”è®­ç»ƒçš„æ˜¯å¤šæ¨¡æ€æ¨¡å‹æ—¶, å¯ä»¥é€šè¿‡å°†è¯¥å‚æ•°è®¾ç½®ä¸º`True`æ¥å†»ç»“vitçš„å‚æ•°. é»˜è®¤æŒ‡ä¸º`False`.
- `--freeze_parameters_ratio`: å½“sft_typeæŒ‡å®šä¸º'full'æ—¶, å°†æ¨¡å‹æœ€åº•éƒ¨çš„å‚æ•°è¿›è¡Œfreeze. æŒ‡å®šèŒƒå›´ä¸º0. ~ 1., é»˜è®¤ä¸º`0.`. è¯¥å‚æ•°æä¾›äº†loraä¸å…¨å‚æ•°å¾®è°ƒçš„æŠ˜ä¸­æ–¹æ¡ˆ.
- `--additional_trainable_parameters`: ä½œä¸ºfreeze_parametersçš„è¡¥å……, åªæœ‰åœ¨sft_typeæŒ‡å®šä¸º'full'æ‰å…è®¸è¢«ä½¿ç”¨, é»˜è®¤ä¸º`[]`. ä¾‹å¦‚ä½ å¦‚æœæƒ³è®­ç»ƒ50%çš„å‚æ•°çš„æƒ…å†µä¸‹æƒ³é¢å¤–è®­ç»ƒembeddingå±‚, ä½ å¯ä»¥è®¾ç½®`--freeze_parameters_ratio 0.5 --additional_trainable_parameters transformer.wte`, æ‰€æœ‰ä»¥`transformer.wte`å¼€å¤´çš„parameterséƒ½ä¼šè¢«æ¿€æ´». ä½ ä¹Ÿå¯ä»¥è®¾ç½®`--freeze_parameters_ratio 1 --additional_trainable_parameters xxx`æ¥è‡ªå®šä¹‰å¯ä»¥è®­ç»ƒçš„å±‚.
- `--tuner_backend`: è¡¨ç¤ºlora, qloraçš„åç«¯æ”¯æŒ, é»˜è®¤æ˜¯`'peft'`. ä½ å¯ä»¥é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'swift', 'peft', 'unsloth'.
- `--ğŸ”¥template_type`: è¡¨ç¤ºä½¿ç”¨çš„å¯¹è¯æ¨¡æ¿çš„ç±»å‹, é»˜è®¤æ˜¯`'AUTO'`, å³æ ¹æ®`model_type`æŸ¥æ‰¾`MODEL_MAPPING`ä¸­çš„`template`. å¯ä»¥é€‰æ‹©çš„`template_type`å¯ä»¥æŸ¥çœ‹`TEMPLATE_MAPPING.keys()`.
- `--ğŸ”¥output_dir`: è¡¨ç¤ºckptå­˜å‚¨çš„ç›®å½•, é»˜è®¤æ˜¯`'output'`. æˆ‘ä»¬ä¼šåœ¨è¯¥ç›®å½•åæ‹¼æ¥`model_type`å’Œå¾®è°ƒç‰ˆæœ¬å·. æ–¹ä¾¿ç”¨æˆ·å¯¹ä¸åŒæ¨¡å‹è¿›è¡Œå¤šæ¬¡å¯¹æ¯”å®éªŒ, è€Œä¸éœ€è¦æ”¹å˜`output_dir`å‘½ä»¤è¡Œå‚æ•°. å¦‚æœä¸éœ€è¦æ‹¼æ¥è¿™äº›å†…å®¹, ä½ éœ€è¦é¢å¤–æŒ‡å®šå‚æ•°`--add_output_dir_suffix false`.
- `--add_output_dir_suffix`: é»˜è®¤ä¸º`True`, è¡¨ç¤ºä¼šåœ¨`output_dir`çš„ç›®å½•åæ‹¼æ¥ä¸Š`model_type`å’Œå¾®è°ƒç‰ˆæœ¬å·çš„åç¼€. å¦‚æœè¦é¿å…æ­¤è¡Œä¸º, ä½ å¯ä»¥è®¾ç½®ä¸º`False`.
- `--ddp_backend`: è¡¨ç¤ºåˆ†å¸ƒå¼çš„åç«¯æ”¯æŒ, é»˜è®¤æ˜¯`None`. ä½ å¯ä»¥é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'nccl', 'gloo', 'mpi', 'ccl'.
- `--ddp_timeout`: DDP timeout. é»˜è®¤`1800`ç§’.
- `--seed`: å…¨å±€çš„seed, é»˜è®¤ä½¿ç”¨`42`. ç”¨äºå¤ç°è®­ç»ƒæ•ˆæœ.
- `--ğŸ”¥resume_from_checkpoint`: ç”¨äºæ–­ç‚¹ç»­è®­, é»˜è®¤ä¸º`None`. ä½ å¯ä»¥å°†å…¶è®¾ç½®ä¸ºcheckpointçš„è·¯å¾„, ä¾‹å¦‚: `--resume_from_checkpoint output/qwen-7b-chat/vx-xxx/checkpoint-xxx`, æ¥è¿›è¡Œæ–­ç‚¹ç»­è®­. æ”¯æŒè°ƒèŠ‚`--resume_only_model`åœ¨æ–­ç‚¹ç»­è®­æ—¶åªè¯»å–æ¨¡å‹æ–‡ä»¶.
- `--resume_only_model`: é»˜è®¤ä¸º`False`, å³ä¸ºä¸¥æ ¼çš„æ–­ç‚¹ç»­è®­, è¿™ä¼šè¯»å–æ¨¡å‹ã€ä¼˜åŒ–å™¨å’Œlr_schedulerçš„æƒé‡å’Œå„ä¸ªè®¾å¤‡å­˜å‚¨çš„éšæœºç§å­, å¹¶å°†ä»ä¸Šæ¬¡è®­ç»ƒæš‚åœçš„stpesåç»§ç»­è®¡æ•°è¿›è¡Œè®­ç»ƒ. å¦‚æœè®¾ç½®ä¸º`True`, åˆ™åªè¯»å–æ¨¡å‹çš„æƒé‡.
- `--dtype`: åŸºæ¨¡å‹è½½å…¥æ—¶çš„torch_dtype, é»˜è®¤ä¸º`'AUTO'`, å³æ™ºèƒ½é€‰æ‹©dtype: å¦‚æœæœºå™¨ä¸æ”¯æŒbf16, åˆ™ä½¿ç”¨fp16, å¦‚æœ`MODEL_MAPPING`ä¸­å¯¹åº”æ¨¡å‹æœ‰æŒ‡å®štorch_dtype, åˆ™ä½¿ç”¨å…¶å¯¹åº”dtype, å¦åˆ™ä½¿ç”¨bf16. ä½ å¯ä»¥é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'bf16', 'fp16', 'fp32'.
- `--model_kwargs`: ç”¨äºä¼ å…¥å¤šæ¨¡æ€æ¨¡å‹ä¸­é’ˆå¯¹äºæ¨¡å‹çš„é¢å¤–å‚æ•°, ä¾‹å¦‚: `'{"hd_num": 16}'`. ä½ å¯ä»¥ä¼ å…¥jsonå­—ç¬¦ä¸²æˆ–è€…ç›´æ¥ä¼ å…¥å­—å…¸. é»˜è®¤ä¸º`None`. é™¤äº†ä½¿ç”¨è¯¥å‚æ•°ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥, ä¾‹å¦‚: `HD_NUM=16`.
- `--ğŸ”¥dataset`: ç”¨äºé€‰æ‹©è®­ç»ƒçš„æ•°æ®é›†, é»˜è®¤ä¸º`[]`. å¯ä»¥é€‰æ‹©çš„æ•°æ®é›†å¯ä»¥æŸ¥çœ‹[æ”¯æŒçš„æ•°æ®é›†](æ”¯æŒçš„æ¨¡å‹å’Œæ•°æ®é›†.md#æ•°æ®é›†). å¦‚æœéœ€è¦ä½¿ç”¨å¤šä¸ªæ•°æ®é›†è¿›è¡Œè®­ç»ƒ, ä½ å¯ä»¥ä½¿ç”¨','æˆ–è€…' 'è¿›è¡Œåˆ†å‰², ä¾‹å¦‚: `--dataset alpaca-en,alpaca-zh` or `--dataset alpaca-en alpaca-zh`. æ”¯æŒModelscope Hub/HuggingFace Hub/æœ¬åœ°è·¯å¾„ã€subsetsé€‰æ‹©ä¸æ•°æ®é›†é‡‡æ ·, æ¯ä¸ªæ•°æ®é›†æŒ‡å®šæ ¼å¼å¦‚ä¸‹: `[HF or MS::]{dataset_name} or {dataset_id} or {dataset_path}[:subset1/subset2/...][#dataset_sample]`, æœ€ç®€åªéœ€è¦æŒ‡å®šdataset_nameã€dataset_idæˆ–è€…dataset_pathå³å¯. è‡ªå®šä¹‰æ•°æ®é›†å¯ä»¥æŸ¥çœ‹[æ•°æ®é›†çš„è‡ªå®šä¹‰ä¸æ‹“å±•æ–‡æ¡£](è‡ªå®šä¹‰ä¸æ‹“å±•.md#è‡ªå®šä¹‰æ•°æ®é›†).
   - æ”¯æŒMSå’ŒHF hub, ä»¥åŠdataset_sampleçš„æ”¯æŒ. e.g. 'MS::alpaca-zh#2000', 'HF::jd-sentiment-zh#2000' (é»˜è®¤ä½¿ç”¨çš„hub, ç”±`USE_UF`ç¯å¢ƒå˜é‡æ§åˆ¶, é»˜è®¤MS).
   - å¯¹subsetsæ›´ç»†ç²’åº¦çš„æ§åˆ¶: é»˜è®¤ä½¿ç”¨æ³¨å†Œæ—¶æŒ‡å®šçš„subsets(æ³¨å†Œæ—¶æœªæŒ‡å®šåˆ™ä½¿ç”¨'default'). e.g. 'sharegpt-gpt4'. å¦‚æœæŒ‡å®šsubsetsåˆ™ä½¿ç”¨å¯¹åº”å­é›†çš„æ•°æ®é›†. e.g. 'sharegpt-gpt4:default/V3_format#2000'. è¿™é‡Œä½¿ç”¨`default`å’Œ`V3_format`å­æ•°æ®é›†, ä½¿ç”¨'/'è¿›è¡Œåˆ†éš”, å¹¶å–2000æ¡.
   - dataset_idçš„æ”¯æŒ. e.g. 'AI-ModelScope/alpaca-gpt4-data-zh#2000', 'HF::llm-wizard/alpaca-gpt4-data-zh#2000', 'hurner/alpaca-gpt4-data-zh#2000', 'HF::shibing624/alpaca-zh#2000'. å¦‚æœdataset_idå·²ç»æ³¨å†Œï¼Œåˆ™ä¼šä½¿ç”¨æ³¨å†Œæ—¶çš„é¢„å¤„ç†å‡½æ•°ã€subsetsã€splitç­‰. å¦åˆ™ä½¿ç”¨`SmartPreprocessor`, æ”¯æŒ5ç§æ•°æ®é›†æ ¼å¼, å¹¶ä½¿ç”¨'default'çš„subsets, splitè®¾ç½®ä¸º'train'. æ”¯æŒçš„æ•°æ®é›†æ ¼å¼å¯ä»¥æŸ¥çœ‹[æ•°æ®é›†çš„è‡ªå®šä¹‰ä¸æ‹“å±•æ–‡æ¡£](è‡ªå®šä¹‰ä¸æ‹“å±•.md#è‡ªå®šä¹‰æ•°æ®é›†).
   - dataset_pathçš„æ”¯æŒ. e.g. '1.jsonl#5000'. (å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¸ºç›¸å¯¹äºè¿è¡Œç›®å½•çš„ç›¸å¯¹è·¯å¾„).
- `--val_dataset`: ç”¨äºæŒ‡å®šå•ç‹¬çš„éªŒè¯é›†, æ ¼å¼å’Œ`dataset`å‚æ•°ç›¸åŒ, é»˜è®¤ä¸º`[]`. å¦‚æœä½¿ç”¨æœ¬å‚æ•°, åˆ™`dataset_test_ratio`ä¸å†ç”Ÿæ•ˆ.
- `--dataset_seed`: ç”¨äºæŒ‡å®šæ•°æ®é›†å¤„ç†çš„seed, é»˜è®¤ä¸º`None`, å³æŒ‡å®šä¸ºå…¨å±€`seed`. dataset_seedä»¥random_stateå½¢å¼å­˜åœ¨, ä¸å½±å“å…¨å±€seed.
- `--dataset_test_ratio`: ç”¨äºæŒ‡å®šå­æ•°æ®é›†åˆ‡åˆ†æˆè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æ¯”ä¾‹, é»˜è®¤ä¸º`0.01`. è‹¥è®¾ç½®äº†`--val_dataset`, åˆ™è¯¥å‚æ•°å¤±æ•ˆ.
- `--train_dataset_sample`: å¯¹è®­ç»ƒé›†çš„é‡‡æ ·æ•°, é»˜è®¤æ˜¯`-1`, å³ä½¿ç”¨å®Œæ•´çš„è®­ç»ƒé›†è¿›è¡Œè®­ç»ƒ. è¯¥å‚æ•°å·²åºŸå¼ƒ, è¯·ä½¿ç”¨`--dataset {dataset_name}#{dataset_sample}`
- `--val_dataset_sample`: å¯¹éªŒè¯é›†è¿›è¡Œé‡‡æ ·, é»˜è®¤æ˜¯`None`, è‡ªåŠ¨é€‰å–åˆé€‚æ•°é‡çš„æ•°æ®é›†æ•°é‡è¿›è¡ŒéªŒè¯. å¦‚æœä½ æŒ‡å®šä¸º`-1`, åˆ™ä½¿ç”¨å®Œæ•´çš„éªŒè¯é›†è¿›è¡ŒéªŒè¯. è¯¥å‚æ•°å·²åºŸå¼ƒ, éªŒè¯é›†æ•°é‡ç”±`--dataset_test_ratio`æˆ–è€…`--val_dataset {dataset_name}#{dataset_sample}`æ§åˆ¶.
- `--ğŸ”¥system`: å¯¹è¯æ¨¡æ¿ä¸­ä½¿ç”¨çš„system, é»˜è®¤ä¸º`None`, å³ä½¿ç”¨æ¨¡å‹é»˜è®¤çš„system. å¦‚æœæŒ‡å®šä¸º'', åˆ™ä¸ä½¿ç”¨system.
- `--tools_prompt`: é€‰æ‹©toolså­—æ®µè½¬åŒ–çš„ç›¸åº”tools system prompt, å¯é€‰é¡¹ä¸º['react_en','react_zh', 'toolbench'], åˆ†åˆ«ä¸ºè‹±æ–‡ç‰ˆReActæ ¼å¼ï¼Œä¸­æ–‡ç‰ˆReActæ ¼å¼å’Œtoolbenchæ ¼å¼ï¼Œé»˜è®¤ä¸ºè‹±æ–‡ç‰ˆReActæ ¼å¼ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œå¯ä»¥å‚è€ƒ[Agentéƒ¨ç½²æœ€ä½³å®è·µ](../LLM/Agentéƒ¨ç½²æœ€ä½³å®è·µ.md)
- `--ğŸ”¥max_length`: tokençš„æœ€å¤§é•¿åº¦, é»˜è®¤ä¸º`2048`. å¯ä»¥é¿å…ä¸ªåˆ«è¿‡é•¿çš„æ•°æ®æ ·æœ¬é€ æˆOOMçš„é—®é¢˜. å½“æŒ‡å®š`--truncation_strategy delete`æ—¶, å¦‚æœæŸæ•°æ®æ ·æœ¬é•¿åº¦è¶…è¿‡max_length, æˆ‘ä»¬ä¼šåˆ é™¤è¯¥æ•°æ®æ ·æœ¬. å¦‚æœæŒ‡å®š`--truncation_strategy truncation_left`æ—¶, æˆ‘ä»¬ä¼šåˆ‡é™¤æœ€å‰é¢çš„token: `input_ids[-max_length:]`. å¦‚æœè®¾ç½®ä¸º-1, åˆ™æ— é™åˆ¶.
- `--truncation_strategy`: é»˜è®¤æ˜¯`'delete'`è¡¨ç¤ºæŠŠè¶…è¿‡max_lengthçš„å¥å­ä»æ•°æ®é›†ä¸­åˆ é™¤. `'truncation_left'`è¡¨ç¤ºä¼šå°†è¶…è¿‡æ–‡æœ¬çš„å·¦è¾¹ç»™åˆ‡é™¤æ‰, è¿™å¯èƒ½ä¼šåˆ‡åˆ°special token, ä¼šå½±å“æ€§èƒ½, å¹¶ä¸æ¨è.
- `--check_dataset_strategy`: é»˜è®¤å€¼ä¸º`'none'`, å³ä¸åšæ£€æŸ¥. å¦‚æœä½ è®­ç»ƒçš„æ¨¡å‹æ˜¯LLM, åˆ™æ¨èä½¿ç”¨`'warning'`ä½œä¸ºæ•°æ®æ£€æŸ¥çš„ç­–ç•¥. å¦‚æœä½ çš„è®­ç»ƒç›®æ ‡ä¸ºå¥å­åˆ†ç±»ç­‰ä»»åŠ¡, åˆ™å»ºè®®è®¾ç½®ä¸º'`none`'.
- `--custom_train_dataset_path`: é»˜è®¤å€¼ä¸º`[]`. è¯¥å‚æ•°å·²åºŸå¼ƒ, è¯·ä½¿ç”¨`--dataset {dataset_path}`.
- `--custom_val_dataset_path`: é»˜è®¤å€¼ä¸º`[]`. è¯¥å‚æ•°å·²åºŸå¼ƒ, è¯¥å‚æ•°å·²åºŸå¼ƒ. è¯·ä½¿ç”¨`--val_dataset {dataset_path}`.
- `--self_cognition_sample`: è‡ªæˆ‘è®¤çŸ¥æ•°æ®é›†çš„é‡‡æ ·æ•°. é»˜è®¤ä¸º`0`. ä½ è¯¥å€¼è®¾ç½®ä¸º>0æ—¶, éœ€è¦åŒæ—¶æŒ‡å®š`--model_name`, `--model_author`. è¯¥å‚æ•°å·²åºŸå¼ƒ, è¯·ä½¿ç”¨`--dataset self-cognition#{self_cognition_sample}`.
- `--ğŸ”¥model_name`: é»˜è®¤ä¸º`[None, None]`. å¦‚æœå¼€å¯äº†è‡ªæˆ‘è®¤çŸ¥æ•°æ®é›†çš„é‡‡æ ·(å³æŒ‡å®š`--dataset self-cognition`æˆ–è€…self_cognition_sample>0), ä½ éœ€è¦ä¼ å…¥ä¸¤ä¸ªå€¼, åˆ†åˆ«ä»£è¡¨æ¨¡å‹çš„ä¸­æ–‡åå’Œè‹±æ–‡å. ä¾‹å¦‚: `--model_name å°é»„ 'Xiao Huang'`. å¦‚æœä½ æƒ³äº†è§£æ›´å¤š, å¯ä»¥æŸ¥çœ‹[è‡ªæˆ‘è®¤çŸ¥å¾®è°ƒæœ€ä½³å®è·µ](../LLM/è‡ªæˆ‘è®¤çŸ¥å¾®è°ƒæœ€ä½³å®è·µ.md).
- `--ğŸ”¥model_author`: é»˜è®¤ä¸º`[None, None]`. å¦‚æœå¼€å¯äº†è‡ªæˆ‘è®¤çŸ¥æ•°æ®é›†çš„é‡‡æ ·, ä½ éœ€è¦ä¼ å…¥ä¸¤ä¸ªå€¼, åˆ†åˆ«ä»£è¡¨ä½œè€…çš„ä¸­æ–‡åå’Œè‹±æ–‡å. ä¾‹å¦‚: `--model_author é­”æ­ ModelScope`.
- `--quant_method`: é‡åŒ–æ–¹æ³•, é»˜è®¤ä¸º`None`. ä½ å¯ä»¥é€‰æ‹©ä¸º'bnb', 'hqq', 'eetq'.
- `--quantization_bit`: ç”¨äºæŒ‡å®šæ˜¯å¦è¿›è¡Œé‡åŒ–å’Œé‡åŒ–çš„bitæ•°, é»˜è®¤ä¸º`0`, å³ä¸è¿›è¡Œé‡åŒ–. å¦‚æœè¦ä½¿ç”¨4bit qlora, ä½ éœ€è¦è®¾ç½®`--sft_type lora --quantization_bit 4`
- `--hqq_axis`: hqqé‡åŒ–å‚æ•°ï¼Œè¡¨ç¤ºæ‰§è¡Œåˆ†ç»„çš„æ‰€æ²¿çš„è½´ï¼Œé»˜è®¤ä¸º`0`, å¯é€‰å€¼åŒ…æ‹¬`0`,`1`
- `--hqq_dynamic_config_path`: hqqæœ¬åœ°é…ç½®è·¯å¾„ï¼Œæ”¯æŒå¯¹æ¨¡å‹ä¸åŒå±‚é…ç½®ä¸åŒçš„é‡åŒ–é…ç½®ï¼Œ[å‚è€ƒ](https://github.com/mobiusml/hqq?tab=readme-ov-file#custom-quantization-configurations-%EF%B8%8F)
- `--bnb_4bit_comp_dtype`: åœ¨è¿›è¡Œ4bité‡åŒ–æ—¶, æˆ‘ä»¬éœ€è¦åœ¨æ¨¡å‹çš„forwardå’Œbackwardæ—¶, å°†å…¶è¿›è¡Œåé‡åŒ–. è¯¥å‚æ•°ç”¨äºæŒ‡å®šåé‡åŒ–åçš„torch_dtype. é»˜è®¤ä¸º`'AUTO'`, å³ä¸`dtype`ä¿æŒä¸€è‡´. å¯é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'fp16', 'bf16', 'fp32'. å½“quantization_bitä¸º0æ—¶, è¯¥å‚æ•°æ— æ•ˆ.
- `--bnb_4bit_quant_type`: 4bité‡åŒ–æ—¶çš„é‡åŒ–æ–¹å¼, é»˜è®¤æ˜¯`'nf4'`. å¯é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'nf4', 'fp4'. å½“quantization_bitä¸º0æ—¶, è¯¥å‚æ•°æ— æ•ˆ.
- `--bnb_4bit_use_double_quant`: æ˜¯å¦åœ¨4bité‡åŒ–æ—¶å¼€å¯doubleé‡åŒ–, é»˜è®¤ä¸º`True`. å½“quantization_bitä¸º0æ—¶, è¯¥å‚æ•°æ— æ•ˆ.
- `--bnb_4bit_quant_storage`: é»˜è®¤å€¼ä¸º`None`. é‡åŒ–å‚æ•°çš„å­˜å‚¨ç±»å‹. è‹¥`quantization_bit`è®¾ç½®ä¸º0, åˆ™è¯¥å‚æ•°å¤±æ•ˆ.
- `--ğŸ”¥target_modules`: æŒ‡å®šloraæ¨¡å—, é»˜è®¤ä¸º`['DEFAULT']`. å¦‚æœtarget_modulesä¼ å…¥`'DEFAULT'` or `'AUTO'`, åˆ™æ ¹æ®`model_type`æŸ¥æ‰¾`MODEL_MAPPING`ä¸­çš„`target_modules`(LLMé»˜è®¤æŒ‡å®šä¸ºqkv, MLLMé»˜è®¤ä¸ºllmå’Œprojectorä¸­æ‰€æœ‰çš„linear). å¦‚æœä¼ å…¥`'ALL'`, åˆ™å°†æ‰€æœ‰çš„Linearå±‚(ä¸å«head)æŒ‡å®šä¸ºloraæ¨¡å—. å¦‚æœä¼ å…¥`'EMBEDDING'`, åˆ™Embeddingå±‚æŒ‡å®šä¸ºloraæ¨¡å—. å¦‚æœå†…å­˜å…è®¸, å»ºè®®è®¾ç½®æˆ'ALL'. å½“ç„¶, ä½ ä¹Ÿå¯ä»¥è®¾ç½®`['ALL', 'EMBEDDING']`, å°†æ‰€æœ‰çš„Linearå’Œembeddingå±‚æŒ‡å®šä¸ºloraæ¨¡å—. è¯¥å‚æ•°åœ¨ä½¿ç”¨lora/vera/boft/ia3/adalora/fourierftæ—¶ç”Ÿæ•ˆ.
- `--target_regex`: æŒ‡å®šloraæ¨¡å—çš„regexè¡¨è¾¾å¼, `Optional[str]`ç±»å‹. é»˜è®¤ä¸º`None`, å¦‚æœè¯¥å€¼ä¼ å…¥, åˆ™target_modulesä¸ç”Ÿæ•ˆ.è¯¥å‚æ•°åœ¨ä½¿ç”¨lora/vera/boft/ia3/adalora/fourierftæ—¶ç”Ÿæ•ˆ.
- `--ğŸ”¥lora_rank`: é»˜è®¤ä¸º`8`. åªæœ‰å½“`sft_type`æŒ‡å®šä¸º'lora'æ—¶æ‰ç”Ÿæ•ˆ.
- `--ğŸ”¥lora_alpha`: é»˜è®¤ä¸º`32`. åªæœ‰å½“`sft_type`æŒ‡å®šä¸º'lora'æ—¶æ‰ç”Ÿæ•ˆ.
- `--lora_dropout`: é»˜è®¤ä¸º`0.05`, åªæœ‰å½“`sft_type`æŒ‡å®šä¸º'lora'æ—¶æ‰ç”Ÿæ•ˆ.
- `--init_lora_weights`: åˆå§‹åŒ–LoRA weightsçš„æ–¹æ³•, å¯ä»¥æŒ‡å®šä¸º`true`, `false`, `guassian`, `pissa`, `pissa_niter_[number of iters]`, é»˜è®¤å€¼`true`.
- `--lora_bias_trainable`: é»˜è®¤ä¸º`'none'`, å¯ä»¥é€‰æ‹©çš„å€¼: 'none', 'all'. å¦‚æœä½ è¦å°†biaså…¨éƒ½è®¾ç½®ä¸ºå¯è®­ç»ƒ, ä½ å¯ä»¥è®¾ç½®ä¸º`'all'`.
- `--modules_to_save`: é»˜è®¤ä¸º`[]`. å¦‚æœä½ æƒ³è¦è®­ç»ƒembedding, lm_head, æˆ–è€…layer_norm, ä½ å¯ä»¥è®¾ç½®æ­¤å‚æ•°, ä¾‹å¦‚: `--modules_to_save EMBEDDING LN lm_head`. å¦‚æœä¼ å…¥`'EMBEDDING'`, åˆ™å°†Embeddingå±‚æ·»åŠ åˆ°`modules_to_save`. å¦‚æœä¼ å…¥`'LN'`, åˆ™å°†`RMSNorm`å’Œ`LayerNorm`æ·»åŠ åˆ°`modules_to_save`.è¯¥å‚æ•°åœ¨ä½¿ç”¨lora/vera/boft/ia3/adalora/fourierftæ—¶ç”Ÿæ•ˆ.
- `--lora_dtype`: é»˜è®¤ä¸º`'AUTO'`, æŒ‡å®šloraæ¨¡å—çš„dtypeç±»å‹. å¦‚æœæ˜¯`AUTO`åˆ™è·ŸéšåŸå§‹æ¨¡å—çš„dtypeç±»å‹. ä½ å¯ä»¥é€‰æ‹©çš„å€¼: 'fp16', 'bf16', 'fp32', 'AUTO'.
- `--use_dora`: é»˜è®¤ä¸º`False`, æ˜¯å¦ä½¿ç”¨`DoRA`.
- `--use_rslora`: é»˜è®¤ä¸º`False`, æ˜¯å¦ä½¿ç”¨`RS-LoRA`.
- `--neftune_noise_alpha`: `NEFTune`æ·»åŠ çš„å™ªå£°ç³»æ•°, å¯ä»¥æå‡æ¨¡å‹åœ¨æŒ‡ä»¤å¾®è°ƒä¸­çš„æ€§èƒ½, é»˜è®¤ä¸º`None`. é€šå¸¸å¯ä»¥è®¾ç½®ä¸º5, 10, 15. ä½ å¯ä»¥æŸ¥çœ‹[ç›¸å…³è®ºæ–‡](https://arxiv.org/abs/2310.05914).
- `--neftune_backend`: `NEFTune`çš„backendï¼Œæ”¯æŒ`transformers`å’Œ`swift`ä¸¤ç§, é»˜è®¤ä½¿ç”¨`transformers`åº“.
- `--ğŸ”¥gradient_checkpointing`: æ˜¯å¦å¼€å¯gradient checkpointing, é»˜è®¤ä¸º`True`. è¯¥å‚æ•°å¯ä»¥ç”¨äºèŠ‚çº¦æ˜¾å­˜, è™½ç„¶è¿™ä¼šç•¥å¾®é™ä½è®­ç»ƒé€Ÿåº¦. è¯¥å‚æ•°åœ¨max_lengthè¾ƒå¤§, batch_sizeè¾ƒå¤§æ—¶ä½œç”¨æ˜¾è‘—.
- `--ğŸ”¥deepspeed`: ç”¨äºæŒ‡å®šdeepspeedçš„é…ç½®æ–‡ä»¶çš„è·¯å¾„æˆ–è€…ç›´æ¥ä¼ å…¥jsonæ ¼å¼çš„é…ç½®ä¿¡æ¯, é»˜è®¤ä¸º`None`, å³ä¸å¼€å¯deepspeed. deepspeedå¯ä»¥èŠ‚çº¦æ˜¾å­˜. æˆ‘ä»¬ä¹¦å†™äº†é»˜è®¤çš„[ZeRO-2é…ç½®æ–‡ä»¶](https://github.com/modelscope/swift/blob/main/swift/llm/ds_config/zero2.json), [ZeRO-3é…ç½®æ–‡ä»¶](https://github.com/modelscope/swift/blob/main/swift/llm/ds_config/zero3.json), [ZeRO-2 Offloadé…ç½®æ–‡ä»¶](https://github.com/modelscope/swift/blob/main/swift/llm/ds_config/zero2_offload.json)å’Œ[ZeRO-3 Offloadé…ç½®æ–‡ä»¶](https://github.com/modelscope/swift/blob/main/swift/llm/ds_config/zero3_offload.json). ä½ åªéœ€è¦æŒ‡å®š'default-zero2', 'default-zero3', 'zero2-offload', 'zero3-offload'å³å¯.
- `--batch_size`: è®­ç»ƒæ—¶çš„batch_size, é»˜è®¤ä¸º`1`. å¢å¤§batch_sizeå¯ä»¥å¢åŠ GPUçš„åˆ©ç”¨ç‡, ä½†ä¸ä¸€å®šä¼šå¢åŠ è®­ç»ƒé€Ÿåº¦, å› ä¸ºåœ¨ä¸€ä¸ªbatchä¸­, éœ€è¦å¯¹è¾ƒçŸ­çš„å¥å­æŒ‰è¯¥batchä¸­æœ€é•¿å¥å­çš„é•¿åº¦è¿›è¡Œpadding, ä»è€Œå¼•å…¥æ— æ•ˆçš„è®¡ç®—é‡.
- `--eval_batch_size`: è¯„ä¼°æ—¶çš„batch_size, é»˜è®¤ä¸º`None`, å³å½“`predict_with_generate`ä¸ºTrueæ—¶, è®¾ç½®ä¸º1, ä¸ºFalseæ—¶, è®¾ç½®ä¸º`batch_size`.
- `--ğŸ”¥num_train_epochs`: è®­ç»ƒçš„epochæ•°, é»˜è®¤ä¸º`1`. å¦‚æœ`max_steps >= 0`, åˆ™è¦†ç›–`num_train_epochs`. ä½ å¯ä»¥è®¾ç½®ä¸º3, 5, 10ç­‰.
- `--max_steps`: è®­ç»ƒçš„max_stepsæ•°, é»˜è®¤ä¸º`-1`. å¦‚æœ`max_steps >= 0`, åˆ™è¦†ç›–`num_train_epochs`.
- `--optim`: é»˜è®¤ä¸º`'adamw_torch'`.
- `--adam_beta1`: é»˜è®¤ä¸º`0.9`.
- `--adam_beta2`: é»˜è®¤ä¸º`0.95`.
- `--adam_epsilon`: é»˜è®¤ä¸º`1e-8`.
- `--ğŸ”¥learning_rate`: é»˜è®¤å€¼ä¸º`None`, å³å¦‚æœ`sft_type`ä¸ºlora, åˆ™è®¾ç½®ä¸º1e-4, å¦‚æœ`sft_type`ä¸ºfull, åˆ™è®¾ç½®ä¸º1e-5.
- `--weight_decay`: é»˜è®¤å€¼ä¸º`0.1`.
- `--ğŸ”¥gradient_accumulation_steps`: æ¢¯åº¦ç´¯åŠ , é»˜è®¤å€¼ä¸º`None`, è®¾ç½®ä¸º`math.ceil(16 / self.batch_size / world_size)`. `total_batch_size =  batch_size * gradient_accumulation_steps * world_size`.
- `--max_grad_norm`: æ¢¯åº¦è£å‰ª, é»˜è®¤å€¼ä¸º`1`.
- `--predict_with_generate`: è¯„ä¼°æ—¶æ˜¯å¦ä½¿ç”¨ç”Ÿæˆå¼çš„æ–¹å¼, é»˜è®¤ä¸º`False`. å¦‚æœè®¾ç½®ä¸ºFalse, åˆ™ä½¿ç”¨`loss`è¿›è¡Œè¯„ä¼°. å¦‚æœè®¾ç½®ä¸ºTrue, åˆ™ä½¿ç”¨`ROUGE-L`ç­‰æŒ‡æ ‡è¿›è¡Œè¯„ä¼°. ä½¿ç”¨ç”Ÿæˆå¼è¯„ä¼°è€—è´¹çš„æ—¶é—´å¾ˆé•¿, è¯·è°¨æ…é€‰æ‹©.
- `--lr_scheduler_type`: é»˜è®¤å€¼ä¸º`'cosine'`, ä½ å¯ä»¥é€‰æ‹©: 'linear', 'cosine', 'constant'ç­‰.
- `--warmup_ratio`: warmupå ç”¨æ€»çš„è®­ç»ƒstepsçš„æ¯”ä¾‹, é»˜è®¤ä¸º`0.05`.
- `--warmup_steps`: warmupçš„æ­¥æ•°, é»˜è®¤ä¸º`0`. å¦‚æœè®¾ç½®`warmup_steps>0`, åˆ™è¦†ç›–warmup_ratio.
- `--ğŸ”¥eval_steps`: æ¯è®­ç»ƒå¤šå°‘stepsè¿›è¡Œè¯„ä¼°, é»˜è®¤ä¸º`50`.
- `--save_steps`: æ¯è®­ç»ƒå¤šå°‘ä¸ªstepsè¿›è¡Œä¿å­˜, é»˜è®¤ä¸º`None`, å³è®¾ç½®ä¸º`eval_steps`.
- `--ğŸ”¥save_only_model`: æ˜¯å¦åªä¿å­˜æ¨¡å‹å‚æ•°, è€Œä¸å­˜å‚¨æ–­ç‚¹ç»­è®­æ‰€éœ€çš„ä¸­é—´çŠ¶æ€, é»˜è®¤ä¸º`False`.
- `--save_total_limit`: ä¿å­˜çš„checkpointçš„æ•°é‡, é»˜è®¤ä¸º`2`, å³ä¿å­˜bestå’Œlastçš„checkpoint. å¦‚æœè®¾ç½®ä¸º-1, åˆ™ä¿å­˜æ‰€æœ‰çš„checkpoint.
- `--logging_steps`: æ¯è®­ç»ƒå¤šå°‘æ­¥æ‰“å°è®­ç»ƒä¿¡æ¯(e.g. loss, learning_rateç­‰), é»˜è®¤ä¸º`5`.
- `--dataloader_num_workers`: é»˜è®¤å€¼ä¸º`None`, å¦‚æœæ˜¯windowsæœºå™¨, åˆ™è®¾ç½®ä¸º`0`, å¦åˆ™è®¾ç½®ä¸º`1`.
- `--push_to_hub`: æ˜¯å¦å°†è®­ç»ƒçš„checkpointåŒæ­¥æ¨é€åˆ°ModelScope Hubä¸­, é»˜è®¤ä¸º`False`.
- `--hub_model_id`: æ¨é€åˆ°çš„ModelScope Hubçš„model_id, é»˜è®¤ä¸º`None`, å³è®¾ç½®ä¸º`f'{model_type}-{sft_type}'`. ä½ å¯ä»¥å°†å…¶è®¾ç½®ä¸ºmodel_id, ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºrepo_name. æˆ‘ä»¬ä¼šæ ¹æ®hub_tokenæ¨æ–­å‡ºuser_name. æ¨é€çš„è¿œç¨‹ä»“åº“å¦‚æœä¸å­˜åœ¨, åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“, å¦‚æœå­˜åœ¨, åˆ™å¤ç”¨ä¹‹å‰çš„ä»“åº“. è¯¥å‚æ•°åªæœ‰åœ¨`push_to_hub`è®¾ç½®ä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ.
- `--hub_token`: æ¨é€æ—¶éœ€è¦çš„SDK token. å¯ä»¥ä»[https://modelscope.cn/my/myaccesstoken](https://modelscope.cn/my/myaccesstoken)è·å–, é»˜è®¤ä¸º`None`, å³ä»ç¯å¢ƒå˜é‡`MODELSCOPE_API_TOKEN`ä¸­è·å–. è¯¥å‚æ•°åªæœ‰åœ¨`push_to_hub`è®¾ç½®ä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ.
- `--hub_private_repo`: æ¨é€çš„ModelScope Hubä¸­çš„æ¨¡å‹ä»“åº“çš„æƒé™æ˜¯å¦è®¾ç½®ä¸ºç§æœ‰, é»˜è®¤ä¸º`False`. è¯¥å‚æ•°åªæœ‰åœ¨`push_to_hub`è®¾ç½®ä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ.
- `--hub_strategy`: æ¨é€ç­–ç•¥, é»˜è®¤ä¸º`'every_save'`. å¯é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'end', 'every_save', 'checkpoint', 'all_checkpoints'. è¯¥å‚æ•°ä»transformersé€ä¼ è€Œæ¥, åªæœ‰åœ¨`push_to_hub`è®¾ç½®ä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ.
- `--test_oom_error`: ç”¨äºæ£€æµ‹è®­ç»ƒæ˜¯å¦ä¼šå‘ç”ŸOOM, é»˜è®¤ä¸º`False`. å¦‚æœè®¾ç½®ä¸ºTrue, åˆ™ä¼šå°†è®­ç»ƒé›†æŒ‰max_lengthå€’åºè¿›è¡Œæ’åˆ—, æ–¹ä¾¿OOMçš„æµ‹è¯•. è¯¥å‚æ•°ä¸€èˆ¬ç”¨äºæµ‹è¯•, è¯·è°¨æ…è®¾ç½®.
- `--disable_tqdm`: æ˜¯å¦ä¸å¯ç”¨tqdm, è¿™åœ¨`nohup`å¯åŠ¨è„šæœ¬æ—¶å¾ˆæœ‰ç”¨. é»˜è®¤ä¸º`False`, å³ä¸ºå¯åŠ¨tqdm.
- `--ğŸ”¥lazy_tokenize`: å¦‚æœè®¾ç½®ä¸ºFalse,  åˆ™åœ¨`trainer.train()`ä¹‹å‰æå‰å¯¹æ‰€æœ‰æ–‡æœ¬è¿›è¡Œé¢„å¤„ç†. å¦‚æœè®¾ç½®ä¸ºTrue, åˆ™å»¶è¿Ÿå¯¹æ–‡æœ¬è¿›è¡Œç¼–ç , å‡å°‘é¢„å¤„ç†çš„ç­‰å¾…å¹¶å‡å°‘å†…å­˜å ç”¨, è¿™åœ¨å¤„ç†å¤§æ•°æ®é›†æ—¶å¾ˆæœ‰ç”¨. é»˜è®¤ä¸º`None`, å³æˆ‘ä»¬ä¼šæ ¹æ®templateçš„ç±»å‹è¿›è¡Œæ™ºèƒ½é€‰æ‹©, LLMçš„æ¨¡å‹é€šå¸¸è®¾ç½®ä¸ºFalse, å¤šæ¨¡æ€çš„æ¨¡å‹é€šå¸¸è®¾ç½®ä¸ºTrue(é¿å…å›¾ç‰‡å’ŒéŸ³é¢‘åŠ è½½å¯¼è‡´è¿‡å¤šçš„å†…å­˜å ç”¨).
- `--ğŸ”¥preprocess_num_proc`: åœ¨å¯¹æ•°æ®é›†é¢„å¤„ç†æ—¶(å¯¹æ–‡æœ¬è¿›è¡Œtokenize), ä½¿ç”¨å¤šè¿›ç¨‹. é»˜è®¤ä¸º`1`. ä¸`lazy_tokenize`å‘½ä»¤è¡Œå‚æ•°ä¸€æ ·, ç”¨äºè§£å†³é¢„å¤„ç†é€Ÿåº¦æ…¢çš„é—®é¢˜. ä½†è¯¥ç­–ç•¥æ— æ³•å‡å°‘å†…å­˜å ç”¨, æ‰€ä»¥å¦‚æœå½“æ•°æ®é›†å·¨å¤§æ—¶, å»ºè®®ä½¿ç”¨`lazy_tokenize`. æ¨èè®¾ç½®çš„å€¼: 4, 8.
- `--ğŸ”¥use_flash_attn`: æ˜¯å¦ä½¿ç”¨flash attn, é»˜è®¤ä¸º`None`. å®‰è£…flash_attnçš„æ­¥éª¤å¯ä»¥æŸ¥çœ‹[https://github.com/Dao-AILab/flash-attention](https://github.com/Dao-AILab/flash-attention). æ”¯æŒflash_attnçš„æ¨¡å‹å¯ä»¥æŸ¥çœ‹[LLMæ”¯æŒçš„æ¨¡å‹](æ”¯æŒçš„æ¨¡å‹å’Œæ•°æ®é›†.md#æ¨¡å‹).
- `--ignore_args_error`: æ˜¯å¦å¿½ç•¥å‘½ä»¤è¡Œä¼ å‚é”™è¯¯æŠ›å‡ºçš„Error, é»˜è®¤ä¸º`False`. å¦‚æœéœ€è¦æ‹·è´ä»£ç åˆ°notebookä¸­è¿è¡Œ, éœ€è¦è®¾ç½®æˆTrue.
- `--ğŸ”¥check_model_is_latest`: æ£€æŸ¥æ¨¡å‹æ˜¯å¦æ˜¯æœ€æ–°, é»˜è®¤ä¸º`True`. å¦‚æœä½ éœ€è¦æ–­ç½‘è¿›è¡Œè®­ç»ƒ, è¯·å°†è¯¥å‚æ•°è®¾ç½®ä¸º`False`.
- `--logging_dir`: é»˜è®¤ä¸º`None`. å³è®¾ç½®ä¸º`f'{self.output_dir}/runs'`, è¡¨ç¤ºtensorboardæ–‡ä»¶å­˜å‚¨è·¯å¾„.
- `--report_to`: é»˜è®¤ä¸º`['tensorboard']`. å¯ä»¥è®¾ç½®`--report_to all`æ¥æŠ¥å‘Šæ‰€æœ‰å·²å®‰è£…çš„é›†æˆ.
- `--acc_strategy`: é»˜è®¤ä¸º`'token'`, å¯é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'token', 'sentence'.
- `--save_on_each_node`: è¯¥å‚æ•°åœ¨å¤šæœºè®­ç»ƒæ—¶ç”Ÿæ•ˆ, é»˜è®¤ä¸º`False`.
- `--save_strategy`: ä¿å­˜checkpointçš„ç­–ç•¥, é»˜è®¤ä¸º`'steps'`, å¯é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'steps', 'epoch', 'no'.
- `--evaluation_strategy`: äº¤å‰éªŒè¯ç­–ç•¥, é»˜è®¤ä¸º`'steps'`, å¯é€‰æ‹©çš„å€¼åŒ…æ‹¬: 'steps', 'epoch', 'no'.
- `--save_safetensors`: é»˜è®¤ä¸º`True`.
- `--include_num_input_tokens_seen`: é»˜è®¤ä¸º`False`. è·Ÿè¸ªæ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­è§‚å¯Ÿåˆ°çš„è¾“å…¥tokensçš„æ•°é‡.
- `--max_new_tokens`: é»˜è®¤ä¸º`2048`. è¯¥å‚æ•°åªæœ‰åœ¨`predict_with_generate`è®¾ç½®ä¸ºTrueçš„æ—¶å€™æ‰ç”Ÿæ•ˆ.
- `--do_sample`: å‚è€ƒæ–‡æ¡£: [https://huggingface.co/docs/transformers/main_classes/text_generation](https://huggingface.co/docs/transformers/main_classes/text_generation). é»˜è®¤ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`predict_with_generate`è®¾ç½®ä¸ºTrueçš„æ—¶å€™æ‰ç”Ÿæ•ˆ.
- `--temperature`: é»˜è®¤ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`predict_with_generate`è®¾ç½®ä¸ºTrueçš„æ—¶å€™æ‰ç”Ÿæ•ˆ.
- `--top_k`: é»˜è®¤ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`predict_with_generate`è®¾ç½®ä¸ºTrueçš„æ—¶å€™æ‰ç”Ÿæ•ˆ.
- `--top_p`: é»˜è®¤ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`predict_with_generate`è®¾ç½®ä¸ºTrueçš„æ—¶å€™æ‰ç”Ÿæ•ˆ.
- `--repetition_penalty`: é»˜è®¤ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`predict_with_generate`è®¾ç½®ä¸ºTrueçš„æ—¶å€™æ‰ç”Ÿæ•ˆ.
- `--num_beams`: é»˜è®¤ä¸º`1`. è¯¥å‚æ•°åªæœ‰åœ¨`predict_with_generate`è®¾ç½®ä¸ºTrueçš„æ—¶å€™æ‰ç”Ÿæ•ˆ.
- `--gpu_memory_fraction`: é»˜è®¤ä¸º`None`. è¯¥å‚æ•°æ—¨åœ¨æŒ‡å®šæ˜¾å¡æœ€å¤§å¯ç”¨æ˜¾å­˜æ¯”ä¾‹çš„æƒ…å†µä¸‹è¿è¡Œè®­ç»ƒï¼Œç”¨äºæé™æµ‹è¯•.
- `--train_dataset_mix_ratio`: é»˜è®¤ä¸º`0.`. è¯¥å‚æ•°å®šä¹‰äº†å¦‚ä½•è¿›è¡Œæ•°æ®é›†æ‰“æ··è®­ç»ƒ. æŒ‡å®šè¯¥å‚æ•°æ—¶, ä¼šæ··åˆè®­ç»ƒé›†çš„`train_dataset_mix_ratio`å€æ•°çš„`train_dataset_mix_ds`æŒ‡å®šçš„é€šç”¨çŸ¥è¯†æ•°æ®é›†. è¯¥å‚æ•°å·²åºŸå¼ƒ, è¯·ä½¿ç”¨`--dataset`è¿›è¡Œæ•°æ®é›†æ··åˆ.
- `--train_dataset_mix_ds`: é»˜è®¤ä¸º`['ms-bench']`. ç”¨äºé˜²æ­¢çŸ¥è¯†é—å¿˜çš„é€šç”¨çŸ¥è¯†æ•°æ®é›†. è¯¥å‚æ•°å·²åºŸå¼ƒ, è¯·ä½¿ç”¨`--dataset`è¿›è¡Œæ•°æ®é›†æ··åˆ.
- `--use_loss_scale`: é»˜è®¤ä¸º`False`. ç”Ÿæ•ˆæ—¶ä¼šå°†Agentçš„éƒ¨åˆ†å­—æ®µ(Action/Action Inputéƒ¨åˆ†)çš„lossæƒé‡åŠ å¼ºä»¥å¼ºåŒ–CoT, å¯¹æ™®é€šSFTåœºæ™¯æ²¡æœ‰ä»»ä½•æ•ˆæœ.
- `--loss_scale_config_path` é€‰é¡¹æŒ‡å®šè‡ªå®šä¹‰çš„ loss_scale é…ç½®ï¼Œé€‚ç”¨äºåœ¨å¯ç”¨ use_loss_scale æ—¶ï¼Œä¾‹å¦‚åœ¨ Agent è®­ç»ƒä¸­æ”¾å¤§ Action å’Œå…¶ä»–å…³é”® ReAct å­—æ®µçš„æŸå¤±æƒé‡ã€‚
  - åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å­—å…¸æ ¼å¼æ¥è®¾ç½® loss_scaleã€‚æ¯ä¸ªé”®ä»£è¡¨ä¸€ä¸ªç‰¹å®šå­—æ®µåï¼Œå…¶å…³è”çš„å€¼è®¾å®šäº†è¯¥å­—æ®µåŠå…¶åç»­å†…å®¹çš„æŸå¤±ç¼©æ”¾å€æ•°ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è®¾å®š `"Observation:": [2, 0]`ï¼Œå½“responseåŒ…å« `xxxx Observation:error` æ—¶ï¼Œ`Observation:` å­—æ®µlosså°†å¢åŠ åˆ°ä¸¤å€ï¼Œ`error` éƒ¨åˆ†çš„lossåˆ™ä¸è®¡å…¥ã€‚é™¤äº†å­—é¢åŒ¹é…ï¼Œé…ç½®ä¹Ÿæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ï¼Œä»¥å®ç°æ›´çµæ´»çš„åŒ¹é…ï¼Œå¦‚æ¨¡å¼ '<.*?>':[2.0] å°†é’ˆå¯¹æ‰€æœ‰å°–æ‹¬å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†æŸå¤±å¢åŠ åˆ°ä¸¤å€ã€‚å­—æ®µåŒ¹é…ä¸æ­£åˆ™åŒ¹é…æ‰€å¯¹åº”çš„æŸå¤±ç¼©æ”¾å€æ•°ï¼Œåˆ†åˆ«ç”±é•¿åº¦ä¸º2å’Œ1çš„åˆ—è¡¨è¡¨ç¤ºã€‚
  - åŒæ—¶æ”¯æŒåŒ¹é…queryå¯¹æ•´æ®µresponseè®¾ç½®loss_scale, è¿™åœ¨å¤„ç†åƒ[Agent-FLAN](https://arxiv.org/abs/2403.12881)è®ºæ–‡ä¸­æè¿°çš„å›ºå®šå¤šè½®å¯¹è¯æŸ¥è¯¢æ—¶æå…¶æœ‰ç”¨ï¼Œå¦‚æœqueryä¸­åŒ…å«äº†é¢„å®šä¹‰é”®çš„ä»»ä¸€é¡¹ï¼Œç›¸åº”çš„å“åº”å°†é‡‡ç”¨å…³è”çš„ loss_scale å€¼ã€‚ï¼Œä½ å¯ä»¥å‚è€ƒ`swift/llm/agent/agentflan.json`
  - é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸º Action:, Action Input:, Thought:, Final Answer:, å’Œ Observation: ç­‰å­—æ®µé¢„è®¾äº†æŸå¤±ç¼©æ”¾å€¼ã€‚æˆ‘ä»¬ä¸º[alpha-umi](https://arxiv.org/pdf/2401.07324)å’Œ[Agent-FLAN](https://arxiv.org/abs/2403.12881)ä¹Ÿæä¾›äº†é»˜è®¤é…ç½®ï¼Œä½ å¯ä»¥è®¾ç½®ä¸º`alpha-umi`å’Œ`agent-flan`æ¥ä½¿ç”¨ã€‚é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½äº`swift/llm/agent`ä¸‹
  - åŒ¹é…è§„åˆ™çš„åº”ç”¨ä¼˜å…ˆçº§ï¼Œä»é«˜åˆ°ä½ä¸ºï¼šqueryå­—æ®µ > responseç‰¹å®šå­—æ®µ > æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è§„åˆ™ã€‚
- `--custom_register_path`: é»˜è®¤ä¸º`None`. ä¼ å…¥`.py`æ–‡ä»¶, ç”¨äºæ³¨å†Œæ¨¡æ¿ã€æ¨¡å‹å’Œæ•°æ®é›†.
- `--custom_dataset_info`: é»˜è®¤ä¸º`None`, ä¼ å…¥å¤–ç½®dataset_info.jsonçš„è·¯å¾„ã€jsonå­—ç¬¦ä¸²æˆ–è€…dict. ç”¨äºæ‹“å±•æ•°æ®é›†. æ ¼å¼å‚è€ƒ: https://github.com/modelscope/swift/blob/main/swift/llm/data/dataset_info.json
- `--device_map_config`: æ‰‹åŠ¨é…ç½®æ¨¡å‹çš„device_map, é»˜è®¤ä¸º`None`. ä½ å¯ä»¥ä¼ å…¥æœ¬åœ°è·¯å¾„(.json), jsonå­—ç¬¦ä¸²æˆ–è€…dict.
- `--device_max_memory`: æ¯ä¸ªè®¾å¤‡device_mapçš„æœ€å¤§å¯ç”¨æ˜¾å­˜, `List`, é»˜è®¤ä¸º`[]`, ä¼ é€’çš„å€¼æ•°é‡å¿…é¡»å’Œå¯è§æ˜¾å¡æ•°é‡ç›¸ç­‰. æ¯”å¦‚`10GB 10GB`.

### Long Context

- `--rope_scaling`: é»˜è®¤å€¼`None`, æ”¯æŒ`linear`å’Œ`dynamic`ä¸¤ç§scalingæ–¹å¼.å½“`max_length`è¶…è¿‡`max_position_embeddings`æ—¶ä½¿ç”¨.
- `--rescale_image`: æ˜¯å¦å¯¹è¾“å…¥imageè¿›è¡Œrescale, å€¼ä¸ºç›®æ ‡åƒç´ æ•°, ä¾‹å¦‚480000(width * height), æ‰€æœ‰å¤§äºæ­¤åƒç´ çš„å›¾ç‰‡ä¼šæŒ‰ç…§åŸå§‹é•¿å®½æ¯”è¢«ç¼©æ”¾åˆ°è¿™ä¸ªå€¼. æ³¨æ„ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰å¤šæ¨¡æ€æ¨¡å‹éƒ½å¯ä»¥ä»è¿™ä¸ªå‚æ•°ä¸­è·ç›Šã€‚

### FSDPå‚æ•°

- `--fsdp`: é»˜è®¤å€¼`''`, fsdpç±»å‹, è¯¦æƒ…å¯ä»¥æŸ¥çœ‹è¯¥å‚æ•°[åŸå§‹æ–‡æ¡£](https://huggingface.co/docs/transformers/v4.39.3/en/main_classes/trainer#transformers.TrainingArguments.fsdp).
- `--fsdp_config`: é»˜è®¤å€¼`None`, fsdpé…ç½®æ–‡ä»¶çš„è·¯å¾„.

### Sequence Parallelå‚æ•°

- `--sequence_parallel_size`: é»˜è®¤å€¼`1`, å¤§äº1æ—¶å¯ä»¥æ‹†åˆ†ä¸€ä¸ªsequenceåˆ°å¤šå¼ æ˜¾å¡ä¸Šä»¥èŠ‚çœæ˜¾å­˜, å€¼éœ€è¦è®¾ç½®ä¸ºèƒ½è¢«DDPæ•°é‡æ•´é™¤

### FourierFt å‚æ•°

FourierFtä½¿ç”¨`target_modules`, `target_regex`, `modules_to_save`ä¸‰ä¸ªå‚æ•°.

- `--fourier_n_frequency`: å‚…é‡Œå¶å˜æ¢çš„é¢‘ç‡æ•°é‡, `int`ç±»å‹, ç±»ä¼¼äºLoRAä¸­çš„`r`. é»˜è®¤å€¼`2000`.
- `--fourier_scaling`: WçŸ©é˜µçš„ç¼©æ”¾å€¼, `float`ç±»å‹, ç±»ä¼¼LoRAä¸­çš„`lora_alpha`. é»˜è®¤å€¼`300.0`.

### BOFTå‚æ•°

BOFTä½¿ç”¨`target_modules`, `target_regex`, `modules_to_save`ä¸‰ä¸ªå‚æ•°.

- `--boft_block_size`: BOFTå—å°ºå¯¸, é»˜è®¤å€¼4.
- `--boft_block_num`: BOFTå—æ•°é‡, ä¸èƒ½å’Œ`boft_block_size`åŒæ—¶ä½¿ç”¨.
- `--boft_dropout`: boftçš„dropoutå€¼, é»˜è®¤0.0.

### Veraå‚æ•°

Veraä½¿ç”¨`target_modules`, `target_regex`, `modules_to_save`ä¸‰ä¸ªå‚æ•°.

- `--vera_rank`: Vera Attentionçš„å°ºå¯¸, é»˜è®¤å€¼256.
- `--vera_projection_prng_key`: æ˜¯å¦å­˜å‚¨Veraæ˜ å°„çŸ©é˜µ, é»˜è®¤ä¸ºTrue.
- `--vera_dropout`: Veraçš„dropoutå€¼, é»˜è®¤`0.0`.
- `--vera_d_initial`: Veraçš„dçŸ©é˜µçš„åˆå§‹å€¼, é»˜è®¤`0.1`.

### LoRA+å¾®è°ƒå‚æ•°

- `--lora_lr_ratio`: é»˜è®¤å€¼`None`, å»ºè®®å€¼`10~16`, ä½¿ç”¨loraæ—¶æŒ‡å®šè¯¥å‚æ•°å³å¯ä½¿ç”¨lora+.

### GaLoreå¾®è°ƒå‚æ•°

- `--use_galore: bool` : é»˜è®¤å€¼False, æ˜¯å¦ä½¿ç”¨GaLore.
- `--galore_target_modules: Union[str, List[str]]` : é»˜è®¤å€¼None, ä¸ä¼ çš„æƒ…å†µä¸‹å¯¹attentionå’Œmlpåº”ç”¨GaLore.
- `--galore_rank: int` : é»˜è®¤å€¼128, GaLoreçš„rankå€¼.
- `--galore_update_proj_gap: int` : é»˜è®¤å€¼50, åˆ†è§£çŸ©é˜µçš„æ›´æ–°é—´éš”.
- `--galore_scale: int` : é»˜è®¤å€¼1.0, çŸ©é˜µæƒé‡ç³»æ•°.
- `--galore_proj_type: str` : é»˜è®¤å€¼`std`, GaLoreçŸ©é˜µåˆ†è§£ç±»å‹.
- `--galore_optim_per_parameter: bool` : é»˜è®¤å€¼False, æ˜¯å¦ç»™æ¯ä¸ªGaloreç›®æ ‡Parameterè®¾å®šä¸€ä¸ªå•ç‹¬çš„optimizer.
- `--galore_with_embedding: bool` : é»˜è®¤å€¼False, æ˜¯å¦å¯¹embeddingåº”ç”¨GaLore.
- `--galore_quantization` æ˜¯å¦ä½¿ç”¨q-galore. é»˜è®¤å€¼`False`.
- `--galore_proj_quant`: æ˜¯å¦å¯¹SVDåˆ†è§£çŸ©é˜µåšé‡åŒ–, é»˜è®¤`False`.
- `--galore_proj_bits`: SVDé‡åŒ–bitæ•°.
- `--galore_proj_group_size`: SVDé‡åŒ–åˆ†ç»„æ•°.
- `--galore_cos_threshold`: æŠ•å½±çŸ©é˜µæ›´æ–°çš„cosç›¸ä¼¼åº¦é˜ˆå€¼. é»˜è®¤å€¼0.4.
- `--galore_gamma_proj`: åœ¨æŠ•å½±çŸ©é˜µé€æ¸ç›¸ä¼¼åä¼šæ‹‰é•¿æ›´æ–°é—´éš”, æœ¬å‚æ•°ä¸ºæ¯æ¬¡æ‹‰é•¿é—´éš”çš„ç³»æ•°, é»˜è®¤å€¼2.
- `--galore_queue_size`: è®¡ç®—æŠ•å½±çŸ©é˜µç›¸ä¼¼åº¦çš„é˜Ÿåˆ—é•¿åº¦, é»˜è®¤å€¼5.

### LISAå¾®è°ƒå‚æ•°

æ³¨æ„ï¼šLISAä»…æ”¯æŒå…¨å‚æ•°ï¼Œå³`--sft_type full`.

- `--lisa_activated_layers`: é»˜è®¤å€¼`0`, ä»£è¡¨ä¸ä½¿ç”¨LISAï¼Œæ”¹ä¸ºé0ä»£è¡¨éœ€è¦æ¿€æ´»çš„layersä¸ªæ•°ï¼Œå»ºè®®è®¾ç½®ä¸º2æˆ–8.
- `--lisa_step_interval`: é»˜è®¤å€¼`20`, å¤šå°‘iteråˆ‡æ¢å¯åå‘ä¼ æ’­çš„layers.

### UNSLOTHå¾®è°ƒå‚æ•°

unslothæ— æ–°å¢å‚æ•°ï¼Œå¯¹å·²æœ‰å‚æ•°è¿›è¡Œè°ƒèŠ‚å³å¯æ”¯æŒï¼š

```
--tuner_backend unsloth
--sft_type full/lora
--quantization_type 4
```

### LLAMAPROå¾®è°ƒå‚æ•°

- `--llamapro_num_new_blocks`: é»˜è®¤å€¼`4`, æ’å…¥çš„æ–°layersæ€»æ•°.
- `--llamapro_num_groups`: é»˜è®¤å€¼`None`, åˆ†ä¸ºå¤šå°‘ç»„æ’å…¥new_blocks, å¦‚æœä¸º`None`åˆ™ç­‰äº`llamapro_num_new_blocks`, å³æ¯ä¸ªæ–°çš„layerå•ç‹¬æ’å…¥åŸæ¨¡å‹.

### AdaLoRAå¾®è°ƒå‚æ•°

ä»¥ä¸‹å‚æ•°`sft_type`è®¾ç½®ä¸º`adalora`æ—¶ç”Ÿæ•ˆ. adaloraçš„`target_modules`ç­‰å‚æ•°ç»§æ‰¿äºloraçš„å¯¹åº”å‚æ•°, ä½†`lora_dtype`å‚æ•°ä¸ç”Ÿæ•ˆ.

- `--adalora_target_r`: é»˜è®¤å€¼`8`, adaloraçš„å¹³å‡rank.
- `--adalora_init_r`: é»˜è®¤å€¼`12`, adaloraçš„åˆå§‹rank.
- `--adalora_tinit`: é»˜è®¤å€¼`0`, adaloraçš„åˆå§‹warmup.
- `--adalora_tfinal`: é»˜è®¤å€¼`0`, adaloraçš„final warmup.
- `--adalora_deltaT`: é»˜è®¤å€¼`1`, adaloraçš„stepé—´éš”.
- `--adalora_beta1`: é»˜è®¤å€¼`0.85`, adaloraçš„EMAå‚æ•°.
- `--adalora_beta2`: é»˜è®¤å€¼`0.85`, adaloraçš„EMAå‚æ•°.
- `--adalora_orth_reg_weight`: é»˜è®¤å€¼`0.5`, adaloraçš„æ­£åˆ™åŒ–å‚æ•°.

### IA3å¾®è°ƒå‚æ•°

IA3ä½¿ç”¨`target_modules`, `target_regex`, `modules_to_save`ä¸‰ä¸ªå‚æ•°.

ä»¥ä¸‹å‚æ•°`sft_type`è®¾ç½®ä¸º`ia3`æ—¶ç”Ÿæ•ˆ.

- `--ia3_feedforward_modules`: æŒ‡å®šIA3çš„MLPçš„Linearåç§°, è¯¥åç§°å¿…é¡»åœ¨`ia3_target_modules`ä¸­.

### ReFTå¾®è°ƒå‚æ•°

ä»¥ä¸‹å‚æ•°`sft_type`è®¾ç½®ä¸º`reft`æ—¶ç”Ÿæ•ˆ.

> 1. ReFTæ— æ³•åˆå¹¶tuner
> 2. ReFTå’Œgradient_checkpointingä¸å…¼å®¹
> 3. å¦‚æœä½¿ç”¨DeepSpeedé‡åˆ°é—®é¢˜è¯·æš‚æ—¶å¸è½½DeepSpeed

- `--reft_layers`: ReFTåº”ç”¨äºå“ªäº›å±‚ä¸Š, é»˜è®¤ä¸º`None`, ä»£è¡¨æ‰€æœ‰å±‚, å¯ä»¥è¾“å…¥å±‚å·çš„list, ä¾‹å¦‚`--reft_layers 1 2 3 4`
- `--reft_rank`: ReFTçŸ©é˜µçš„rank, é»˜è®¤ä¸º`4`.
- `--reft_intervention_type`: ReFTçš„ç±»å‹, æ”¯æŒ'NoreftIntervention', 'LoreftIntervention', 'ConsreftIntervention', 'LobireftIntervention', 'DireftIntervention', 'NodireftIntervention', é»˜è®¤ä¸º`LoreftIntervention`.
- `--reft_args`: ReFT Interventionä¸­çš„å…¶ä»–æ”¯æŒå‚æ•°, ä»¥json-stringæ ¼å¼è¾“å…¥.

### Ligerå¾®è°ƒå‚æ•°

- `--use_liger`: ä½¿ç”¨liger-kernelè¿›è¡Œè®­ç»ƒ.

## PT å‚æ•°

PTå‚æ•°ç»§æ‰¿äº†sftå‚æ•°ï¼Œå¹¶ä¿®æ”¹äº†éƒ¨åˆ†é»˜è®¤å€¼.
- `--sft_type`: é»˜è®¤å€¼ä¸º`'full'`.
- `--target_modules`: é»˜è®¤å€¼ä¸º`'ALL'`.
- `--lazy_tokenize`: é»˜è®¤å€¼ä¸º`True`.
- `--eval_steps`: é»˜è®¤å€¼ä¸º`500`.

## RLHF å‚æ•°

RLHFå‚æ•°ç»§æ‰¿äº†sftå‚æ•°, é™¤æ­¤ä¹‹å¤–å¢åŠ äº†ä»¥ä¸‹å‚æ•°:
- `--ğŸ”¥rlhf_type`: é€‰æ‹©å¯¹é½ç®—æ³•ï¼Œå¯é€‰é¡¹ä¸º'dpo', 'orpo', 'simpo', 'kto', 'cpo', é»˜è®¤ä¸º`'dpo'`. è®­ç»ƒè„šæœ¬è¯·æŸ¥çœ‹[æ–‡æ¡£](../LLM/äººç±»åå¥½å¯¹é½è®­ç»ƒæ–‡æ¡£.md)
- `--ref_model_type`: é€‰æ‹©å‚è€ƒæ¨¡å‹, åŒmodel_typeå‚æ•°, é»˜è®¤ä¸º`None`, ä¸è®­ç»ƒæ¨¡å‹ä¸€è‡´ã€‚å…¶ä¸­`cpo`, `simpo`, `orpo`ç®—æ³•æ— éœ€é€‰æ‹©ã€‚é€šå¸¸ä¸éœ€è¦è®¾ç½®ã€‚
- `--ref_model_id_or_path`: å‚è€ƒæ¨¡å‹çš„æœ¬åœ°cacheè·¯å¾„, é»˜è®¤ä¸º`None`.
- `--ref_model_revision`: å‚è€ƒæ¨¡å‹ç‰ˆæœ¬, åŒmodel_revisionå‚æ•°, é»˜è®¤ä¸º`None`, ä¸è®­ç»ƒæ¨¡å‹ä¸€è‡´ã€‚é€šå¸¸ä¸éœ€è¦è®¾ç½®ã€‚
- `--beta`: KLæ­£åˆ™é¡¹ç³»æ•°, é»˜è®¤ä¸º`None`, å³`simpo`ç®—æ³•é»˜è®¤ä¸º`2.`, å…¶ä»–ç®—æ³•é»˜è®¤ä¸º`0.1`. å…·ä½“å‚è€ƒ[æ–‡æ¡£](../LLM/äººç±»åå¥½å¯¹é½è®­ç»ƒæ–‡æ¡£.md)
- `--label_smoothing`: æ˜¯å¦ä½¿ç”¨DPO smoothing, é»˜è®¤å€¼ä¸º`0`ï¼Œä¸€èˆ¬è®¾ç½®åœ¨0~0.5ä¹‹é—´.
- `--loss_type`: lossç±»å‹, é»˜è®¤ä¸º`None`, å¦‚æœæ˜¯dpo, cpoåˆ™ä¸º`sigmoid`, å¦‚æœæ˜¯simpoåˆ™ä¸º`simpo`.

### DPOå‚æ•°
- `--ğŸ”¥rpo_alpha`: æ§åˆ¶DPOä¸­åŠ å…¥sft_lossçš„æƒé‡, é»˜è®¤ä¸º`1`. æœ€åçš„lossä¸º`KL_loss + rpo_alpha * sft_loss`.

### CPO/SimPOå‚æ•°
- `--cpo_alpha`: CPO/SimPO loss ä¸­ nll lossçš„ç³»æ•°, é»˜è®¤ä¸º`1.`.
- `--simpo_gamma`: SimPOç®—æ³•ä¸­çš„reward marginé¡¹ï¼Œè®ºæ–‡ä¸­å»ºè®®è®¾ç½®ä¸º0.5-1.5, é»˜è®¤ä¸º`1.`

### KTOå‚æ•°
- `--desirable_weight`: KTOç®—æ³•ä¸­å¯¹desirable responseçš„lossæƒé‡ $\lambda_D$ ï¼Œé»˜è®¤ä¸º`1.`
- `--undesirable_weight`: KTOè®ºæ–‡ä¸­å¯¹undesirable responseçš„lossæƒé‡ $\lambda_U$ , é»˜è®¤ä¸º`1.`. åˆ†åˆ«ç”¨$n_d$ å’Œ$n_u$ è¡¨ç¤ºæ•°æ®é›†ä¸­desirable exampleså’Œundesirable examplesçš„æ•°é‡ï¼Œè®ºæ–‡ä¸­æ¨èæ§åˆ¶ $\frac{\lambda_D n_D}{\lambda_Un_U} \in [1,\frac{4}{3}]$

### PPOå‚æ•°
- `--reward_model_id_or_path` : å¥–åŠ±æ¨¡å‹çš„æœ¬åœ°cacheè·¯å¾„, éœ€è¦åŒ…å«value_headçš„æƒé‡(`value_head.safetensors`æˆ– `value_head.bin`)
- `--reward_model_type`: å¥–åŠ±æ¨¡å‹ç±»å‹, åŒmodel_typeå‚æ•°
- `--reward_model_revision`: å¥–åŠ±æ¨¡å‹ç‰ˆæœ¬, åŒmodel_revisionå‚æ•°
- `--local_rollout_forward_batch_size`: æ¯æ¬¡æ•°æ®é‡‡æ ·çš„æ‰¹é‡å¤§å°, é»˜è®¤ä¸º64
- `--whiten_rewards`: å¯¹å¥–åŠ±è¿›è¡Œå½’ä¸€åŒ–å¤„ç†, é»˜è®¤ä¸ºFalse
- `--kl_coef`: KLæ•£åº¦é¡¹çš„ç³»æ•°, é»˜è®¤ä¸º0.05
- `--cliprange`: PPOç­–ç•¥æŸå¤±å‡½æ•°ä¸­çš„clipèŒƒå›´, é»˜è®¤ä¸º0.2
- `--vf_coef`: ä»·å€¼æŸå¤±å‡½æ•°ç³»æ•°, é»˜è®¤ä¸º0.1
- `--cliprange_value`: PPOä»·å€¼æŸå¤±å‡½æ•°ä¸­çš„clipèŒƒå›´, é»˜è®¤ä¸º0.2
- `--gamma`: ç´¯è®¡å¥–åŠ±çš„æŠ˜æ‰£å› å­, é»˜è®¤ä¸º1.0
- `--lam`: [GAE](https://arxiv.org/abs/1506.02438)ä¸­çš„lambdaç³»æ•°, é»˜è®¤ä¸º0.95

## infer merge-lora å‚æ•°

- `--ğŸ”¥model_type`: é»˜è®¤å€¼ä¸º`None`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--ğŸ”¥model_id_or_path`: é»˜è®¤å€¼ä¸º`None`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹. æ¨èä½¿ç”¨model_typeçš„æ–¹å¼æŒ‡å®š.
- `--model_revision`: é»˜è®¤å€¼ä¸º`None`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹. å¦‚æœ`model_id_or_path`ä¸ºNoneæˆ–è€…æ˜¯æœ¬åœ°çš„æ¨¡å‹ç›®å½•, åˆ™è¯¥å‚æ•°å¤±æ•ˆ.
- `--ğŸ”¥sft_type`: é»˜è®¤å€¼ä¸º`'lora'`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--ğŸ”¥template_type`: é»˜è®¤å€¼ä¸º`'AUTO'`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--ğŸ”¥infer_backend`: ä½ å¯ä»¥é€‰æ‹©'AUTO', 'vllm', 'pt'. é»˜è®¤ä½¿ç”¨'AUTO', è¿›è¡Œæ™ºèƒ½é€‰æ‹©, å³å¦‚æœæ²¡æœ‰ä¼ å…¥`ckpt_dir`æˆ–ä½¿ç”¨å…¨å‚æ•°å¾®è°ƒ, å¹¶ä¸”å®‰è£…äº†vllmä¸”æ¨¡å‹æ”¯æŒvllmåˆ™ä½¿ç”¨vllmå¼•æ“, å¦åˆ™ä½¿ç”¨åŸç”Ÿtorchè¿›è¡Œæ¨ç†. vllmç¯å¢ƒå‡†å¤‡å¯ä»¥å‚è€ƒ[VLLMæ¨ç†åŠ é€Ÿä¸éƒ¨ç½²](VLLMæ¨ç†åŠ é€Ÿä¸éƒ¨ç½².md#ç¯å¢ƒå‡†å¤‡), vllmæ”¯æŒçš„æ¨¡å‹å¯ä»¥æŸ¥çœ‹[æ”¯æŒçš„æ¨¡å‹](../Instruction/æ”¯æŒçš„æ¨¡å‹å’Œæ•°æ®é›†.md#æ¨¡å‹).
- `--ğŸ”¥ckpt_dir`: å¿…å¡«é¡¹, å€¼ä¸ºSFTé˜¶æ®µä¿å­˜çš„checkpointè·¯å¾„, e.g. `'/path/to/your/vx-xxx/checkpoint-xxx'`.
- `--load_args_from_ckpt_dir`: æ˜¯å¦ä»`ckpt_dir`çš„`sft_args.json`æ–‡ä»¶ä¸­è¯»å–æ¨¡å‹é…ç½®ä¿¡æ¯. é»˜è®¤æ˜¯`True`.
- `--ğŸ”¥load_dataset_config`: è¯¥å‚æ•°åªæœ‰åœ¨`--load_args_from_ckpt_dir true`æ—¶æ‰ç”Ÿæ•ˆ. å³æ˜¯å¦ä»`ckpt_dir`çš„`sft_args.json`æ–‡ä»¶ä¸­è¯»å–æ•°æ®é›†ç›¸å…³çš„é…ç½®ä¿¡æ¯. é»˜è®¤ä¸º`False`.
- `--eval_human`: ä½¿ç”¨æ•°æ®é›†ä¸­çš„éªŒè¯é›†éƒ¨åˆ†è¿›è¡Œè¯„ä¼°è¿˜æ˜¯ä½¿ç”¨äººå·¥çš„æ–¹å¼è¯„ä¼°. é»˜è®¤å€¼ä¸º`None`, è¿›è¡Œæ™ºèƒ½é€‰æ‹©,  å¦‚æœæ²¡æœ‰ä»»ä½•æ•°æ®é›†(å«è‡ªå®šä¹‰æ•°æ®é›†)ä¼ å…¥, åˆ™ä¼šä½¿ç”¨äººå·¥è¯„ä¼°çš„æ–¹å¼. å¦‚æœæœ‰æ•°æ®é›†ä¼ å…¥, åˆ™ä¼šä½¿ç”¨æ•°æ®é›†æ–¹å¼è¯„ä¼°.
- `--device_map_config`: é»˜è®¤å€¼ä¸º`None`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--device_max_memory`: é»˜è®¤å€¼ä¸º`[]`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--seed`: é»˜è®¤å€¼ä¸º`42`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--dtype`: é»˜è®¤å€¼ä¸º`'AUTO`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--model_kwargs`: é»˜è®¤å€¼ä¸º`'None`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--ğŸ”¥dataset`: é»˜è®¤å€¼ä¸º`[]`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--ğŸ”¥val_dataset`: é»˜è®¤ä¸º`[]`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--dataset_seed`: é»˜è®¤å€¼ä¸º`None`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--dataset_test_ratio`: é»˜è®¤å€¼ä¸º`0.01`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--ğŸ”¥show_dataset_sample`: è¡¨ç¤ºæƒ³è¦è¯„ä¼°å’Œå±•ç¤ºçš„éªŒè¯é›†çš„æ•°é‡, é»˜è®¤å€¼ä¸º`-1`.
- `--system`: é»˜è®¤å€¼ä¸º`None`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--tools_prompt`: é»˜è®¤å€¼ä¸º`react_en`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--max_length`: é»˜è®¤å€¼ä¸º`-1`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--truncation_strategy`: é»˜è®¤æ˜¯`'delete'`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--check_dataset_strategy`: é»˜è®¤å€¼ä¸º`'none'`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--custom_train_dataset_path`: é»˜è®¤å€¼ä¸º`[]`. è¯¥å‚æ•°å·²åºŸå¼ƒ, è¯·ä½¿ç”¨`--dataset {dataset_path}`.
- `--custom_val_dataset_path`: é»˜è®¤å€¼ä¸º`[]`. è¯¥å‚æ•°å·²åºŸå¼ƒ. è¯·ä½¿ç”¨`--val_dataset {dataset_path}`.
- `--quantization_bit`: é»˜è®¤å€¼ä¸º0. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--quant_method`: é‡åŒ–æ–¹æ³•, é»˜è®¤ä¸º`None`. ä½ å¯ä»¥é€‰æ‹©ä¸º'bnb', 'hqq', 'eetq'.
- `--hqq_axis`: hqqé‡åŒ–å‚æ•°ï¼Œè¡¨ç¤ºæ‰§è¡Œåˆ†ç»„çš„æ‰€æ²¿çš„è½´ï¼Œé»˜è®¤ä¸º`0`, å¯é€‰å€¼åŒ…æ‹¬`0`,`1`
- `--hqq_dynamic_config_path`: hqqæœ¬åœ°é…ç½®è·¯å¾„ï¼Œæ”¯æŒå¯¹æ¨¡å‹ä¸åŒå±‚é…ç½®ä¸åŒçš„é‡åŒ–é…ç½®ï¼Œ[å‚è€ƒ](https://github.com/mobiusml/hqq?tab=readme-ov-file#custom-quantization-configurations-%EF%B8%8F)
- `--bnb_4bit_comp_dtype`: é»˜è®¤å€¼ä¸º`'AUTO'`.  å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹. è‹¥`quantization_bit`è®¾ç½®ä¸º0, åˆ™è¯¥å‚æ•°å¤±æ•ˆ.
- `--bnb_4bit_quant_type`: é»˜è®¤å€¼ä¸º`'nf4'`.  å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹. è‹¥`quantization_bit`è®¾ç½®ä¸º0, åˆ™è¯¥å‚æ•°å¤±æ•ˆ.
- `--bnb_4bit_use_double_quant`: é»˜è®¤å€¼ä¸º`True`.  å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹. è‹¥`quantization_bit`è®¾ç½®ä¸º0, åˆ™è¯¥å‚æ•°å¤±æ•ˆ.
- `--bnb_4bit_quant_storage`: é»˜è®¤å€¼ä¸º`True`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹. è‹¥`quantization_bit`è®¾ç½®ä¸º0, åˆ™è¯¥å‚æ•°å¤±æ•ˆ.
- `--ğŸ”¥max_new_tokens`: ç”Ÿæˆæ–°tokençš„æœ€å¤§æ•°é‡, é»˜è®¤å€¼ä¸º`2048`. å¦‚æœä½¿ç”¨éƒ¨ç½², è¯·é€šè¿‡åœ¨å®¢æˆ·ç«¯ä¼ å…¥`max_tokens`æ¥æ§åˆ¶æœ€å¤§ç”Ÿæˆçš„tokensæ•°.
- `--ğŸ”¥do_sample`: å‚è€ƒæ–‡æ¡£: [https://huggingface.co/docs/transformers/main_classes/text_generation](https://huggingface.co/docs/transformers/main_classes/text_generation). é»˜è®¤å€¼ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config.
- `--temperature`: é»˜è®¤å€¼ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`do_sample`è®¾ç½®ä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ. è¯¥å‚æ•°ä¼šåœ¨éƒ¨ç½²å‚æ•°ä¸­ä½œä¸ºé»˜è®¤å€¼ä½¿ç”¨.
- `--top_k`: é»˜è®¤å€¼ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`do_sample`è®¾ç½®ä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ. è¯¥å‚æ•°ä¼šåœ¨éƒ¨ç½²å‚æ•°ä¸­ä½œä¸ºé»˜è®¤å€¼ä½¿ç”¨.
- `--top_p`: é»˜è®¤å€¼ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°åªæœ‰åœ¨`do_sample`è®¾ç½®ä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ. è¯¥å‚æ•°ä¼šåœ¨éƒ¨ç½²å‚æ•°ä¸­ä½œä¸ºé»˜è®¤å€¼ä½¿ç”¨.
- `--repetition_penalty`: é»˜è®¤å€¼ä¸º`None`, ç»§æ‰¿æ¨¡å‹çš„generation_config. è¯¥å‚æ•°ä¼šåœ¨éƒ¨ç½²å‚æ•°ä¸­ä½œä¸ºé»˜è®¤å€¼ä½¿ç”¨.
- `--num_beams`: é»˜è®¤ä¸º`1`.
- `--use_flash_attn`: é»˜è®¤å€¼ä¸º`None`, å³ä¸º'auto'. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--ignore_args_error`: é»˜è®¤å€¼ä¸º`False`, å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--stream`: æ˜¯å¦ä½¿ç”¨æµå¼è¾“å‡º, é»˜è®¤ä¸º`True`. è¯¥å‚æ•°åªæœ‰åœ¨ä½¿ç”¨æ•°æ®é›†è¯„ä¼°å¹¶ä¸”verboseä¸ºTrueæ—¶æ‰ç”Ÿæ•ˆ.
- `--ğŸ”¥merge_lora`: æ˜¯å¦å°†loraæƒé‡mergeåˆ°åŸºæ¨¡å‹ä¸­, å¹¶ä¿å­˜å®Œæ•´çš„æƒé‡, é»˜è®¤ä¸º`False`. æƒé‡ä¼šä¿å­˜åœ¨`ckpt_dir`çš„åŒçº§ç›®å½•ä¸­, e.g. `'/path/to/your/vx-xxx/checkpoint-xxx-merged'`ç›®å½•ä¸‹.
- `--merge_device_map`: merge-loraæ—¶ä½¿ç”¨çš„device_map, é»˜è®¤ä¸º`None`, ä¸ºå‡å°‘æ˜¾å­˜å ç”¨, åœ¨ä»…æœ‰merge-loraè¿‡ç¨‹æ—¶ä½¿ç”¨`auto`ï¼Œå…¶ä»–æƒ…å†µé»˜è®¤ä½¿ç”¨`cpu`.
- `--save_safetensors`: ä¿å­˜æˆ`safetensors`æ–‡ä»¶è¿˜æ˜¯`bin`æ–‡ä»¶. é»˜è®¤ä¸º`True`.
- `--overwrite_generation_config`: æ˜¯å¦å°†è¯„ä¼°æ‰€ä½¿ç”¨çš„generation_configä¿å­˜æˆ`generation_config.json`æ–‡ä»¶, é»˜è®¤ä¸º`False`.
- `--ğŸ”¥verbose`: å¦‚æœè®¾ç½®ä¸ºFalse, åˆ™ä½¿ç”¨tqdmæ ·å¼æ¨ç†. å¦‚æœè®¾ç½®ä¸ºTrue, åˆ™è¾“å‡ºæ¨ç†çš„query, response, label. é»˜è®¤ä¸º`None`, è¿›è¡Œè‡ªåŠ¨é€‰æ‹©, å³`len(val_dataset) >= 100`æ—¶, è®¾ç½®ä¸ºFalse, å¦åˆ™è®¾ç½®ä¸ºTrue. è¯¥å‚æ•°åªæœ‰åœ¨ä½¿ç”¨æ•°æ®é›†è¯„ä¼°æ—¶ç”Ÿæ•ˆ.
- `--lora_modules`: é»˜è®¤ä¸º`[]`, è¾“å…¥çš„æ ¼å¼ä¸º`'{lora_name}={lora_path}'`, e.g. `--lora_modules lora_name1=lora_path1 lora_name2=lora_path2`. `ckpt_dir`ä¼šä»¥`f'default-lora={args.ckpt_dir}'`çš„å½¢å¼åŠ å…¥args.lora_modules.
- `--custom_register_path`: é»˜è®¤ä¸º`None`. ä¼ å…¥`.py`æ–‡ä»¶, ç”¨äºæ³¨å†Œæ¨¡æ¿ã€æ¨¡å‹å’Œæ•°æ®é›†.
- `--custom_dataset_info`: é»˜è®¤ä¸º`None`, ä¼ å…¥å¤–ç½®dataset_info.jsonçš„è·¯å¾„ã€jsonå­—ç¬¦ä¸²æˆ–è€…dict. ç”¨äºæ‹“å±•æ•°æ®é›†.
- `--rope_scaling`: é»˜è®¤å€¼`None`, æ”¯æŒ`linear`å’Œ`dynamic`ä¸¤ç§scalingæ–¹å¼, å½“`max_length`è¶…è¿‡`max_position_embeddings`æ—¶ä½¿ç”¨. éœ€è¦åŒæ—¶æŒ‡å®š`--max_length`å‚æ•°.

### vLLM å‚æ•°
å‚è€ƒæ–‡æ¡£: [https://docs.vllm.ai/en/latest/models/engine_args.html](https://docs.vllm.ai/en/latest/models/engine_args.html)

- `--ğŸ”¥gpu_memory_utilization`: åˆå§‹åŒ–vllmå¼•æ“`EngineArgs`çš„å‚æ•°, é»˜è®¤ä¸º`0.9`. è¯¥å‚æ•°åªæœ‰åœ¨ä½¿ç”¨vllmæ—¶æ‰ç”Ÿæ•ˆ. VLLMæ¨ç†åŠ é€Ÿå’Œéƒ¨ç½²å¯ä»¥æŸ¥çœ‹[VLLMæ¨ç†åŠ é€Ÿä¸éƒ¨ç½²](../LLM/VLLMæ¨ç†åŠ é€Ÿä¸éƒ¨ç½².md).
- `--ğŸ”¥tensor_parallel_size`: åˆå§‹åŒ–vllmå¼•æ“`EngineArgs`çš„å‚æ•°, é»˜è®¤ä¸º`1`. è¯¥å‚æ•°åªæœ‰åœ¨ä½¿ç”¨vllmæ—¶æ‰ç”Ÿæ•ˆ.
- `--max_num_seqs`: åˆå§‹åŒ–vllmå¼•æ“`EngineArgs`çš„å‚æ•°, é»˜è®¤ä¸º`256`. è¯¥å‚æ•°åªæœ‰åœ¨ä½¿ç”¨vllmæ—¶æ‰ç”Ÿæ•ˆ.
- `--ğŸ”¥max_model_len`: è¦†ç›–æ¨¡å‹çš„max_model_len, é»˜è®¤ä¸º`None`. è¯¥å‚æ•°åªæœ‰åœ¨ä½¿ç”¨vllmæ—¶æ‰ç”Ÿæ•ˆ.
- `--disable_custom_all_reduce`: æ˜¯å¦ç¦ç”¨è‡ªå®šä¹‰çš„all-reduce kernel, è€Œå›é€€åˆ°NCCL. é»˜è®¤ä¸º`True`, è¿™ä¸vLLMçš„é»˜è®¤å€¼ä¸åŒ.
- `--enforce_eager`: vllmä½¿ç”¨pytorch eageræ¨¡å¼è¿˜æ˜¯å»ºç«‹cuda graph. é»˜è®¤ä¸º`False`. è®¾ç½®ä¸ºTrueå¯ä»¥èŠ‚çº¦æ˜¾å­˜, ä½†ä¼šå½±å“æ•ˆç‡.
- `--limit_mm_per_prompt`: æ§åˆ¶vllmä½¿ç”¨å¤šå›¾, é»˜è®¤ä¸º`None`. ä¾‹å¦‚ä¼ å…¥`--limit_mm_per_prompt '{"image": 10, "video": 5}'`.
- `--vllm_enable_lora`: é»˜è®¤ä¸º`False`. æ˜¯å¦å¼€å¯vllmå¯¹loraçš„æ”¯æŒ. å…·ä½“å¯ä»¥æŸ¥çœ‹[VLLM & LoRA](../LLM/VLLMæ¨ç†åŠ é€Ÿä¸éƒ¨ç½².md#vllm--lora).
- `--vllm_max_lora_rank`: é»˜è®¤ä¸º`16`. vllmå¯¹äºloraæ”¯æŒçš„å‚æ•°.
- `--lora_modules`: å·²ä»‹ç».

### lmdeploy å‚æ•°
å‚è€ƒæ–‡æ¡£: [https://lmdeploy.readthedocs.io/en/latest/api/pipeline.html#turbomindengineconfig](https://lmdeploy.readthedocs.io/en/latest/api/pipeline.html#turbomindengineconfig)

- `--ğŸ”¥tp`: tensorå¹¶è¡Œ, ç”¨äºåˆå§‹åŒ–lmdeployå¼•æ“çš„å‚æ•°, é»˜è®¤å€¼ä¸º`1`.
- `--cache_max_entry_count`: åˆå§‹åŒ–lmdeployå¼•æ“çš„å‚æ•°, é»˜è®¤å€¼ä¸º`0.8`.
- `--quant_policy`: Key-Value Cacheé‡åŒ–, åˆå§‹åŒ–lmdeployå¼•æ“çš„å‚æ•°, é»˜è®¤å€¼ä¸º`0`, ä½ å¯ä»¥è®¾ç½®ä¸º4, 8.
- `--vision_batch_size`: åˆå§‹åŒ–lmdeployå¼•æ“çš„å‚æ•°, é»˜è®¤å€¼ä¸º`1`. è¯¥å‚æ•°åªæœ‰åœ¨ä½¿ç”¨å¤šæ¨¡æ€æ¨¡å‹æ—¶ç”Ÿæ•ˆ.


## export å‚æ•°

exportå‚æ•°ç»§æ‰¿äº†inferå‚æ•°, é™¤æ­¤ä¹‹å¤–å¢åŠ äº†ä»¥ä¸‹å‚æ•°:

- `--to_peft_format`: é»˜è®¤ä¸º`False`. å°†loraçš„swift formatï¼ˆ`--tuner_backend swift`ï¼‰è½¬æˆpeft format.
- `--ğŸ”¥merge_lora`: é»˜è®¤ä¸º`False`. è¯¥å‚æ•°å·²åœ¨InferArgumentsä¸­å®šä¹‰, ä¸å±äºæ–°å¢å‚æ•°. æ˜¯å¦å°†loraæƒé‡mergeåˆ°åŸºæ¨¡å‹ä¸­, å¹¶ä¿å­˜å®Œæ•´çš„æƒé‡. æƒé‡ä¼šä¿å­˜åœ¨`ckpt_dir`çš„åŒçº§ç›®å½•ä¸­, e.g. `'/path/to/your/vx-xxx/checkpoint-xxx-merged'`ç›®å½•ä¸‹.
- `--ğŸ”¥quant_bits`: é‡åŒ–çš„bitsæ•°. é»˜è®¤ä¸º`0`, å³ä¸è¿›è¡Œé‡åŒ–. å¦‚æœä½ è®¾ç½®äº†`--quant_method awq`, ä½ å¯ä»¥è®¾ç½®ä¸º`4`è¿›è¡Œ4bitsé‡åŒ–. å¦‚æœä½ è®¾ç½®äº†`--quant_method gptq`, ä½ å¯ä»¥è®¾ç½®ä¸º`2`,`3`,`4`,`8`è¿›è¡Œå¯¹åº”bitsçš„é‡åŒ–. å¦‚æœå¯¹åŸå§‹æ¨¡å‹è¿›è¡Œé‡åŒ–, æƒé‡ä¼šä¿å­˜åœ¨`f'{args.model_type}-{args.quant_method}-int{args.quant_bits}'`ç›®å½•ä¸­. å¦‚æœå¯¹å¾®è°ƒåæ¨¡å‹è¿›è¡Œé‡åŒ–, æƒé‡ä¼šä¿å­˜åœ¨`ckpt_dir`çš„åŒçº§ç›®å½•ä¸­, e.g. `f'/path/to/your/vx-xxx/checkpoint-xxx-{args.quant_method}-int{args.quant_bits}'`ç›®å½•ä¸‹.
- `--ğŸ”¥quant_method`: é‡åŒ–æ–¹æ³•, é»˜è®¤ä¸º`'awq'`. ä½ å¯ä»¥é€‰æ‹©ä¸º'awq', 'gptq', 'bnb'.
- `--ğŸ”¥dataset`: è¯¥å‚æ•°å·²åœ¨InferArgumentsä¸­å®šä¹‰, åœ¨exportæ—¶å«ä¹‰ä¸ºé‡åŒ–æ•°æ®é›†. é»˜è®¤ä¸º`[]`. æ›´å¤šç»†èŠ‚: åŒ…æ‹¬å¦‚ä½•è‡ªå®šä¹‰é‡åŒ–æ•°æ®é›†, å¯ä»¥å‚è€ƒ[LLMé‡åŒ–ä¸å¯¼å‡ºæ–‡æ¡£](LLMé‡åŒ–ä¸å¯¼å‡ºæ–‡æ¡£.md).
- `--quant_n_samples`: é‡åŒ–å‚æ•°, é»˜è®¤ä¸º`256`. å½“è®¾ç½®ä¸º`--quant_method awq`æ—¶, å¦‚æœå‡ºç°é‡åŒ–çš„æ—¶å€™OOM, å¯ä»¥é€‚åº¦é™ä½`--quant_n_samples`å’Œ`--quant_seqlen`. `--quant_method gptq`é€šå¸¸ä¸ä¼šå‡ºç°é‡åŒ–OOM.
- `--quant_seqlen`: é‡åŒ–å‚æ•°, é»˜è®¤ä¸º`2048`.
- `--quant_batch_size`: é‡åŒ–æ•°æ®é›†çš„batch_sizeï¼Œé»˜è®¤ä¸º`1`.
- `--quant_device_map`: é»˜è®¤ä¸º`None`. ä½ å¯ä»¥æŒ‡å®šä¸º'cuda:0', 'auto', 'cpu'ç­‰, è¡¨ç¤ºé‡åŒ–æ—¶æ¨¡å‹å¯¼å…¥çš„è®¾å¤‡.
- `--quant_output_dir`: é»˜è®¤ä¸º`None`, é»˜è®¤çš„quant_output_dirä¼šè¢«æ‰“å°åœ¨å‘½ä»¤è¡Œä¸­.
- `--push_to_hub`: é»˜è®¤ä¸º`False`. æ˜¯å¦å°†æœ€åçš„`ckpt_dir`pushåˆ°ModelScope Hubä¸­. å¦‚æœä½ æŒ‡å®šäº†`merge_lora`, åˆ™å°†æ¨é€å…¨é‡å‚æ•°; å¦‚æœä½ è¿˜æŒ‡å®šäº†`quant_bits`, åˆ™å°†æ¨é€é‡åŒ–åçš„æ¨¡å‹.
- `--hub_model_id`: é»˜è®¤ä¸º`None`. æ¨é€åˆ°çš„ModelScope Hubçš„model_id. å¦‚æœ`push_to_hub`è®¾ç½®ä¸ºTrue, è¯¥å‚æ•°å¿…é¡»è¢«è®¾ç½®.
- `--hub_token`: é»˜è®¤ä¸º`None`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--hub_private_repo`: é»˜è®¤ä¸º`False`. å…·ä½“çš„å‚æ•°ä»‹ç»å¯ä»¥åœ¨`sftå‘½ä»¤è¡Œå‚æ•°`ä¸­æŸ¥çœ‹.
- `--commit_message`: é»˜è®¤æ˜¯`'update files'`.
- `--to_ollama`: è½¬ä¸ºollamaå¯¼å‡º.
- `--ollama_output_dir`: ollamaè¾“å‡ºç›®å½•. é»˜è®¤å­˜å‚¨åœ¨å½“å‰ç›®å½•ä¸‹çš„`æ¨¡å‹ç±»å‹-ollama`æ–‡ä»¶å¤¹å†….

## evalå‚æ•°

evalå‚æ•°ç»§æ‰¿äº†inferå‚æ•°ï¼Œé™¤æ­¤ä¹‹å¤–å¢åŠ äº†ä»¥ä¸‹å‚æ•°ï¼šï¼ˆæ³¨æ„: inferä¸­çš„generation_configå‚æ•°å°†å¤±æ•ˆ, ç”±[evalscope](https://github.com/modelscope/eval-scope)æ§åˆ¶.ï¼‰

- `--ğŸ”¥eval_dataset`: è¯„æµ‹çš„å®˜æ–¹æ•°æ®é›†, é»˜è®¤å€¼ä¸ºç©º, ä»£è¡¨å…¨é‡è¯„æµ‹, æ³¨æ„æŒ‡å®šäº†custom_eval_configæ—¶æœ¬å‚æ•°ä¸ç”Ÿæ•ˆ. [æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„è¯„æµ‹é›†](LLMè¯„æµ‹æ–‡æ¡£.md#èƒ½åŠ›ä»‹ç»).
- `--eval_few_shot`: æ¯ä¸ªè¯„æµ‹é›†çš„å­æ•°æ®é›†çš„few-shotä¸ªæ•°, é»˜è®¤ä¸º`None`, å³ä½¿ç”¨æ•°æ®é›†çš„é»˜è®¤é…ç½®. **æœ¬å‚æ•°æš‚æ—¶åºŸå¼ƒ**
- `--eval_limit`: æ¯ä¸ªè¯„æµ‹é›†çš„å­æ•°æ®é›†çš„é‡‡æ ·æ•°é‡, é»˜è®¤ä¸º`None`ä»£è¡¨å…¨é‡è¯„æµ‹. å¯ä»¥ä¼ å…¥æ•´æ•°, è¡¨ç¤ºæ¯ä¸ªæ•°æ®é›†çš„è¯„æµ‹æ•°é‡, ä¹Ÿå¯ä»¥ä¼ å…¥string, å¦‚`[10:20]`, ä»£è¡¨åˆ‡ç‰‡.
- `--name`: ç”¨äºåŒºåˆ†ç›¸åŒé…ç½®è¯„ä¼°çš„ç»“æœå­˜å‚¨è·¯å¾„. å¦‚: `{eval_output_dir}/{name}`, é»˜è®¤åœ¨ï¼š`eval_outputs/defaults`, å…¶å†…éƒ¨å­˜åœ¨ä»¥æ—¶é—´å‘½åçš„æ–‡ä»¶å¤¹æ¥æ‰¿è½½æ¯æ¬¡è¯„æµ‹ç»“æœ.
- `--eval_url`: OpenAIæ ‡å‡†çš„æ¨¡å‹è°ƒç”¨æ¥å£, ä¾‹å¦‚`http://127.0.0.1:8000/v1`. å¦‚æœä½¿ç”¨éƒ¨ç½²çš„æ–¹å¼è¯„ä¼°, åˆ™éœ€è¦è¿›è¡Œè®¾ç½®, é€šå¸¸ä¸éœ€è¦è®¾ç½®. é»˜è®¤ä¸º`None`.
  ```shell
  swift eval --eval_url http://127.0.0.1:8000/v1 --eval_is_chat_model true --model_type gpt4 --eval_token xxx
  ```
- `--eval_token`: OpenAIæ ‡å‡†çš„æ¨¡å‹è°ƒç”¨æ¥å£çš„token, é»˜è®¤ä¸º`'EMPTY'`, ä»£è¡¨æ²¡æœ‰token.
- `--eval_is_chat_model`: å¦‚æœ`eval_url`ä¸ä¸ºç©º, åˆ™éœ€è¦ä¼ å…¥æœ¬å€¼åˆ¤æ–­æ˜¯å¦ä¸º`chat`æ¨¡å‹, Falseä»£è¡¨ä¸º`base`æ¨¡å‹. é»˜è®¤ä¸º`None`.
- `--custom_eval_config`: ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®é›†è¿›è¡Œè¯„æµ‹, éœ€è¦æ˜¯ä¸€ä¸ªæœ¬åœ°å­˜åœ¨çš„æ–‡ä»¶è·¯å¾„, æ–‡ä»¶æ ¼å¼è¯¦è§[è‡ªå®šä¹‰è¯„æµ‹é›†](LLMè¯„æµ‹æ–‡æ¡£.md#è‡ªå®šä¹‰è¯„æµ‹é›†). é»˜è®¤ä¸º`None`.
- `--eval_use_cache`: æ˜¯å¦ä½¿ç”¨å·²ç»ç”Ÿæˆçš„è¯„æµ‹ç¼“å­˜, ä½¿åšè¿‡çš„è¯„æµ‹ä¸ä¼šé‡æ–°è¿è¡Œè€Œåªæ˜¯é‡æ–°ç”Ÿæˆè¯„æµ‹ç»“æœ. é»˜è®¤`False`.
- `--eval_output_dir`: è¯„æµ‹ç»“æœè¾“å‡ºè·¯å¾„, é»˜è®¤æ˜¯å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„`eval_outputs`è·¯å¾„.
- `--eval_batch_size`: è¯„æµ‹çš„è¾“å…¥batch_size, é»˜è®¤æ˜¯8
- `--eval_nproc`: å¹¶å‘æ•°, æ›´å¤§çš„å¹¶å‘æ•°å¯ä»¥æ›´å¿«è¯„æµ‹, ä½†æ˜¾å­˜å ç”¨ä¹Ÿæ›´é«˜, é»˜è®¤å€¼16. æœ¬å‚æ•°ä»…å¯¹å¤šæ¨¡æ€è¯„æµ‹ç”Ÿæ•ˆ.
- `--deploy_timeout`: è¯„æµ‹ä¹‹å‰ä¼šå¯åŠ¨æ¨¡å‹éƒ¨ç½², è¯¥å‚æ•°è®¾ç½®éƒ¨ç½²çš„ç­‰å¾…è¶…æ—¶æ—¶é•¿, é»˜è®¤å€¼ä¸º`1800`, ä»£è¡¨30åˆ†é’Ÿ.


## app-ui å‚æ•°

app-uiå‚æ•°ç»§æ‰¿äº†inferå‚æ•°, é™¤æ­¤ä¹‹å¤–å¢åŠ äº†ä»¥ä¸‹å‚æ•°:

- `--host`: é»˜è®¤ä¸º`'127.0.0.1'`. ä¼ é€’ç»™gradioçš„`demo.queue().launch(...)`å‡½æ•°.
- `--port`: é»˜è®¤ä¸º`7860`. ä¼ é€’ç»™gradioçš„`demo.queue().launch(...)`å‡½æ•°.
- `--share`: é»˜è®¤ä¸º`False`. ä¼ é€’ç»™gradioçš„`demo.queue().launch(...)`å‡½æ•°.

## deploy å‚æ•°

deployå‚æ•°ç»§æ‰¿äº†inferå‚æ•°, é™¤æ­¤ä¹‹å¤–å¢åŠ äº†ä»¥ä¸‹å‚æ•°:

- `--host`: é»˜è®¤ä¸º`'0.0.0.0'`.
- `--port`: é»˜è®¤ä¸º`8000`.
- `--api_key`: é»˜è®¤ä¸º`None`, å³ä¸å¯¹è¯·æ±‚è¿›è¡Œapi_keyéªŒè¯.
- `--ssl_keyfile`: é»˜è®¤ä¸º`None`.
- `--ssl_certfile`: é»˜è®¤ä¸º`None`.
- `--verbose`: æ˜¯å¦å¯¹è¯·æ±‚å†…å®¹è¿›è¡Œæ‰“å°, é»˜è®¤ä¸º`True`.
- `--log_interval`: å¯¹ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œæ‰“å°çš„é—´éš”, å•ä½ä¸ºç§’. é»˜è®¤ä¸º`10`. å¦‚æœè®¾ç½®ä¸º`0`, è¡¨ç¤ºä¸æ‰“å°ç»Ÿè®¡ä¿¡æ¯.

## web-ui å‚æ•°

- `--ğŸ”¥host`: é»˜è®¤ä¸º`'127.0.0.1'`. è¦ä½¿å…¶åœ¨éæœ¬æœºä¸Šå¯è®¿é—®, å¯è®¾ç½®ä¸º'0.0.0.0'.
- `--port`: é»˜è®¤ä¸º`7860`.
- `--lang`: é»˜è®¤ä¸º`'zh'`.
- `--share`: é»˜è®¤ä¸º`False`.
