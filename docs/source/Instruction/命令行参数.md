# å‘½ä»¤è¡Œå‚æ•°

å‘½ä»¤è¡Œå‚æ•°çš„ä»‹ç»ä¼šåˆ†ä¸ºåŸºæœ¬å‚æ•°ï¼ŒåŸå­å‚æ•°ã€é›†æˆå‚æ•°å’Œç‰¹å®šæ¨¡å‹å‚æ•°ã€‚**å‘½ä»¤è¡Œæœ€ç»ˆä½¿ç”¨çš„å‚æ•°åˆ—è¡¨ä¸ºé›†æˆå‚æ•°ã€‚é›†æˆå‚æ•°ç»§æ‰¿è‡ªåŸºæœ¬å‚æ•°å’Œä¸€äº›åŸå­å‚æ•°**ã€‚ç‰¹å®šæ¨¡å‹å‚æ•°æ˜¯é’ˆå¯¹äºå…·ä½“æ¨¡å‹çš„å‚æ•°ï¼Œå¯ä»¥é€šè¿‡`--model_kwargs'`æˆ–è€…ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ã€‚Megatron-SWIFTå‘½ä»¤è¡Œå‚æ•°ä»‹ç»å¯ä»¥åœ¨[Megatron-SWIFTè®­ç»ƒæ–‡æ¡£](../Megatron-SWIFT/å‘½ä»¤è¡Œå‚æ•°.md)ä¸­æ‰¾åˆ°ã€‚

**æç¤ºï¼š**
- å‘½ä»¤è¡Œä¼ å…¥listä½¿ç”¨ç©ºæ ¼éš”å¼€å³å¯ã€‚ä¾‹å¦‚ï¼š`--dataset <dataset_path1> <dataset_path2>`ã€‚
- å‘½ä»¤è¡Œä¼ å…¥dictä½¿ç”¨jsonã€‚ä¾‹å¦‚ï¼š`--model_kwargs '{"fps_max_frames": 12}'`ã€‚
- å¸¦ğŸ”¥çš„å‚æ•°ä¸ºé‡è¦å‚æ•°ï¼Œåˆšç†Ÿæ‚‰ms-swiftçš„ç”¨æˆ·å¯ä»¥å…ˆå…³æ³¨è¿™äº›å‘½ä»¤è¡Œå‚æ•°ã€‚

## åŸºæœ¬å‚æ•°

- ğŸ”¥tuner_backend: å¯é€‰ä¸º'peft'ï¼Œ'unsloth'ã€‚é»˜è®¤ä¸º'peft'ã€‚
- ğŸ”¥train_type: å¯é€‰ä¸º'lora'ã€'full'ã€'longlora'ã€'adalora'ã€'llamapro'ã€'adapter'ã€'vera'ã€'boft'ã€'fourierft'ã€'reft'ã€‚é»˜è®¤ä¸º'lora'ã€‚
- ğŸ”¥adapters: ç”¨äºæŒ‡å®šadapterçš„id/pathçš„listï¼Œé»˜è®¤ä¸º`[]`ã€‚è¯¥å‚æ•°é€šå¸¸ç”¨äºæ¨ç†/éƒ¨ç½²å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š`swift infer --model '<model_id_or_path>' --adapters '<adapter_id_or_path>'`ã€‚è¯¥å‚æ•°å¶å°”ä¹Ÿç”¨äºæ–­ç‚¹ç»­è®­ï¼Œè¯¥å‚æ•°ä¸`resume_from_checkpoint`çš„åŒºåˆ«åœ¨äºï¼Œ**è¯¥å‚æ•°åªè¯»å–adapteræƒé‡**ï¼Œè€Œä¸åŠ è½½ä¼˜åŒ–å™¨å’Œéšæœºç§å­ï¼Œå¹¶ä¸è·³è¿‡å·²è®­ç»ƒçš„æ•°æ®é›†éƒ¨åˆ†ã€‚
- external_plugins: å¤–éƒ¨`plugin.py`æ–‡ä»¶åˆ—è¡¨ï¼Œè¿™äº›æ–‡ä»¶ä¼šè¢«æ³¨å†Œè¿›pluginæ¨¡å—ä¸­ï¼ˆå³å¯¹è¯¥æ¨¡å—è¿›è¡Œ`import`ï¼‰ï¼Œä¾‹å­è¯·å‚è§[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/train/grpo/plugin/run_external_reward_func.sh)ã€‚é»˜è®¤ä¸º`[]`ã€‚
- seed: å…¨å±€éšæœºç§å­ï¼Œé»˜è®¤ä¸º42ã€‚
  - æ³¨æ„ï¼šè¯¥éšæœºç§å­ä¸æ§åˆ¶æ•°æ®é›†éšæœºçš„`data_seed`äº’ä¸å½±å“ã€‚
- model_kwargs: ç‰¹å®šæ¨¡å‹å¯ä¼ å…¥çš„é¢å¤–å‚æ•°ï¼Œè¯¥å‚æ•°åˆ—è¡¨ä¼šåœ¨è®­ç»ƒ/æ¨ç†æ—¶æ‰“å°æ—¥å¿—è¿›è¡Œæç¤ºã€‚ä¾‹å¦‚`--model_kwargs '{"fps_max_frames": 12}'`ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡çš„æ–¹å¼è®¾ç½®ï¼Œä¾‹å¦‚`FPS_MAX_FRAMES=12`ã€‚é»˜è®¤ä¸ºNoneã€‚
  - æ³¨æ„ï¼š**è‹¥ä½ åœ¨è®­ç»ƒæ—¶æŒ‡å®šäº†ç‰¹å®šæ¨¡å‹å‚æ•°ï¼Œè¯·åœ¨æ¨ç†æ—¶ä¹Ÿè®¾ç½®å¯¹åº”çš„å‚æ•°**ï¼Œè¿™å¯ä»¥æé«˜è®­ç»ƒæ•ˆæœã€‚
  - ç‰¹å®šæ¨¡å‹å‚æ•°çš„å«ä¹‰å¯ä»¥åœ¨å¯¹åº”æ¨¡å‹å®˜æ–¹repoæˆ–è€…å…¶æ¨ç†ä»£ç ä¸­æ‰¾åˆ°ç›¸åº”å«ä¹‰ã€‚ms-swiftå¼•å…¥è¿™äº›å‚æ•°ä»¥ç¡®ä¿è®­ç»ƒçš„æ¨¡å‹ä¸å®˜æ–¹æ¨ç†ä»£ç æ•ˆæœå¯¹é½ã€‚
- load_args: å½“æŒ‡å®š`--resume_from_checkpoint`ã€`--model`ã€`--adapters`ä¼šè¯»å–ä¿å­˜æ–‡ä»¶ä¸­çš„`args.json`ï¼Œè¯»å–çš„keysæŸ¥çœ‹[base_args.py](https://github.com/modelscope/ms-swift/blob/main/swift/llm/argument/base_args/base_args.py)ã€‚æ¨ç†å’Œå¯¼å‡ºæ—¶é»˜è®¤ä¸ºTrueï¼Œè®­ç»ƒæ—¶é»˜è®¤ä¸ºFalseã€‚è¯¥å‚æ•°é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ã€‚
- load_data_args: å¦‚æœå°†è¯¥å‚æ•°è®¾ç½®ä¸ºTrueï¼Œåˆ™ä¼šé¢å¤–è¯»å–`args.json`ä¸­çš„æ•°æ®å‚æ•°ã€‚é»˜è®¤ä¸ºFalseã€‚**è¯¥å‚æ•°é€šå¸¸ç”¨äºæ¨ç†æ—¶å¯¹è®­ç»ƒä¸­åˆ‡åˆ†çš„éªŒè¯é›†è¿›è¡Œæ¨ç†**ï¼Œä¾‹å¦‚ï¼š`swift infer --adapters xxx --load_data_args true --stream true --max_new_tokens 512`ã€‚
- use_hf: æ§åˆ¶æ¨¡å‹ä¸‹è½½ã€æ•°æ®é›†ä¸‹è½½ã€æ¨¡å‹æ¨é€ä½¿ç”¨ModelScopeè¿˜æ˜¯HuggingFaceã€‚é»˜è®¤ä¸ºFalseï¼Œä½¿ç”¨ModelScopeã€‚
- hub_token: hub token. modelscopeçš„hub tokenå¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://modelscope.cn/my/myaccesstoken)ã€‚é»˜è®¤ä¸ºNoneã€‚
- custom_register_path: ä¼ å…¥è‡ªå®šä¹‰æ¨¡å‹ã€å¯¹è¯æ¨¡æ¿å’Œæ•°æ®é›†æ³¨å†Œçš„`.py`æ–‡ä»¶è·¯å¾„çš„åˆ—è¡¨ï¼Œè¿™äº›æ–‡ä»¶ä¼šè¢«é¢å¤–åŠ è½½ï¼ˆå³å¯¹æ¨¡å—è¿›è¡Œ`import`ï¼‰ã€‚é»˜è®¤ä¸º`[]`ã€‚
- ddp_timeout: é»˜è®¤ä¸º18000000ï¼Œå•ä½ä¸ºç§’ã€‚
- ddp_backend: å¯é€‰ä¸º"nccl"ã€"gloo"ã€"mpi"ã€"ccl"ã€"hccl"ã€"cncl"ã€"mccl"ã€‚é»˜è®¤ä¸ºNoneï¼Œè¿›è¡Œè‡ªåŠ¨é€‰æ‹©ã€‚
- ignore_args_error: ç”¨äºå…¼å®¹jupyter notebookã€‚é»˜è®¤ä¸ºFalseã€‚

### æ¨¡å‹å‚æ•°
- ğŸ”¥model: [æ¨¡å‹id](https://modelscope.cn/models)æˆ–æ¨¡å‹æœ¬åœ°è·¯å¾„ã€‚é»˜è®¤ä¸ºNoneã€‚
- ğŸ”¥model_type: æ¨¡å‹ç±»å‹ã€‚**æˆ‘ä»¬å°†ç›¸åŒçš„æ¨¡å‹æ¶æ„ã€æ¨¡å‹åŠ è½½è¿‡ç¨‹ã€templateå®šä¹‰ä¸ºä¸€ä¸ª`model_type`**ã€‚é»˜è®¤ä¸ºNoneï¼Œå³**æ ¹æ®`--model`çš„åç¼€å’Œconfig.jsonä¸­çš„'architectures'å±æ€§è¿›è¡Œè‡ªåŠ¨é€‰æ‹©**ã€‚å¯¹åº”æ¨¡å‹çš„model_typeå¯ä»¥åœ¨[æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨](./æ”¯æŒçš„æ¨¡å‹å’Œæ•°æ®é›†.md)ä¸­æ‰¾åˆ°ã€‚
  - æ³¨æ„ï¼šms-swiftä¸­model_typeçš„æ¦‚å¿µä¸`config.json`ä¸­çš„model_typeä¸åŒã€‚
  - è‡ªå®šä¹‰æ¨¡å‹é€šå¸¸éœ€è¦è‡ªè¡Œæ³¨å†Œ`model_type`å’Œ`template`ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ[è‡ªå®šä¹‰æ¨¡å‹æ–‡æ¡£](../Customization/è‡ªå®šä¹‰æ¨¡å‹.md)ã€‚
- model_revision: æ¨¡å‹ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸ºNoneã€‚
- task_type: é»˜è®¤ä¸º'causal_lm'ã€‚å¯é€‰ä¸º'causal_lm'ã€'seq_cls'ã€'embedding'ã€'reranker'å’Œ'generative_reranker'ã€‚seq_clsçš„ä¾‹å­å¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/train/seq_cls)ï¼Œembeddingçš„ä¾‹å­æŸ¥çœ‹[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/train/embedding)ã€‚
  - è‹¥è®¾ç½®ä¸º'seq_cls'ï¼Œä½ é€šå¸¸éœ€è¦é¢å¤–è®¾ç½®`--num_labels`å’Œ`--problem_type`ã€‚
- ğŸ”¥torch_dtype: æ¨¡å‹æƒé‡çš„æ•°æ®ç±»å‹ï¼Œæ”¯æŒ`float16`,`bfloat16`,`float32`ã€‚é»˜è®¤ä¸ºNoneï¼Œä»'config.json'æ–‡ä»¶ä¸­è¯»å–ã€‚
- attn_impl: attentionç±»å‹ï¼Œå¯é€‰é¡¹ä¸º'sdpa', 'eager', 'flash_attn', 'flash_attention_2', 'flash_attention_3'ç­‰ã€‚é»˜è®¤ä½¿ç”¨Noneï¼Œè¯»å–'config.json'ã€‚
  - æ³¨æ„ï¼šè¿™å‡ ç§attentionå®ç°å¹¶ä¸ä¸€å®šéƒ½æ”¯æŒï¼Œè¿™å–å†³äºå¯¹åº”æ¨¡å‹transformerså®ç°çš„æ”¯æŒæƒ…å†µã€‚
  - è‹¥è®¾ç½®ä¸º'flash_attn'ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰ï¼Œåˆ™ä½¿ç”¨'flash_attention_2'ã€‚
- new_special_tokens: éœ€è¦æ–°å¢çš„ç‰¹æ®Štokensã€‚é»˜è®¤ä¸º`[]`ã€‚ä¾‹å­å‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/train/new_special_tokens)ã€‚
  - æ³¨æ„ï¼šä½ ä¹Ÿå¯ä»¥ä¼ å…¥ä»¥`.txt`ç»“å°¾çš„æ–‡ä»¶è·¯å¾„ï¼Œæ¯è¡Œä¸ºä¸€ä¸ªspecial tokenã€‚
- num_labels: åˆ†ç±»æ¨¡å‹ï¼ˆå³`--task_type seq_cls`ï¼‰éœ€è¦æŒ‡å®šè¯¥å‚æ•°ã€‚ä»£è¡¨æ ‡ç­¾æ•°é‡ï¼Œé»˜è®¤ä¸ºNoneã€‚
- problem_type: åˆ†ç±»æ¨¡å‹ï¼ˆå³`--task_type seq_cls`ï¼‰éœ€è¦æŒ‡å®šè¯¥å‚æ•°ã€‚å¯é€‰ä¸º'regression', 'single_label_classification', 'multi_label_classification'ã€‚é»˜è®¤ä¸ºNoneï¼Œè‹¥æ¨¡å‹ä¸º reward_model æˆ– num_labels ä¸º1ï¼Œè¯¥å‚æ•°ä¸º'regression'ï¼Œå…¶ä»–æƒ…å†µï¼Œè¯¥å‚æ•°ä¸º'single_label_classification'ã€‚
- rope_scaling: ropeç±»å‹ï¼Œä½ å¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š`linear`ã€`dynamic`ã€`yarn`å¹¶ç»“åˆä¼ å…¥`max_model_len`ï¼Œms-swiftä¼šè‡ªåŠ¨è®¾ç½®å¯¹åº”çš„rope_scalingå¹¶è¦†ç›–'config.json'ä¸­çš„rope_scalingã€‚æˆ–è€…ä½ éœ€è¦ä¼ å…¥ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚`'{"factor":2.0, "type":"yarn"}'`ï¼Œè¯¥å€¼ä¼šç›´æ¥è¦†ç›–'config.json'ä¸­çš„rope_scalingã€‚é»˜è®¤ä¸ºNoneã€‚
- max_model_len: å¦‚æœä½¿ç”¨`rope_scaling`å¹¶ä¼ å…¥å­—ç¬¦ä¸²ï¼Œå¯ä»¥è®¾ç½®`max_model_len`ï¼Œè¯¥å‚æ•°ç”¨æ¥è®¡ç®—ropeçš„`factor`å€æ•°ã€‚è¯¥å‚æ•°é»˜è®¤ä¸ºNoneã€‚è‹¥ä¸ºéNoneï¼Œè¯¥å‚æ•°ä¼š**è¦†ç›–**'config.json'ä¸­çš„`max_position_embeddings`å€¼ã€‚
- device_map: æ¨¡å‹ä½¿ç”¨çš„device_mapé…ç½®ï¼Œä¾‹å¦‚ï¼š'auto'ã€'cpu'ã€jsonå­—ç¬¦ä¸²ã€jsonæ–‡ä»¶è·¯å¾„ã€‚è¯¥å‚æ•°ä¼š**é€ä¼ **å…¥transformersçš„`from_pretrained`æ¥å£ã€‚é»˜è®¤ä¸ºNoneï¼Œæ ¹æ®è®¾å¤‡å’Œåˆ†å¸ƒå¼è®­ç»ƒæƒ…å†µè‡ªåŠ¨è®¾ç½®ã€‚
- max_memory: device_mapè®¾ç½®ä¸º'auto'æˆ–è€…'sequential'æ—¶ï¼Œä¼šæ ¹æ®max_memoryè¿›è¡Œæ¨¡å‹æƒé‡çš„deviceåˆ†é…ï¼Œä¾‹å¦‚ï¼š`--max_memory '{0: "20GB", 1: "20GB"}'`ã€‚é»˜è®¤ä¸ºNoneã€‚è¯¥å‚æ•°ä¼šé€ä¼ å…¥transformersçš„`from_pretrained`æ¥å£ã€‚
- local_repo_path: éƒ¨åˆ†æ¨¡å‹åœ¨åŠ è½½æ—¶ä¾èµ–äºgithub repoï¼Œä¾‹å¦‚[deepseek-vl2](https://github.com/deepseek-ai/DeepSeek-VL2)ã€‚ä¸ºäº†é¿å…`git clone`æ—¶é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æœ¬åœ°repoã€‚è¯¥å‚æ•°éœ€è¦ä¼ å…¥æœ¬åœ°repoçš„è·¯å¾„, é»˜è®¤ä¸º`None`ã€‚
- init_strategy: åŠ è½½æ¨¡å‹æ—¶ï¼Œåˆå§‹åŒ–æ¨¡å‹ä¸­æ‰€æœ‰æœªåˆå§‹åŒ–çš„å‚æ•°ï¼ˆè‡ªå®šä¹‰æ¨¡å‹æ¶æ„æ—¶ï¼‰ã€‚å¯é€‰ä¸º'zero', 'uniform', 'normal', 'xavier_uniform', 'xavier_normal', 'kaiming_uniform', 'kaiming_normal', 'orthogonal'ã€‚é»˜è®¤ä¸ºNoneã€‚


### æ•°æ®å‚æ•°
- ğŸ”¥dataset: æ•°æ®é›†idæˆ–è·¯å¾„çš„listã€‚é»˜è®¤ä¸º`[]`ã€‚æ¯ä¸ªæ•°æ®é›†çš„ä¼ å…¥æ ¼å¼ä¸ºï¼š`'æ•°æ®é›†id or æ•°æ®é›†è·¯å¾„:å­æ•°æ®é›†#é‡‡æ ·æ•°é‡'`ï¼Œå…¶ä¸­å­æ•°æ®é›†å’Œå–æ ·æ•°æ®å¯é€‰ã€‚æœ¬åœ°æ•°æ®é›†æ”¯æŒjsonlã€csvã€jsonã€æ–‡ä»¶å¤¹ç­‰ã€‚**hubç«¯çš„å¼€æºæ•°æ®é›†å¯ä»¥é€šè¿‡`git clone`åˆ°æœ¬åœ°å¹¶å°†æ–‡ä»¶å¤¹ä¼ å…¥è€Œç¦»çº¿ä½¿ç”¨**ã€‚è‡ªå®šä¹‰æ•°æ®é›†æ ¼å¼å¯ä»¥å‚è€ƒ[è‡ªå®šä¹‰æ•°æ®é›†æ–‡æ¡£](../Customization/è‡ªå®šä¹‰æ•°æ®é›†.md)ã€‚ä½ å¯ä»¥ä¼ å…¥`--dataset <dataset1> <dataset2>`æ¥ä½¿ç”¨å¤šä¸ªæ•°æ®é›†ã€‚
  - å­æ•°æ®é›†: è¯¥å‚æ•°åªæœ‰å½“datasetä¸ºIDæˆ–è€…æ–‡ä»¶å¤¹æ—¶ç”Ÿæ•ˆã€‚è‹¥æ³¨å†Œæ—¶æŒ‡å®šäº†subsetsï¼Œä¸”åªæœ‰ä¸€ä¸ªå­æ•°æ®é›†ï¼Œåˆ™é»˜è®¤é€‰æ‹©æ³¨å†Œæ—¶æŒ‡å®šçš„å­æ•°æ®é›†ï¼Œå¦åˆ™é»˜è®¤ä¸º'default'ã€‚ä½ å¯ä»¥ä½¿ç”¨`/`æ¥é€‰æ‹©å¤šä¸ªå­æ•°æ®é›†ï¼Œä¾‹å¦‚ï¼š`<dataset_id>:subset1/subset2`ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨'all'æ¥é€‰æ‹©æ³¨å†Œæ—¶æŒ‡å®šçš„æ‰€æœ‰å­æ•°æ®é›†ï¼Œä¾‹å¦‚ï¼š`<dataset_id>:all`ã€‚æ³¨å†Œä¾‹å­å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/datasets/swift/garbage_competition)ã€‚
  - é‡‡æ ·æ•°é‡: é»˜è®¤ä½¿ç”¨å®Œæ•´çš„æ•°æ®é›†ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®`#é‡‡æ ·æ•°`å¯¹é€‰æ‹©çš„æ•°æ®é›†è¿›è¡Œé‡‡æ ·ã€‚è‹¥é‡‡æ ·æ•°å°‘äºæ•°æ®æ ·æœ¬æ€»æ•°ï¼Œåˆ™è¿›è¡Œéšæœºé€‰æ‹©ï¼ˆä¸é‡å¤é‡‡æ ·ï¼‰ã€‚è‹¥é‡‡æ ·æ•°é«˜äºæ•°æ®æ ·æœ¬æ€»æ•°ï¼Œåˆ™åªé¢å¤–éšæœºé‡‡æ ·`é‡‡æ ·æ•°%æ•°æ®æ ·æœ¬æ€»æ•°`çš„æ ·æœ¬ï¼Œæ•°æ®æ ·æœ¬é‡å¤é‡‡æ ·`é‡‡æ ·æ•°//æ•°æ®æ ·æœ¬æ€»æ•°`æ¬¡ã€‚æ³¨æ„ï¼šæµå¼æ•°æ®é›†ï¼ˆ`--streaming true`ï¼‰åªè¿›è¡Œé¡ºåºé‡‡æ ·ã€‚è‹¥è®¾ç½®`--dataset_shuffle false`ï¼Œåˆ™éæµå¼æ•°æ®é›†ä¹Ÿè¿›è¡Œé¡ºåºé‡‡æ ·ã€‚
- ğŸ”¥val_dataset: éªŒè¯é›†idæˆ–è·¯å¾„çš„listã€‚é»˜è®¤ä¸º`[]`ã€‚
- ğŸ”¥split_dataset_ratio: ä¸æŒ‡å®šval_datasetæ—¶ä»è®­ç»ƒé›†æ‹†åˆ†éªŒè¯é›†çš„æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º0.ï¼Œå³ä¸ä»è®­ç»ƒé›†åˆ‡åˆ†éªŒè¯é›†ã€‚
  - æ³¨æ„ï¼šè¯¥å‚æ•°åœ¨"ms-swift<3.6"çš„é»˜è®¤å€¼ä¸º0.01ã€‚
- data_seed: æ•°æ®é›†éšæœºç§å­ï¼Œé»˜è®¤ä¸º42ã€‚
- ğŸ”¥dataset_num_proc: æ•°æ®é›†é¢„å¤„ç†çš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º1ã€‚
- ğŸ”¥load_from_cache_file: æ˜¯å¦ä»ç¼“å­˜ä¸­åŠ è½½æ•°æ®é›†ï¼Œé»˜è®¤ä¸ºFalseã€‚**å»ºè®®åœ¨å®é™…è¿è¡Œæ—¶è®¾ç½®ä¸ºTrueï¼Œdebugé˜¶æ®µè®¾ç½®ä¸ºFalse**ã€‚
  - æ³¨æ„ï¼šè¯¥å‚æ•°åœ¨"ms-swift<3.9"é»˜è®¤ä¸ºTrueã€‚
- dataset_shuffle: æ˜¯å¦å¯¹datasetè¿›è¡Œéšæœºæ“ä½œã€‚é»˜è®¤ä¸ºTrueã€‚
  - æ³¨æ„ï¼š**CPT/SFTçš„éšæœºåŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†**ï¼šæ•°æ®é›†çš„éšæœºï¼Œç”±`dataset_shuffle`æ§åˆ¶ï¼›train_dataloaderä¸­çš„éšæœºï¼Œç”±`train_dataloader_shuffle`æ§åˆ¶ã€‚
- val_dataset_shuffle: æ˜¯å¦å¯¹val_datasetè¿›è¡Œéšæœºæ“ä½œã€‚é»˜è®¤ä¸ºFalseã€‚
- streaming: æµå¼è¯»å–å¹¶å¤„ç†æ•°æ®é›†ï¼Œé»˜è®¤Falseã€‚
  - æ³¨æ„ï¼šéœ€è¦é¢å¤–è®¾ç½®`--max_steps`ï¼Œå› ä¸ºæµå¼æ•°æ®é›†æ— æ³•è·å¾—å…¶é•¿åº¦ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®`--save_strategy epoch`å¹¶è®¾ç½®è¾ƒå¤§çš„max_stepsæ¥å®ç°ä¸`--num_train_epochs`ç­‰æ•ˆçš„è®­ç»ƒã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®`max_epochs`ç¡®ä¿è®­ç»ƒåˆ°å¯¹åº”epochsæ—¶é€€å‡ºè®­ç»ƒï¼Œå¹¶å¯¹æƒé‡è¿›è¡ŒéªŒè¯å’Œä¿å­˜ã€‚
  - æ³¨æ„ï¼šæµå¼æ•°æ®é›†å¯ä»¥è·³è¿‡é¢„å¤„ç†ç­‰å¾…ï¼Œå°†é¢„å¤„ç†æ—¶é—´ä¸è®­ç»ƒæ—¶é—´é‡å ã€‚æµå¼æ•°æ®é›†çš„é¢„å¤„ç†åªåœ¨rank0ä¸Šè¿›è¡Œï¼Œå¹¶é€šè¿‡æ•°æ®åˆ†å‘çš„æ–¹å¼åŒæ­¥åˆ°å…¶ä»–è¿›ç¨‹ï¼Œ**å…¶é€šå¸¸æ•ˆç‡ä¸å¦‚éæµå¼æ•°æ®é›†é‡‡ç”¨çš„æ•°æ®åˆ†ç‰‡è¯»å–æ–¹å¼**ã€‚å½“è®­ç»ƒçš„world_sizeè¾ƒå¤§æ—¶ï¼Œé¢„å¤„ç†å’Œæ•°æ®åˆ†å‘å°†æˆä¸ºè®­ç»ƒç“¶é¢ˆã€‚
- interleave_prob: é»˜è®¤å€¼ä¸º Noneã€‚åœ¨ç»„åˆå¤šä¸ªæ•°æ®é›†æ—¶ï¼Œé»˜è®¤ä½¿ç”¨datasetsåº“çš„ `concatenate_datasets` å‡½æ•°ï¼›å¦‚æœè®¾ç½®äº†è¯¥å‚æ•°ï¼Œåˆ™ä¼šä½¿ç”¨ `interleave_datasets` å‡½æ•°ã€‚è¯¥å‚æ•°é€šå¸¸ç”¨äºæµå¼æ•°æ®é›†çš„ç»„åˆï¼Œå¹¶ä¼šä½œä¸ºå‚æ•°ä¼ å…¥ `interleave_datasets` å‡½æ•°ä¸­ã€‚
- stopping_strategy: å¯é€‰ä¸º"first_exhausted", "all_exhausted"ï¼Œé»˜è®¤ä¸º"first_exhausted"ã€‚ä¼ å…¥`interleave_datasets`å‡½æ•°ä¸­ã€‚
- shuffle_buffer_size: è¯¥å‚æ•°ç”¨äºæŒ‡å®š**æµå¼æ•°æ®é›†**çš„éšæœºbufferå¤§å°ï¼Œé»˜è®¤ä¸º1000ã€‚è¯¥å‚æ•°åªåœ¨`dataset_shuffle`è®¾ç½®ä¸ºtrueæ—¶æœ‰æ•ˆã€‚
- download_mode: æ•°æ®é›†ä¸‹è½½æ¨¡å¼ï¼ŒåŒ…å«`reuse_dataset_if_exists`å’Œ`force_redownload`ï¼Œé»˜è®¤ä¸º'reuse_dataset_if_exists'ã€‚
  - é€šå¸¸åœ¨ä½¿ç”¨hubç«¯æ•°æ®é›†æŠ¥é”™æ—¶è®¾ç½®ä¸º`--download_mode force_redownload`ã€‚
- columns: ç”¨äºå¯¹æ•°æ®é›†è¿›è¡Œåˆ—æ˜ å°„ï¼Œä½¿æ•°æ®é›†æ»¡è¶³AutoPreprocessorå¯ä»¥å¤„ç†çš„æ ·å¼ï¼ŒAutoPreprocessorå¯ä»¥å¤„ç†çš„æ•°æ®é›†æ ¼å¼æŸ¥çœ‹[è‡ªå®šä¹‰æ•°æ®é›†æ–‡æ¡£](../Customization/è‡ªå®šä¹‰æ•°æ®é›†.md)ã€‚ä½ å¯ä»¥ä¼ å…¥jsonå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š`'{"text1": "query", "text2": "response"}'`ï¼Œä»£è¡¨å°†æ•°æ®é›†ä¸­çš„"text1"æ˜ å°„ä¸º"query"ï¼Œ"text2"æ˜ å°„ä¸º"response"ï¼Œè€Œquery-responseæ ¼å¼å¯ä»¥è¢«AutoPreprocessorå¤„ç†ã€‚é»˜è®¤ä¸ºNoneã€‚
- strict: å¦‚æœä¸ºTrueï¼Œåˆ™æ•°æ®é›†åªè¦æŸè¡Œæœ‰é—®é¢˜ç›´æ¥æŠ›é”™ï¼Œå¦åˆ™ä¼šä¸¢å¼ƒå‡ºé”™æ•°æ®æ ·æœ¬ã€‚é»˜è®¤Falseã€‚è¯¥å‚æ•°é€šå¸¸ç”¨äºæ’æŸ¥é”™è¯¯ã€‚
- ğŸ”¥remove_unused_columns: æ˜¯å¦åˆ é™¤æ•°æ®é›†ä¸­ä¸è¢«ä½¿ç”¨çš„åˆ—ï¼Œé»˜è®¤ä¸ºTrueã€‚
  - è‹¥è¯¥å‚æ•°è®¾ç½®ä¸ºFalseï¼Œåˆ™å°†é¢å¤–çš„æ•°æ®é›†åˆ—ä¼ é€’è‡³trainerçš„`compute_loss`å‡½æ•°å†…ï¼Œ**æ–¹ä¾¿è‡ªå®šä¹‰æŸå¤±å‡½æ•°ä½¿ç”¨é¢å¤–çš„æ•°æ®é›†åˆ—**ã€‚
  - GPROè¯¥å‚æ•°çš„é»˜è®¤å€¼ä¸ºFalseã€‚
- ğŸ”¥model_name: **ä»…ç”¨äºè‡ªæˆ‘è®¤çŸ¥ä»»åŠ¡**ï¼Œåªå¯¹`swift/self-cognition`æ•°æ®é›†ç”Ÿæ•ˆï¼Œæ›¿æ¢æ‰æ•°æ®é›†ä¸­çš„`{{NAME}}`é€šé…ç¬¦ã€‚ä¼ å…¥æ¨¡å‹ä¸­æ–‡åå’Œè‹±æ–‡åï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚ï¼š`--model_name å°é»„ 'Xiao Huang'`ã€‚é»˜è®¤ä¸ºNoneã€‚
- ğŸ”¥model_author: ä»…ç”¨äºè‡ªæˆ‘è®¤çŸ¥ä»»åŠ¡ï¼Œåªå¯¹`swift/self-cognition`æ•°æ®é›†ç”Ÿæ•ˆï¼Œæ›¿æ¢æ‰æ•°æ®é›†ä¸­çš„`{{AUTHOR}}`é€šé…ç¬¦ã€‚ä¼ å…¥æ¨¡å‹ä½œè€…çš„ä¸­æ–‡åå’Œè‹±æ–‡åï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚ï¼š`--model_author 'é­”æ­' 'ModelScope'`ã€‚é»˜è®¤ä¸ºNoneã€‚
- custom_dataset_info: è‡ªå®šä¹‰æ•°æ®é›†æ³¨å†Œçš„jsonæ–‡ä»¶è·¯å¾„ï¼Œå‚è€ƒ[è‡ªå®šä¹‰æ•°æ®é›†](../Customization/è‡ªå®šä¹‰æ•°æ®é›†.md)å’Œ[å†…ç½®'dataset_info.json'æ–‡ä»¶](https://github.com/modelscope/ms-swift/blob/main/swift/llm/dataset/data/dataset_info.json)ã€‚é»˜è®¤ä¸º`[]`ã€‚

### æ¨¡æ¿å‚æ•°
- ğŸ”¥template: å¯¹è¯æ¨¡æ¿ç±»å‹ã€‚é»˜è®¤ä¸ºNoneï¼Œè‡ªåŠ¨é€‰æ‹©å¯¹åº”modelçš„templateç±»å‹ï¼Œå¯¹åº”å…³ç³»å‚è€ƒ[æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨](./æ”¯æŒçš„æ¨¡å‹å’Œæ•°æ®é›†.md)ã€‚
- ğŸ”¥system: è‡ªå®šä¹‰systemå­—æ®µï¼Œå¯ä»¥ä¼ å…¥å­—ç¬¦ä¸²æˆ–è€…**txtæ–‡ä»¶è·¯å¾„**ã€‚é»˜è®¤ä¸ºNoneï¼Œä½¿ç”¨æ³¨å†Œtemplateæ—¶çš„é»˜è®¤systemã€‚
  - æ³¨æ„ï¼šæ•°æ®é›†ä¸­çš„system**ä¼˜å…ˆçº§**æœ€é«˜ï¼Œç„¶åæ˜¯`--system`ï¼Œæœ€åæ˜¯æ³¨å†Œtemplateæ—¶è®¾ç½®çš„`default_system`ã€‚
- ğŸ”¥max_length: é™åˆ¶å•æ•°æ®é›†æ ·æœ¬ç»è¿‡`tokenizer.encode`åçš„tokensæœ€å¤§é•¿åº¦ï¼Œè¶…è¿‡çš„æ•°æ®æ ·æœ¬ä¼šæ ¹æ®`truncation_strategy`å‚æ•°è¿›è¡Œå¤„ç†ï¼ˆé¿å…è®­ç»ƒOOMï¼‰ã€‚é»˜è®¤ä¸ºNoneï¼Œå³è®¾ç½®ä¸ºæ¨¡å‹æ”¯æŒçš„tokensæœ€å¤§é•¿åº¦(max_model_len)ã€‚
  - å½“PPOã€GRPOå’Œæ¨ç†æƒ…å†µä¸‹ï¼Œ`max_length`ä»£è¡¨`max_prompt_length`ã€‚
- truncation_strategy: å¦‚æœå•æ ·æœ¬çš„tokensè¶…è¿‡`max_length`å¦‚ä½•å¤„ç†ï¼Œæ”¯æŒ`delete`ã€`left`å’Œ`right`ï¼Œä»£è¡¨åˆ é™¤ã€å·¦ä¾§è£å‰ªå’Œå³ä¾§è£å‰ªï¼Œé»˜è®¤ä¸º'delete'ã€‚
  - æ³¨æ„ï¼šè‹¥å¤šæ¨¡æ€æ¨¡å‹çš„è®­ç»ƒæ—¶å°†'truncation_strategy'è®¾ç½®ä¸º`left`æˆ–`right`ï¼Œ**ms-swiftä¼šä¿ç•™æ‰€æœ‰çš„image_tokenç­‰å¤šæ¨¡æ€tokens**ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è®­ç»ƒæ—¶OOMã€‚
- ğŸ”¥max_pixels: å¤šæ¨¡æ€æ¨¡å‹è¾“å…¥å›¾ç‰‡çš„æœ€å¤§åƒç´ æ•°ï¼ˆH\*Wï¼‰ï¼Œå°†è¶…è¿‡è¯¥é™åˆ¶çš„å›¾åƒè¿›è¡Œç¼©æ”¾ï¼ˆé¿å…è®­ç»ƒOOMï¼‰ã€‚é»˜è®¤ä¸ºNoneï¼Œä¸é™åˆ¶æœ€å¤§åƒç´ æ•°ã€‚
  - æ³¨æ„ï¼šè¯¥å‚æ•°é€‚ç”¨äºæ‰€æœ‰çš„å¤šæ¨¡æ€æ¨¡å‹ã€‚è€ŒQwen2.5-VLç‰¹æœ‰çš„æ¨¡å‹å‚æ•°`MAX_PIXELS`ï¼ˆä½ å¯ä»¥åœ¨æ–‡æ¡£æœ€ä¸‹é¢æ‰¾åˆ°ï¼‰åªé’ˆå¯¹Qwen2.5-VLæ¨¡å‹ã€‚
- ğŸ”¥agent_template: Agentæ¨¡æ¿ï¼Œç¡®å®šå¦‚ä½•å°†å·¥å…·åˆ—è¡¨'tools'è½¬æ¢æˆ'system'ã€å¦‚ä½•åœ¨æ¨ç†/éƒ¨ç½²æ—¶ä»æ¨¡å‹å›å¤ä¸­æå–toolcalléƒ¨åˆ†ï¼Œä»¥åŠç¡®å®š'messages'ä¸­`{"role": "tool_call", "content": "xxx"}`, `{"role": "tool_response", "content": "xxx"}`çš„æ¨¡æ¿æ ¼å¼ã€‚å¯é€‰ä¸º"react_en", "hermes", "glm4", "qwen_en", "toolbench"ç­‰ï¼Œæ›´å¤šè¯·æŸ¥çœ‹[è¿™é‡Œ](https://github.com/modelscope/ms-swift/blob/main/swift/plugin/agent_template/__init__.py)ã€‚é»˜è®¤ä¸ºNoneï¼Œæ ¹æ®æ¨¡å‹ç±»å‹è¿›è¡Œè‡ªåŠ¨é€‰æ‹©ã€‚å¯ä»¥å‚è€ƒ[Agentæ–‡æ¡£](./Agentæ”¯æŒ.md)ã€‚
- norm_bbox: æ§åˆ¶å¦‚ä½•ç¼©æ”¾è¾¹ç•Œæ¡†ï¼ˆå³æ•°æ®é›†ä¸­çš„"bbox"ï¼Œé‡Œé¢çš„æ•°æ®ä¸ºç»å¯¹åæ ‡ï¼Œå‚è€ƒ[è‡ªå®šä¹‰æ•°æ®é›†æ–‡æ¡£](https://swift.readthedocs.io/zh-cn/latest/Customization/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E9%9B%86.html#grounding)ï¼‰ã€‚é€‰é¡¹ä¸º'norm1000'å’Œ'none'ã€‚'norm1000'è¡¨ç¤ºå°†bboxåæ ‡ç¼©æ”¾è‡³åƒåˆ†ä½åæ ‡ï¼Œè€Œ'none'è¡¨ç¤ºä¸è¿›è¡Œç¼©æ”¾ã€‚é»˜è®¤å€¼ä¸ºNoneï¼Œå°†æ ¹æ®æ¨¡å‹è‡ªåŠ¨é€‰æ‹©ã€‚
  - å½“**å›¾ç‰‡åœ¨è®­ç»ƒä¸­å‘ç”Ÿç¼©æ”¾æ—¶**ï¼ˆä¾‹å¦‚è®¾ç½®äº†max_pixelså‚æ•°ï¼‰ï¼Œè¯¥å‚æ•°ä¹Ÿèƒ½å¾ˆå¥½è¿›è¡Œè§£å†³ã€‚
- use_chat_template: ä½¿ç”¨chatæ¨¡æ¿è¿˜æ˜¯generationæ¨¡æ¿ï¼ˆgenerationæ¨¡æ¿é€šå¸¸ç”¨äºé¢„è®­ç»ƒæ—¶ï¼‰ã€‚é»˜è®¤ä¸º`True`ã€‚
  - æ³¨æ„ï¼š`swift pt`é»˜è®¤ä¸ºFalseï¼Œä½¿ç”¨generationæ¨¡æ¿ã€‚è¯¥å‚æ•°å¯ä»¥å¾ˆå¥½çš„**å…¼å®¹å¤šæ¨¡æ€æ¨¡å‹**ã€‚
- ğŸ”¥padding_free: å°†ä¸€ä¸ªbatchä¸­çš„æ•°æ®è¿›è¡Œå±•å¹³è€Œé¿å…æ•°æ®paddingï¼Œä»è€Œé™ä½æ˜¾å­˜å ç”¨å¹¶åŠ å¿«è®­ç»ƒï¼ˆ**åŒä¸€batchçš„ä¸åŒåºåˆ—ä¹‹é—´ä¾æ—§æ˜¯ä¸å¯è§çš„**ï¼‰ã€‚é»˜è®¤ä¸ºFalseã€‚å½“å‰æ”¯æŒCPT/SFT/DPO/GRPO/KTO/GKDã€‚
  - æ³¨æ„ï¼šä½¿ç”¨padding_freeè¯·ç»“åˆ`--attn_impl flash_attn`ä½¿ç”¨ä¸”"transformers>=4.44"ï¼Œå…·ä½“æŸ¥çœ‹[è¯¥PR](https://github.com/huggingface/transformers/pull/31629)ã€‚ï¼ˆåŒpackingï¼‰
  - **ç›¸è¾ƒäºpackingï¼Œpadding_freeä¸éœ€è¦é¢å¤–çš„é¢„å¤„ç†æ—¶é—´ï¼Œä½†packingçš„è®­ç»ƒé€Ÿåº¦æ›´å¿«ä¸”æ˜¾å­˜å ç”¨æ›´ç¨³å®š**ã€‚
- padding_side: å½“è®­ç»ƒ`batch_size>=2`æ—¶çš„padding_sideï¼Œå¯é€‰å€¼ä¸º'left'ã€'right'ï¼Œé»˜è®¤ä¸º'right'ã€‚ï¼ˆæ¨ç†æ—¶çš„batch_size>=2æ—¶ï¼Œåªè¿›è¡Œå·¦paddingï¼‰ã€‚
  - æ³¨æ„ï¼šPPOå’ŒGKDé»˜è®¤è®¾ç½®ä¸º'left'ã€‚
- ğŸ”¥loss_scale: è®­ç»ƒtokensçš„lossæƒé‡è®¾ç½®ã€‚é»˜è®¤ä¸º`'default'`ï¼Œä»£è¡¨æ‰€æœ‰responseï¼ˆå«historyï¼‰ä»¥æƒé‡1è®¡ç®—äº¤å‰ç†µæŸå¤±ï¼ˆ**messagesä¸­çš„system/user/å¤šæ¨¡æ€tokensä»¥åŠAgentè®­ç»ƒä¸­`tool_response`éƒ¨åˆ†ä¸è®¡ç®—æŸå¤±**ï¼‰ã€‚å¯é€‰å€¼ä¸º'default'ã€'last_round'ã€'all'ã€'ignore_empty_think'ã€'last_round_with_ignore_empty_think'ï¼Œä»¥åŠagentéœ€è¦çš„loss_scale: 'react'ã€'hermes'ã€'qwen'ã€'agentflan'ã€'alpha_umi'ç­‰ï¼Œå¯é€‰å€¼å‚è€ƒ[loss_scale.py](https://github.com/modelscope/ms-swift/blob/main/swift/plugin/loss_scale/loss_scale.py)ã€‚
  - 'last_round': åªè®¡ç®—æœ€åä¸€è½®responseçš„æŸå¤±ã€‚ï¼ˆå¸¸ç”¨ï¼›**RLHFé»˜è®¤ä¸ºè¯¥å€¼**ï¼‰
  - 'all': è®¡ç®—æ‰€æœ‰tokensçš„æŸå¤±ã€‚ï¼ˆ**`swift pt`é»˜è®¤ä¸ºè¯¥å€¼**ï¼‰
  - 'ignore_empty_think': åœ¨`'default'`çš„åŸºç¡€ä¸Šï¼Œå¿½ç•¥ç©ºçš„`'<think>\n\n</think>\n\n'`æŸå¤±è®¡ç®—ã€‚ï¼ˆæ»¡è¶³æ­£åˆ™åŒ¹é…`'<think>\\s*</think>\\s*'`å³å¯ï¼‰ã€‚
  - 'last_round_with_ignore_empty_think': åœ¨`'last_round'`çš„åŸºç¡€ä¸Šï¼Œå¿½ç•¥ç©ºçš„`'<think>\n\n</think>\n\n'`æŸå¤±è®¡ç®—ã€‚
  - 'react', 'hermes', 'qwen': åœ¨`'default'`çš„åŸºç¡€ä¸Šï¼Œå°†`tool_call`éƒ¨åˆ†çš„lossæƒé‡è°ƒæ•´ä¸º2ã€‚
- sequence_parallel_size: åºåˆ—å¹¶è¡Œå¤§å°ï¼Œé»˜è®¤æ˜¯1ã€‚å½“å‰æ”¯æŒCPT/SFT/DPO/GRPOã€‚è®­ç»ƒè„šæœ¬å‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/train/sequence_parallel)ã€‚
- response_prefix: responseçš„å‰ç¼€å­—ç¬¦ï¼Œä¾‹å¦‚QwQ-32Bå°†response_prefixè®¾ç½®ä¸º`'<think>\n'`ï¼Œè¯¥å‚æ•°åªåœ¨æ¨ç†æ—¶ç”Ÿæ•ˆã€‚é»˜è®¤ä¸ºNoneï¼Œæ ¹æ®æ¨¡å‹è‡ªåŠ¨è®¾ç½®ã€‚
- template_backend: é€‰æ‹©templateåç«¯ï¼Œå¯é€‰ä¸º'swift'ã€'jinja'ï¼Œé»˜è®¤ä¸º'swift'ã€‚å¦‚æœä½¿ç”¨jinjaï¼Œåˆ™ä½¿ç”¨transformersçš„`apply_chat_template`ã€‚
  - æ³¨æ„ï¼šjinjaçš„templateåç«¯åªæ”¯æŒæ¨ç†ï¼Œä¸æ”¯æŒè®­ç»ƒï¼ˆæ— æ³•ç¡®å®šæŸå¤±è®¡ç®—çš„tokensèŒƒå›´ï¼‰ã€‚

### ç”Ÿæˆå‚æ•°
å‚è€ƒ[generation_config](https://huggingface.co/docs/transformers/main_classes/text_generation#transformers.GenerationConfig)æ–‡æ¡£ã€‚

- ğŸ”¥max_new_tokens: æ¨ç†æœ€å¤§ç”Ÿæˆæ–°tokensçš„æ•°é‡ã€‚é»˜è®¤ä¸ºNoneï¼Œæ— é™åˆ¶ã€‚
- temperature: æ¸©åº¦å‚æ•°ï¼Œæ¸©åº¦è¶Šé«˜ï¼Œè¾“å‡ºçš„éšæœºæ€§è¶Šå¤§ã€‚é»˜è®¤ä¸ºNoneï¼Œè¯»å–'generation_config.json'ã€‚
  - ä½ å¯ä»¥è®¾ç½®`--temperature 0`æˆ–è€…`--top_k 1`ä»¥å–æ¶ˆæ¨ç†éšæœºæ€§ã€‚
- top_k: top_kå‚æ•°ï¼Œä¿ç•™æ¦‚ç‡æœ€é«˜çš„top_kæ•°é‡ tokensç”¨äºç”Ÿæˆï¼Œé»˜è®¤ä¸ºNoneã€‚è¯»å–'generation_config.json'ã€‚
- top_p: top_på‚æ•°ï¼Œä¿ç•™æ¦‚ç‡æœ€é«˜çš„ç´¯è®¡æ¦‚ç‡è¾¾åˆ° top_p çš„tokensç”¨äºç”Ÿæˆï¼Œé»˜è®¤ä¸ºNoneã€‚è¯»å–generation_config.jsonã€‚
- repetition_penalty: é‡å¤æƒ©ç½šå‚æ•°ã€‚1.0 è¡¨ç¤ºä¸è¿›è¡Œæƒ©ç½šã€‚é»˜è®¤ä¸ºNoneï¼Œè¯»å–generation_config.jsonã€‚
- num_beams: beam searchçš„å¹¶è¡Œä¿ç•™æ•°é‡ï¼Œé»˜è®¤ä¸º1ã€‚
- ğŸ”¥stream: æµå¼è¾“å‡ºï¼Œé»˜è®¤ä¸º`None`ï¼Œå³ä½¿ç”¨äº¤äº’å¼ç•Œé¢æ—¶ä¸ºTrueï¼Œæ•°æ®é›†æ‰¹é‡æ¨ç†æ—¶ä¸ºFalseã€‚
  - "ms-swift<3.6"streamé»˜è®¤å€¼ä¸ºFalseã€‚
- stop_words: é™¤äº†eos_tokenå¤–é¢å¤–çš„åœæ­¢è¯ï¼Œé»˜è®¤ä¸º`[]`ã€‚
  - æ³¨æ„ï¼šeos_tokenä¼šåœ¨è¾“å‡ºrespsoneä¸­è¢«åˆ é™¤ï¼Œé¢å¤–åœæ­¢è¯ä¼šåœ¨è¾“å‡ºä¸­ä¿ç•™ã€‚
- logprobs: æ˜¯å¦è¾“å‡ºlogprobsï¼Œé»˜è®¤ä¸ºFalseã€‚
- top_logprobs: è¾“å‡ºtop_logprobsçš„æ•°é‡ï¼Œé»˜è®¤ä¸ºNoneã€‚

### é‡åŒ–å‚æ•°
ä»¥ä¸‹ä¸ºåŠ è½½æ¨¡å‹æ—¶é‡åŒ–çš„å‚æ•°ï¼Œå…·ä½“å«ä¹‰å¯ä»¥æŸ¥çœ‹[é‡åŒ–](https://huggingface.co/docs/transformers/main/en/main_classes/quantization)æ–‡æ¡£ã€‚è¿™é‡Œä¸åŒ…å«`swift export`ä¸­æ¶‰åŠçš„`gptq`ã€`awq`é‡åŒ–å‚æ•°ã€‚

- ğŸ”¥quant_method: åŠ è½½æ¨¡å‹æ—¶é‡‡ç”¨çš„é‡åŒ–æ–¹æ³•ï¼Œå¯é€‰é¡¹ä¸º'bnb'ã€'hqq'ã€'eetq'ã€'quanto'å’Œ'fp8'ï¼Œé»˜è®¤ä¸ºNoneã€‚
  - è‹¥å¯¹awq/gptqé‡åŒ–æ¨¡å‹è¿›è¡Œqloraè®­ç»ƒï¼Œåˆ™ä¸éœ€è¦è®¾ç½®é¢å¤–`quant_method`ç­‰é‡åŒ–å‚æ•°ã€‚
- ğŸ”¥quant_bits: é‡åŒ–bitsæ•°ï¼Œé»˜è®¤ä¸ºNoneã€‚
- hqq_axis: hqqé‡åŒ–axisï¼Œé»˜è®¤ä¸ºNoneã€‚
- bnb_4bit_compute_dtype: bnbé‡åŒ–è®¡ç®—ç±»å‹ï¼Œå¯é€‰ä¸º`float16`ã€`bfloat16`ã€`float32`ã€‚é»˜è®¤ä¸ºNoneï¼Œè®¾ç½®ä¸º`torch_dtype`ã€‚
- bnb_4bit_quant_type: bnbé‡åŒ–ç±»å‹ï¼Œæ”¯æŒ`fp4`å’Œ`nf4`ï¼Œé»˜è®¤ä¸º`nf4`ã€‚
- bnb_4bit_use_double_quant: æ˜¯å¦ä½¿ç”¨åŒé‡é‡åŒ–ï¼Œé»˜è®¤ä¸º`True`ã€‚
- bnb_4bit_quant_storage: bnbé‡åŒ–å­˜å‚¨ç±»å‹ï¼Œé»˜è®¤ä¸ºNoneã€‚


## åŸå­å‚æ•°

### Seq2SeqTrainerå‚æ•°

è¯¥å‚æ•°åˆ—è¡¨ç»§æ‰¿è‡ªtransformers `Seq2SeqTrainingArguments`ï¼Œms-swiftå¯¹å…¶é»˜è®¤å€¼è¿›è¡Œäº†è¦†ç›–ã€‚æœªåˆ—å‡ºçš„è¯·å‚è€ƒ[HFå®˜æ–¹æ–‡æ¡£](https://huggingface.co/docs/transformers/main/en/main_classes/trainer#transformers.Seq2SeqTrainingArguments)ã€‚

- ğŸ”¥output_dir: é»˜è®¤ä¸ºNoneï¼Œè®¾ç½®ä¸º`'output/<model_name>'`ã€‚
- ğŸ”¥gradient_checkpointing: æ˜¯å¦ä½¿ç”¨gradient_checkpointingï¼Œé»˜è®¤ä¸ºTrueã€‚è¯¥å‚æ•°å¯ä»¥æ˜¾è‘—é™ä½æ˜¾å­˜å ç”¨ï¼Œä½†é™ä½è®­ç»ƒé€Ÿåº¦ã€‚
- ğŸ”¥vit_gradient_checkpointing: å¤šæ¨¡æ€æ¨¡å‹è®­ç»ƒæ—¶ï¼Œæ˜¯å¦å¯¹vitéƒ¨åˆ†å¼€å¯gradient_checkpointingã€‚é»˜è®¤ä¸ºNoneï¼Œå³è®¾ç½®ä¸º`gradient_checkpointing`ã€‚ä¾‹å­å‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/blob/main/examples/train/multimodal/vit_gradient_checkpointing.sh)ã€‚
  - æ³¨æ„ï¼šå¤šæ¨¡æ€æ¨¡å‹ä¸”æ˜¯LoRAè®­ç»ƒæ—¶ï¼Œå½“è®¾ç½®äº†`--freeze_vit false`ï¼Œä¸”å‘½ä»¤è¡Œä¸­å‡ºç°ä»¥ä¸‹è­¦å‘Šï¼š`UserWarning: None of the inputs have requires_grad=True. Gradients will be None`ï¼Œè¯·è®¾ç½®`--vit_gradient_checkpointing false`ï¼Œæˆ–æç›¸å…³issueã€‚å…¨å‚æ•°è®­ç»ƒåˆ™ä¸ä¼šå‡ºç°è¯¥é—®é¢˜ã€‚ï¼ˆå¦‚æœRLHF LoRAè®­ç»ƒä¸­ï¼Œref_modelæŠ›å‡ºæ¥çš„è­¦å‘Šï¼Œåˆ™æ˜¯æ­£å¸¸çš„ï¼‰
- ğŸ”¥deepspeed: é»˜è®¤ä¸ºNoneã€‚å¯ä»¥è®¾ç½®ä¸º'zero0', 'zero1', 'zero2', 'zero3', 'zero2_offload', 'zero3_offload'æ¥ä½¿ç”¨ms-swiftå†…ç½®çš„deepspeedé…ç½®æ–‡ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥ä¼ å…¥è‡ªå®šä¹‰deepspeedé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚
- zero_hpz_partition_size: é»˜è®¤ä¸ºNoneï¼Œè¿™ä¸ªå‚æ•°æ˜¯ZeRO++çš„ç‰¹æ€§ï¼Œå³nodeå†…æ¨¡å‹åˆ†ç‰‡ï¼Œnodeé—´æ•°æ®åˆ†ç‰‡ï¼Œå¦‚æœé‡åˆ°grad_norm NaNï¼Œè¯·å°è¯•ä½¿ç”¨`--torch_dtype float16`ã€‚
- deepspeed_autotp_size: DeepSpeedå¼ é‡å¹¶è¡Œå¤§å°ï¼Œé»˜è®¤ä¸º1ã€‚ä½¿ç”¨DeepSpeed AutoTPæ—¶éœ€å°†å‚æ•°`--deepspeed`è®¾ç½®ä¸º'zero0'ã€'zero1'æˆ–'zero2'ã€‚ï¼ˆæ³¨æ„ï¼šè¯¥åŠŸèƒ½åªæ”¯æŒå…¨å‚æ•°ï¼‰
- ğŸ”¥per_device_train_batch_size: é»˜è®¤å€¼1ã€‚
- ğŸ”¥per_device_eval_batch_size: é»˜è®¤å€¼1ã€‚
- ğŸ”¥gradient_accumulation_steps: æ¢¯åº¦ç´¯åŠ ã€‚**é»˜è®¤ä¸ºNoneï¼Œå³è®¾ç½®gradient_accumulation_stepsä½¿å¾—total_batch_size>=16**ã€‚total_batch_sizeç­‰äº`per_device_train_batch_size * gradient_accumulation_steps * world_size`ã€‚åœ¨GRPOè®­ç»ƒä¸­ï¼Œé»˜è®¤ä¸º1ã€‚
  - åœ¨CPT/SFTè®­ç»ƒä¸­ï¼Œæ¢¯åº¦ç´¯åŠ çš„è®­ç»ƒæ•ˆæœç­‰ä»·ä½¿ç”¨æ›´å¤§çš„batch_sizeï¼Œä½†åœ¨RLHFè®­ç»ƒä¸­ï¼Œè®­ç»ƒæ•ˆæœå¹¶ä¸ç­‰ä»·ã€‚
- weight_decay: weightè¡°å‡ç³»æ•°ï¼Œé»˜è®¤å€¼0.1ã€‚
- adam_beta1: é»˜è®¤ä¸º0.9ã€‚
- adam_beta2: é»˜è®¤ä¸º0.95ã€‚
- ğŸ”¥learning_rate: å­¦ä¹ ç‡ï¼Œ**å…¨å‚æ•°è®­ç»ƒé»˜è®¤ä¸º1e-5ï¼ŒLoRAè®­ç»ƒç­‰tunersä¸º1e-4**ã€‚
  - æç¤ºï¼šè‹¥è¦è®¾ç½®`min_lr`ï¼Œæ‚¨å¯ä»¥ä¼ å…¥å‚æ•°`--lr_scheduler_type cosine_with_min_lr --lr_scheduler_kwargs '{"min_lr": 1e-6}'`ã€‚
- ğŸ”¥vit_lr: å½“è®­ç»ƒå¤šæ¨¡æ€å¤§æ¨¡å‹æ—¶ï¼Œè¯¥å‚æ•°æŒ‡å®švitçš„å­¦ä¹ ç‡ï¼Œé»˜è®¤ä¸ºNoneï¼Œç­‰äºlearning_rateã€‚
  - é€šå¸¸ä¸`--freeze_vit`ã€`--freeze_aligner`å‚æ•°ç»“åˆä½¿ç”¨ã€‚
- ğŸ”¥aligner_lr: å½“è®­ç»ƒå¤šæ¨¡æ€å¤§æ¨¡å‹æ—¶ï¼Œè¯¥å‚æ•°æŒ‡å®šalignerçš„å­¦ä¹ ç‡ï¼Œé»˜è®¤ä¸ºNoneï¼Œç­‰äºlearning_rateã€‚
- lr_scheduler_type: lr_schedulerç±»å‹ï¼Œé»˜è®¤ä¸º'cosine'ã€‚
- lr_scheduler_kwargs: lr_schedulerå…¶ä»–å‚æ•°ã€‚é»˜è®¤ä¸ºNoneã€‚
- gradient_checkpointing_kwargs: ä¼ å…¥`torch.utils.checkpoint`ä¸­çš„å‚æ•°ã€‚ä¾‹å¦‚è®¾ç½®ä¸º`--gradient_checkpointing_kwargs '{"use_reentrant": false}'`ã€‚é»˜è®¤ä¸ºNoneã€‚
  - æ³¨æ„ï¼šå½“ä½¿ç”¨DDPè€Œä¸ä½¿ç”¨deepspeed/fsdpï¼Œä¸”gradient_checkpointing_kwargsä¸ºNoneï¼Œä¼šé»˜è®¤è®¾ç½®å…¶ä¸º`'{"use_reentrant": false}'`è€Œé¿å…å‡ºç°æŠ¥é”™ã€‚
- full_determinism: ç¡®ä¿è®­ç»ƒä¸­è·å¾—å¯é‡ç°çš„ç»“æœï¼Œæ³¨æ„ï¼šè¿™ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚é»˜è®¤ä¸ºFalseã€‚
- ğŸ”¥report_to: é»˜è®¤å€¼ä¸º`tensorboard`ã€‚ä½ ä¹Ÿå¯ä»¥æŒ‡å®š`--report_to tensorboard wandb swanlab`ã€`--report_to all`ã€‚
- logging_first_step: æ˜¯å¦è®°å½•ç¬¬ä¸€ä¸ªstepçš„æ—¥å¿—ï¼Œé»˜è®¤ä¸ºTrueã€‚
- logging_steps: æ—¥å¿—æ‰“å°é—´éš”ï¼Œé»˜è®¤ä¸º5ã€‚
- router_aux_loss_coef: ç”¨äºmoeæ¨¡å‹è®­ç»ƒæ—¶ï¼Œè®¾ç½® aux_loss çš„æƒé‡ï¼Œé»˜è®¤ä¸º`0.`ã€‚
  - æ³¨æ„ï¼šåœ¨"ms-swift==3.7.0"ï¼Œå…¶é»˜è®¤ä¸ºNoneï¼Œä»config.jsonä¸­è¯»å–ï¼Œè¯¥è¡Œä¸ºåœ¨"ms-swift>=3.7.1"è¢«ä¿®æ”¹ã€‚
- enable_dft_loss: æ˜¯å¦åœ¨SFTè®­ç»ƒä¸­ä½¿ç”¨[DFT](https://arxiv.org/abs/2508.05629) (Dynamic Fine-Tuning) lossï¼Œé»˜è®¤ä¸ºFalseã€‚
- enable_channel_loss: å¯ç”¨channel lossï¼Œé»˜è®¤ä¸º`False`ã€‚ä½ éœ€è¦åœ¨æ•°æ®é›†ä¸­å‡†å¤‡"channel"å­—æ®µï¼Œms-swiftä¼šæ ¹æ®è¯¥å­—æ®µåˆ†ç»„ç»Ÿè®¡lossï¼ˆè‹¥æœªå‡†å¤‡"channel"å­—æ®µï¼Œåˆ™å½’ä¸ºé»˜è®¤`None` channelï¼‰ã€‚æ•°æ®é›†æ ¼å¼å‚è€ƒ[channel loss](../Customization/è‡ªå®šä¹‰æ•°æ®é›†.md#channel-loss)ã€‚channel losså…¼å®¹packing/padding_free/loss_scaleç­‰æŠ€æœ¯ã€‚
  - æ³¨æ„ï¼šè¯¥å‚æ•°ä¸º"ms-swift>=3.8"æ–°å¢ï¼Œè‹¥è¦åœ¨"ms-swift<3.8"ä½¿ç”¨channel lossï¼Œè¯·æŸ¥çœ‹v3.7æ–‡æ¡£ã€‚
- logging_dir: tensorboardæ—¥å¿—ä¿å­˜è·¯å¾„ã€‚é»˜è®¤ä¸ºNoneï¼Œå³è®¾ç½®ä¸º`f'{self.output_dir}/runs'`ã€‚
- ğŸ”¥predict_with_generate: éªŒè¯æ—¶ä½¿ç”¨ç”Ÿæˆå¼çš„æ–¹å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚
- metric_for_best_model: é»˜è®¤ä¸ºNoneï¼Œå³å½“`predict_with_generate`è®¾ç½®ä¸ºFalseæ—¶ï¼Œè®¾ç½®ä¸º'loss'ï¼Œå¦åˆ™è®¾ç½®ä¸º'rouge-l'ï¼ˆåœ¨PPOè®­ç»ƒæ—¶ï¼Œä¸è¿›è¡Œé»˜è®¤å€¼è®¾ç½®ï¼›GRPOè®­ç»ƒè®¾ç½®ä¸º'reward'ï¼‰ã€‚
- greater_is_better: é»˜è®¤ä¸ºNoneï¼Œå³å½“`metric_for_best_model`å«'loss'æ—¶ï¼Œè®¾ç½®ä¸ºFalseï¼Œå¦åˆ™è®¾ç½®ä¸ºTrueã€‚
- max_epochs: è®­ç»ƒåˆ°`max_epochs`æ—¶å¼ºåˆ¶é€€å‡ºè®­ç»ƒï¼Œå¹¶å¯¹æƒé‡è¿›è¡ŒéªŒè¯å’Œä¿å­˜ã€‚è¯¥å‚æ•°åœ¨ä½¿ç”¨æµå¼æ•°æ®é›†æ—¶å¾ˆæœ‰ç”¨ã€‚é»˜è®¤ä¸ºNoneã€‚

å…¶ä»–é‡è¦å‚æ•°ï¼š
- ğŸ”¥num_train_epochs: è®­ç»ƒçš„epochæ•°ï¼Œé»˜è®¤ä¸º3ã€‚
- ğŸ”¥save_strategy: ä¿å­˜æ¨¡å‹çš„ç­–ç•¥ï¼Œå¯é€‰ä¸º'no'ã€'steps'ã€'epoch'ï¼Œé»˜è®¤ä¸º'steps'ã€‚
- ğŸ”¥save_steps: é»˜è®¤ä¸º500ã€‚
- ğŸ”¥eval_strategy: è¯„ä¼°ç­–ç•¥ã€‚é»˜è®¤ä¸ºNoneï¼Œè·Ÿéš`save_strategy`çš„ç­–ç•¥ã€‚
  - è‹¥ä¸ä½¿ç”¨`val_dataset`å’Œ`eval_dataset`ä¸”`split_dataset_ratio`ä¸º0ï¼Œåˆ™é»˜è®¤ä¸º'no'ã€‚
- ğŸ”¥eval_steps: é»˜è®¤ä¸ºNoneï¼Œå¦‚æœå­˜åœ¨è¯„ä¼°æ•°æ®é›†ï¼Œåˆ™è·Ÿéš`save_steps`çš„ç­–ç•¥ã€‚
- ğŸ”¥save_total_limit: æœ€å¤šä¿å­˜çš„checkpointæ•°ï¼Œä¼šå°†è¿‡æœŸçš„checkpointè¿›è¡Œåˆ é™¤ã€‚é»˜è®¤ä¸ºNoneï¼Œä¿å­˜æ‰€æœ‰çš„checkpointã€‚
- max_steps: æœ€å¤§è®­ç»ƒçš„stepsæ•°ã€‚åœ¨æ•°æ®é›†ä¸ºæµå¼æ—¶éœ€è¦è¢«è®¾ç½®ã€‚é»˜è®¤ä¸º-1ã€‚
- ğŸ”¥warmup_ratio: é»˜è®¤ä¸º0.ã€‚
- save_on_each_node: åœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œæƒé‡ä¿å­˜ã€‚é»˜è®¤ä¸ºFalseã€‚è¯¥å‚æ•°åœ¨å¤šæœºè®­ç»ƒæ—¶éœ€è¦è¢«è€ƒè™‘ã€‚
  - æç¤ºï¼šåœ¨å¤šæœºè®­ç»ƒæ—¶ï¼Œé€šå¸¸å°†`output_dir`è®¾ç½®ä¸ºèŠ‚ç‚¹å…±äº«ç›®å½•ï¼Œå› æ­¤æ— éœ€é¢å¤–è®¾ç½®è¯¥å‚æ•°ã€‚
- save_only_model: æ˜¯å¦åªä¿å­˜æ¨¡å‹æƒé‡è€Œä¸åŒ…å«ä¼˜åŒ–å™¨çŠ¶æ€ï¼Œéšæœºç§å­çŠ¶æ€ç­‰å†…å®¹ï¼Œè¿™åœ¨å…¨å‚æ•°è®­ç»ƒæ—¶å¯ä»¥å‡å°‘ä¿å­˜çš„æ—¶é—´æ¶ˆè€—å’Œç©ºé—´å ç”¨ã€‚é»˜è®¤ä¸ºFalseã€‚
- ğŸ”¥resume_from_checkpoint: æ–­ç‚¹ç»­è®­å‚æ•°ï¼ŒæŒ‡å®šcheckpointè·¯å¾„ã€‚é»˜è®¤ä¸ºNoneã€‚
  - æç¤ºï¼š**æ–­ç‚¹ç»­è®­è¯·ä¿æŒå…¶ä»–å‚æ•°ä¸å˜ï¼Œé¢å¤–å¢åŠ `--resume_from_checkpoint checkpoint_dir`**ã€‚æƒé‡ç­‰ä¿¡æ¯å°†åœ¨trainerä¸­è¯»å–ã€‚
  - æ³¨æ„: resume_from_checkpointä¼šè¯»å–æ¨¡å‹æƒé‡ï¼Œä¼˜åŒ–å™¨çŠ¶æ€ï¼Œéšæœºç§å­ï¼Œå¹¶ä»ä¸Šæ¬¡è®­ç»ƒçš„stepsç»§ç»­å¼€å§‹è®­ç»ƒã€‚ä½ å¯ä»¥æŒ‡å®š`--resume_only_model`åªè¯»å–æ¨¡å‹æƒé‡ã€‚
- resume_only_model: é»˜è®¤ä¸ºFalseã€‚å¦‚æœåœ¨æŒ‡å®šresume_from_checkpointçš„åŸºç¡€ä¸Šï¼Œå°†è¯¥å‚æ•°è®¾ç½®ä¸ºTrueï¼Œåˆ™ä»…resumeæ¨¡å‹æƒé‡ï¼Œè€Œå¿½ç•¥ä¼˜åŒ–å™¨çŠ¶æ€å’Œéšæœºç§å­ã€‚
  - æ³¨æ„ï¼šåœ¨"ms-swift>=3.7"ï¼Œ**resume_only_modelé»˜è®¤å°†è¿›è¡Œæ•°æ®è·³è¿‡**ï¼Œæ­¤è¡Œä¸ºå¯é€šè¿‡ `ignore_data_skip` å‚æ•°æ§åˆ¶ã€‚è‹¥è¦æ¢å¤"ms-swift<3.7"çš„è¡Œä¸ºï¼Œè¯·è®¾ç½®`--ignore_data_skip true`ã€‚
- ignore_data_skip: å½“è®¾ç½®`resume_from_checkpoint`å’Œ`resume_only_model`æ—¶ï¼Œè¯¥å‚æ•°æ§åˆ¶æ˜¯å¦è·³è¿‡å·²ç»è®­ç»ƒçš„æ•°æ®ï¼Œå¹¶å°†epochå’Œè¿­ä»£æ•°ç­‰è®­ç»ƒçŠ¶æ€è¿›è¡Œæ¢å¤ã€‚é»˜è®¤ä¸ºFalseã€‚è‹¥è®¾ç½®ä¸ºTrueï¼Œåˆ™å°†ä¸åŠ è½½è®­ç»ƒçŠ¶æ€å¹¶ä¸è¿›è¡Œæ•°æ®è·³è¿‡ï¼Œå°†ä»è¿­ä»£æ•°0å¼€å§‹è®­ç»ƒã€‚
- ğŸ”¥ddp_find_unused_parameters: é»˜è®¤ä¸ºNoneã€‚
- ğŸ”¥dataloader_num_workers: é»˜è®¤ä¸ºNoneï¼Œè‹¥æ˜¯windowså¹³å°ï¼Œåˆ™è®¾ç½®ä¸º0ï¼Œå¦åˆ™è®¾ç½®ä¸º1ã€‚
- dataloader_pin_memory: é»˜è®¤ä¸ºTrueã€‚
- dataloader_persistent_workers: é»˜è®¤ä¸ºFalseã€‚
- dataloader_prefetch_factor: é»˜è®¤ä¸ºNoneï¼Œè‹¥`dataloader_num_workers>0`ï¼Œè®¾ç½®ä¸º10ã€‚
- train_dataloader_shuffle: CPT/SFTè®­ç»ƒçš„dataloaderæ˜¯å¦éšæœºï¼Œé»˜è®¤ä¸ºTrueã€‚è¯¥å‚æ•°å¯¹IterableDatasetæ— æ•ˆã€‚IterableDataseté‡‡ç”¨é¡ºåºçš„æ–¹å¼è¯»å–ã€‚
- ğŸ”¥neftune_noise_alpha: neftuneæ·»åŠ çš„å™ªå£°ç³»æ•°ã€‚é»˜è®¤ä¸º0ï¼Œé€šå¸¸å¯ä»¥è®¾ç½®ä¸º5ã€10ã€15ã€‚
- ğŸ”¥use_liger_kernel: æ˜¯å¦å¯ç”¨[Liger](https://github.com/linkedin/Liger-Kernel)å†…æ ¸åŠ é€Ÿè®­ç»ƒå¹¶å‡å°‘æ˜¾å­˜æ¶ˆè€—ã€‚é»˜è®¤ä¸ºFalseã€‚ç¤ºä¾‹shellå‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/blob/main/examples/train/liger)ã€‚
  - æ³¨æ„ï¼šliger_kernelä¸æ”¯æŒdevice_mapï¼Œè¯·ä½¿ç”¨DDP/DeepSpeedè¿›è¡Œå¤šå¡è®­ç»ƒã€‚liger_kernelç›®å‰åªæ”¯æŒ`task_type='causal_lm'`ã€‚
- average_tokens_across_devices: æ˜¯å¦åœ¨è®¾å¤‡ä¹‹é—´è¿›è¡Œtokenæ•°å¹³å‡ã€‚å¦‚æœè®¾ç½®ä¸ºTrueï¼Œå°†ä½¿ç”¨all_reduceåŒæ­¥`num_tokens_in_batch`ä»¥è¿›è¡Œç²¾ç¡®çš„æŸå¤±è®¡ç®—ã€‚é»˜è®¤ä¸ºFalseã€‚
- max_grad_norm: æ¢¯åº¦è£å‰ªã€‚é»˜è®¤ä¸º1.ã€‚
  - æ³¨æ„ï¼šæ—¥å¿—ä¸­çš„grad_normè®°å½•çš„æ˜¯è£å‰ªå‰çš„å€¼ã€‚
- push_to_hub: æ¨é€checkpointåˆ°hubã€‚é»˜è®¤ä¸ºFalseã€‚
- hub_model_id: é»˜è®¤ä¸ºNoneã€‚
- hub_private_repo: é»˜è®¤ä¸ºFalseã€‚

### Tunerå‚æ•°
- ğŸ”¥freeze_llm: è¯¥å‚æ•°åªå¯¹å¤šæ¨¡æ€æ¨¡å‹ç”Ÿæ•ˆï¼Œå¯ç”¨äºå…¨å‚æ•°è®­ç»ƒå’ŒLoRAè®­ç»ƒï¼Œä½†ä¼šäº§ç”Ÿä¸åŒçš„æ•ˆæœã€‚è‹¥æ˜¯å…¨å‚æ•°è®­ç»ƒï¼Œå°†freeze_llmè®¾ç½®ä¸ºTrueä¼šå°†LLMéƒ¨åˆ†æƒé‡è¿›è¡Œå†»ç»“ï¼›è‹¥æ˜¯LoRAè®­ç»ƒä¸”`target_modules`è®¾ç½®ä¸º'all-linear'ï¼Œå°†freeze_llmè®¾ç½®ä¸ºTrueå°†ä¼šå–æ¶ˆåœ¨LLMéƒ¨åˆ†æ·»åŠ LoRAæ¨¡å—ã€‚è¯¥å‚æ•°é»˜è®¤ä¸ºFalseã€‚
- ğŸ”¥freeze_vit: è¯¥å‚æ•°åªå¯¹å¤šæ¨¡æ€æ¨¡å‹ç”Ÿæ•ˆï¼Œå¯ç”¨äºå…¨å‚æ•°è®­ç»ƒå’ŒLoRAè®­ç»ƒï¼Œä½†ä¼šäº§ç”Ÿä¸åŒçš„æ•ˆæœã€‚è‹¥æ˜¯å…¨å‚æ•°è®­ç»ƒï¼Œå°†freeze_vitè®¾ç½®ä¸ºTrueä¼šå°†vitéƒ¨åˆ†æƒé‡è¿›è¡Œå†»ç»“ï¼›è‹¥æ˜¯LoRAè®­ç»ƒä¸”`target_modules`è®¾ç½®ä¸º'all-linear'ï¼Œå°†freeze_vitè®¾ç½®ä¸ºTrueå°†ä¼šå–æ¶ˆåœ¨vitéƒ¨åˆ†æ·»åŠ LoRAæ¨¡å—ã€‚è¯¥å‚æ•°é»˜è®¤ä¸ºTrueã€‚
  - æ³¨æ„ï¼š**è¿™é‡Œçš„vitä¸ä»…é™äºvision_tower, ä¹ŸåŒ…æ‹¬audio_tower**ã€‚è‹¥æ˜¯Omniæ¨¡å‹ï¼Œè‹¥ä½ åªå¸Œæœ›å¯¹vision_toweråŠ LoRAï¼Œè€Œä¸å¸Œæœ›å¯¹audio_toweråŠ LoRAï¼Œä½ å¯ä»¥ä¿®æ”¹[è¿™é‡Œçš„ä»£ç ](https://github.com/modelscope/ms-swift/blob/a5d4c0a2ce0658cef8332d6c0fa619a52afa26ff/swift/llm/model/model_arch.py#L544-L554)ã€‚
- ğŸ”¥freeze_aligner: è¯¥å‚æ•°åªå¯¹å¤šæ¨¡æ€æ¨¡å‹ç”Ÿæ•ˆï¼Œå¯ç”¨äºå…¨å‚æ•°è®­ç»ƒå’ŒLoRAè®­ç»ƒï¼Œä½†ä¼šäº§ç”Ÿä¸åŒçš„æ•ˆæœã€‚è‹¥æ˜¯å…¨å‚æ•°è®­ç»ƒï¼Œå°†freeze_alignerè®¾ç½®ä¸ºTrueä¼šå°†alignerï¼ˆä¹Ÿç§°ä¸ºprojectorï¼‰éƒ¨åˆ†æƒé‡è¿›è¡Œå†»ç»“ï¼›è‹¥æ˜¯LoRAè®­ç»ƒä¸”`target_modules`è®¾ç½®ä¸º'all-linear'ï¼Œå°†freeze_alignerè®¾ç½®ä¸ºTrueå°†ä¼šå–æ¶ˆåœ¨aligneréƒ¨åˆ†æ·»åŠ LoRAæ¨¡å—ã€‚è¯¥å‚æ•°é»˜è®¤ä¸ºTrueã€‚
- ğŸ”¥target_modules: æŒ‡å®šloraæ¨¡å—, é»˜è®¤ä¸º`['all-linear']`ã€‚ä½ ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºmoduleçš„åç¼€ï¼Œä¾‹å¦‚ï¼š`--target_modules q_proj k_proj v_proj`ã€‚è¯¥å‚æ•°ä¸é™äºLoRAï¼Œå¯ç”¨äºå…¶ä»–tunersã€‚
  - æ³¨æ„ï¼šåœ¨LLMå’Œå¤šæ¨¡æ€LLMä¸­ï¼Œ'all-linear'çš„è¡Œä¸ºæœ‰æ‰€ä¸åŒã€‚è‹¥æ˜¯LLMåˆ™è‡ªåŠ¨å¯»æ‰¾é™¤lm_headå¤–çš„linearå¹¶é™„åŠ tunerï¼›**è‹¥æ˜¯å¤šæ¨¡æ€LLMï¼Œåˆ™é»˜è®¤åªåœ¨LLMä¸Šé™„åŠ tunerï¼Œè¯¥è¡Œä¸ºå¯ä»¥è¢«`freeze_llm`ã€`freeze_vit`ã€`freeze_aligner`æ§åˆ¶**ã€‚
- ğŸ”¥target_regex: æŒ‡å®šloraæ¨¡å—çš„regexè¡¨è¾¾å¼ï¼Œé»˜è®¤ä¸º`None`ã€‚å¦‚æœè¯¥å€¼ä¼ å…¥ï¼Œåˆ™target_moduleså‚æ•°å¤±æ•ˆã€‚ä¾‹å¦‚ä½ å¯ä»¥è®¾ç½®`--target_regex '^(language_model).*\.(q_proj|k_proj|v_proj|o_proj|gate_proj|up_proj|down_proj)$'`ï¼Œå°†ç¬¦åˆè¯¥æ­£åˆ™çš„æ¨¡å—æŒ‡å®šä¸ºLoRAæ¨¡å—ã€‚è¯¥å‚æ•°ä¸é™äºLoRAï¼Œå¯ç”¨äºå…¶ä»–tunersã€‚
- target_parameters: è¦æ›¿æ¢ä¸ºLoRAçš„å‚æ•°åç§°åˆ—è¡¨ã€‚è¯¥å‚æ•°çš„è¡Œä¸ºä¸ `target_modules` ç±»ä¼¼ï¼Œä½†ä¼ å…¥çš„åº”æ˜¯å‚æ•°åç§°è€Œä¸æ˜¯æ¨¡å—åç§°ã€‚è¯¥ç‰¹æ€§éœ€è¦å®‰è£…"peft>=0.17.0"ã€‚ä¾‹å¦‚ï¼Œåœ¨ Hugging Face Transformers ä¸­è®¸å¤šæ··åˆä¸“å®¶ï¼ˆMoEï¼‰å±‚ä¸­ï¼Œå¹¶æœªä½¿ç”¨ `nn.Linear`ï¼Œè€Œæ˜¯ä½¿ç”¨äº† `nn.Parameter`ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨target_parameterså‚æ•°å®ç°ã€‚
- init_weights: åˆå§‹åŒ–weightsçš„æ–¹æ³•ï¼ŒLoRAå¯ä»¥æŒ‡å®šä¸º`true`ã€`false`ã€`gaussian`ã€`pissa`ã€`pissa_niter_[number of iters]`ï¼ŒBoneå¯ä»¥æŒ‡å®šä¸º`true`ã€`false`ã€`bat`ã€‚é»˜è®¤å€¼`true`ã€‚
- ğŸ”¥modules_to_save: åœ¨å·²é™„åŠ tuneråï¼Œé¢å¤–æŒ‡å®šä¸€éƒ¨åˆ†åŸæ¨¡å‹æ¨¡å—å‚ä¸è®­ç»ƒå’Œå­˜å‚¨ã€‚é»˜è®¤ä¸º`[]`ã€‚è¯¥å‚æ•°ä¸é™äºLoRAï¼Œå¯ç”¨äºå…¶ä»–tunersã€‚ä¾‹å¦‚è®¾ç½®ä¸º`--modules_to_save embed_tokens lm_head`ï¼Œåœ¨LoRAè®­ç»ƒä¸­è§£å¼€embed_tokenså’Œlm_headå±‚è¿›è¡Œè®­ç»ƒï¼Œè¿™ä¸¤éƒ¨åˆ†çš„æƒé‡ä¿¡æ¯æœ€ç»ˆä¼šä¿å­˜åœ¨`adapter_model.safetensors`ä¸­ã€‚

#### å…¨å‚
- freeze_parameters: éœ€è¦è¢«å†»ç»“å‚æ•°çš„å‰ç¼€ï¼Œé»˜è®¤ä¸º`[]`ã€‚
- freeze_parameters_regex: éœ€è¦è¢«å†»ç»“å‚æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé»˜è®¤ä¸ºNoneã€‚
- freeze_parameters_ratio: ä»ä¸‹å¾€ä¸Šå†»ç»“çš„å‚æ•°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º0ã€‚å¯è®¾ç½®ä¸º1å°†æ‰€æœ‰å‚æ•°å†»ç»“ï¼Œç»“åˆ`trainable_parameters`è®¾ç½®å¯è®­ç»ƒå‚æ•°ã€‚
- trainable_parameters: é¢å¤–å¯è®­ç»ƒå‚æ•°çš„å‰ç¼€ï¼Œé»˜è®¤ä¸º`[]`ã€‚
- trainable_parameters_regex: åŒ¹é…é¢å¤–å¯è®­ç»ƒå‚æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé»˜è®¤ä¸ºNoneã€‚
Â  - å¤‡æ³¨ï¼š`trainable_parameters`ã€`trainable_parameters_regex`çš„ä¼˜å…ˆçº§é«˜äº`freeze_parameters`ã€`freeze_parameters_regex`å’Œ`freeze_parameters_ratio`ã€‚ä¾‹å¦‚ï¼šå½“æŒ‡å®šå…¨å‚æ•°è®­ç»ƒæ—¶ï¼Œä¼šå°†æ‰€æœ‰æ¨¡å—è®¾ç½®ä¸ºå¯è®­ç»ƒçš„çŠ¶æ€ï¼Œéšåæ ¹æ®`freeze_parameters`ã€`freeze_parameters_regex`ã€`freeze_parameters_ratio`å°†éƒ¨åˆ†å‚æ•°å†»ç»“ï¼Œæœ€åæ ¹æ®`trainable_parameters`ã€`trainable_parameters_regex`é‡æ–°æ‰“å¼€éƒ¨åˆ†å‚æ•°å‚ä¸è®­ç»ƒã€‚

#### LoRA
- ğŸ”¥lora_rank: é»˜è®¤ä¸º`8`ã€‚
- ğŸ”¥lora_alpha: é»˜è®¤ä¸º`32`ã€‚
- lora_dropout: é»˜è®¤ä¸º`0.05`ã€‚
- lora_bias: é»˜è®¤ä¸º`'none'`ï¼Œå¯ä»¥é€‰æ‹©çš„å€¼: 'none'ã€'all'ã€‚å¦‚æœä½ è¦å°†biaså…¨éƒ½è®¾ç½®ä¸ºå¯è®­ç»ƒï¼Œä½ å¯ä»¥è®¾ç½®ä¸º`'all'`ã€‚
- lora_dtype: æŒ‡å®šloraæ¨¡å—çš„dtypeç±»å‹ã€‚æ”¯æŒ'float16'ã€'bfloat16'ã€'float32'ã€‚é»˜è®¤ä¸ºNoneï¼Œè·Ÿéšpeftè¡Œä¸ºã€‚
- ğŸ”¥use_dora: é»˜è®¤ä¸º`False`ï¼Œæ˜¯å¦ä½¿ç”¨`DoRA`ã€‚
- use_rslora: é»˜è®¤ä¸º`False`ï¼Œæ˜¯å¦ä½¿ç”¨`RS-LoRA`ã€‚
- ğŸ”¥lorap_lr_ratio: LoRA+å‚æ•°ï¼Œé»˜è®¤å€¼`None`ï¼Œå»ºè®®å€¼ä¸º`10~16`ã€‚ä½¿ç”¨loraæ—¶é¢å¤–æŒ‡å®šè¯¥å‚æ•°å¯ä½¿ç”¨lora+ã€‚

##### LoRA-GA
- lora_ga_batch_size: é»˜è®¤å€¼ä¸º `2`ã€‚åœ¨ LoRA-GA ä¸­ä¼°è®¡æ¢¯åº¦ä»¥è¿›è¡Œåˆå§‹åŒ–æ—¶ä½¿ç”¨çš„æ‰¹å¤„ç†å¤§å°ã€‚
- lora_ga_iters: é»˜è®¤å€¼ä¸º `2`ã€‚åœ¨ LoRA-GA ä¸­ä¼°è®¡æ¢¯åº¦ä»¥è¿›è¡Œåˆå§‹åŒ–æ—¶çš„è¿­ä»£æ¬¡æ•°ã€‚
- lora_ga_max_length: é»˜è®¤å€¼ä¸º `1024`ã€‚åœ¨ LoRA-GA ä¸­ä¼°è®¡æ¢¯åº¦ä»¥è¿›è¡Œåˆå§‹åŒ–æ—¶çš„æœ€å¤§è¾“å…¥é•¿åº¦ã€‚
- lora_ga_direction: é»˜è®¤å€¼ä¸º `ArB2r`ã€‚åœ¨ LoRA-GA ä¸­ä½¿ç”¨ä¼°è®¡æ¢¯åº¦è¿›è¡Œåˆå§‹åŒ–æ—¶çš„åˆå§‹æ–¹å‘ã€‚å…è®¸çš„å€¼æœ‰ï¼š`ArBr`ã€`A2rBr`ã€`ArB2r` å’Œ `random`ã€‚
- lora_ga_scale: é»˜è®¤å€¼ä¸º `stable`ã€‚LoRA-GA çš„åˆå§‹åŒ–ç¼©æ”¾æ–¹å¼ã€‚å…è®¸çš„å€¼æœ‰ï¼š`gd`ã€`unit`ã€`stable` å’Œ `weightS`ã€‚
- lora_ga_stable_gamma: é»˜è®¤å€¼ä¸º `16`ã€‚å½“åˆå§‹åŒ–æ—¶é€‰æ‹© `stable` ç¼©æ”¾æ—¶çš„ gamma å€¼ã€‚

#### FourierFt

FourierFtä½¿ç”¨`target_modules`ã€`target_regex`ã€`modules_to_save`ä¸‰ä¸ªå‚æ•°ï¼Œå«ä¹‰è§ä¸Šé¢æ–‡æ¡£ä¸­çš„æè¿°ã€‚é¢å¤–å‚æ•°åŒ…æ‹¬ï¼š

- fourier_n_frequency: å‚…é‡Œå¶å˜æ¢çš„é¢‘ç‡æ•°é‡, `int`ç±»å‹, ç±»ä¼¼äºLoRAä¸­çš„`r`. é»˜è®¤å€¼`2000`.
- fourier_scaling: WçŸ©é˜µçš„ç¼©æ”¾å€¼, `float`ç±»å‹, ç±»ä¼¼LoRAä¸­çš„`lora_alpha`. é»˜è®¤å€¼`300.0`.

#### BOFT

BOFTä½¿ç”¨`target_modules`ã€`target_regex`ã€`modules_to_save`ä¸‰ä¸ªå‚æ•°ï¼Œå«ä¹‰è§ä¸Šé¢æ–‡æ¡£ä¸­çš„æè¿°ã€‚é¢å¤–å‚æ•°åŒ…æ‹¬ï¼š

- boft_block_size: BOFTå—å°ºå¯¸, é»˜è®¤å€¼4.
- boft_block_num: BOFTå—æ•°é‡, ä¸èƒ½å’Œ`boft_block_size`åŒæ—¶ä½¿ç”¨.
- boft_dropout: boftçš„dropoutå€¼, é»˜è®¤0.0.

#### Vera

Veraä½¿ç”¨`target_modules`ã€`target_regex`ã€`modules_to_save`ä¸‰ä¸ªå‚æ•°ï¼Œå«ä¹‰è§ä¸Šé¢æ–‡æ¡£ä¸­çš„æè¿°ã€‚é¢å¤–å‚æ•°åŒ…æ‹¬ï¼š

- vera_rank: Vera Attentionçš„å°ºå¯¸, é»˜è®¤å€¼256.
- vera_projection_prng_key: æ˜¯å¦å­˜å‚¨Veraæ˜ å°„çŸ©é˜µ, é»˜è®¤ä¸ºTrue.
- vera_dropout: Veraçš„dropoutå€¼, é»˜è®¤`0.0`.
- vera_d_initial: Veraçš„dçŸ©é˜µçš„åˆå§‹å€¼, é»˜è®¤`0.1`.

#### GaLore

- ğŸ”¥use_galore: é»˜è®¤å€¼False, æ˜¯å¦ä½¿ç”¨GaLore.
- galore_target_modules: é»˜è®¤å€¼None, ä¸ä¼ çš„æƒ…å†µä¸‹å¯¹attentionå’Œmlpåº”ç”¨GaLore.
- galore_rank: é»˜è®¤å€¼128, GaLoreçš„rankå€¼.
- galore_update_proj_gap: é»˜è®¤å€¼50, åˆ†è§£çŸ©é˜µçš„æ›´æ–°é—´éš”.
- galore_scale: é»˜è®¤å€¼1.0, çŸ©é˜µæƒé‡ç³»æ•°.
- galore_proj_type: é»˜è®¤å€¼`std`, GaLoreçŸ©é˜µåˆ†è§£ç±»å‹.
- galore_optim_per_parameter: é»˜è®¤å€¼False, æ˜¯å¦ç»™æ¯ä¸ªGaloreç›®æ ‡Parameterè®¾å®šä¸€ä¸ªå•ç‹¬çš„optimizer.
- galore_with_embedding: é»˜è®¤å€¼False, æ˜¯å¦å¯¹embeddingåº”ç”¨GaLore.
- galore_quantization: æ˜¯å¦ä½¿ç”¨q-galore. é»˜è®¤å€¼`False`.
- galore_proj_quant: æ˜¯å¦å¯¹SVDåˆ†è§£çŸ©é˜µåšé‡åŒ–, é»˜è®¤`False`.
- galore_proj_bits: SVDé‡åŒ–bitæ•°.
- galore_proj_group_size: SVDé‡åŒ–åˆ†ç»„æ•°.
- galore_cos_threshold: æŠ•å½±çŸ©é˜µæ›´æ–°çš„cosç›¸ä¼¼åº¦é˜ˆå€¼. é»˜è®¤å€¼0.4.
- galore_gamma_proj: åœ¨æŠ•å½±çŸ©é˜µé€æ¸ç›¸ä¼¼åä¼šæ‹‰é•¿æ›´æ–°é—´éš”, æœ¬å‚æ•°ä¸ºæ¯æ¬¡æ‹‰é•¿é—´éš”çš„ç³»æ•°, é»˜è®¤å€¼2.
- galore_queue_size: è®¡ç®—æŠ•å½±çŸ©é˜µç›¸ä¼¼åº¦çš„é˜Ÿåˆ—é•¿åº¦, é»˜è®¤å€¼5.

#### LISA

æ³¨æ„: LISAä»…æ”¯æŒå…¨å‚æ•°ï¼Œå³`--train_type full`ã€‚

- ğŸ”¥lisa_activated_layers: é»˜è®¤å€¼`0`, ä»£è¡¨ä¸ä½¿ç”¨LISAï¼Œæ”¹ä¸ºé0ä»£è¡¨éœ€è¦æ¿€æ´»çš„layersä¸ªæ•°ï¼Œå»ºè®®è®¾ç½®ä¸º2æˆ–8.
- lisa_step_interval: é»˜è®¤å€¼`20`, å¤šå°‘iteråˆ‡æ¢å¯åå‘ä¼ æ’­çš„layers.

#### UNSLOTH

ğŸ”¥unslothæ— æ–°å¢å‚æ•°ï¼Œå¯¹å·²æœ‰å‚æ•°è¿›è¡Œè°ƒèŠ‚å³å¯æ”¯æŒï¼Œä¾‹å¦‚ï¼š

```
--tuner_backend unsloth
--train_type full/lora
--quant_bits 4
```

#### LLAMAPRO

- ğŸ”¥llamapro_num_new_blocks: é»˜è®¤å€¼`4`, æ’å…¥çš„æ–°layersæ€»æ•°.
- llamapro_num_groups: é»˜è®¤å€¼`None`, åˆ†ä¸ºå¤šå°‘ç»„æ’å…¥new_blocks, å¦‚æœä¸º`None`åˆ™ç­‰äº`llamapro_num_new_blocks`, å³æ¯ä¸ªæ–°çš„layerå•ç‹¬æ’å…¥åŸæ¨¡å‹.

#### AdaLoRA

ä»¥ä¸‹å‚æ•°`train_type`è®¾ç½®ä¸º`adalora`æ—¶ç”Ÿæ•ˆ. adaloraçš„`target_modules`ç­‰å‚æ•°ç»§æ‰¿äºloraçš„å¯¹åº”å‚æ•°ï¼Œä½†`lora_dtype`å‚æ•°ä¸ç”Ÿæ•ˆã€‚

- adalora_target_r: é»˜è®¤å€¼`8`, adaloraçš„å¹³å‡rank.
- adalora_init_r: é»˜è®¤å€¼`12`, adaloraçš„åˆå§‹rank.
- adalora_tinit: é»˜è®¤å€¼`0`, adaloraçš„åˆå§‹warmup.
- adalora_tfinal: é»˜è®¤å€¼`0`, adaloraçš„final warmup.
- adalora_deltaT: é»˜è®¤å€¼`1`, adaloraçš„stepé—´éš”.
- adalora_beta1: é»˜è®¤å€¼`0.85`, adaloraçš„EMAå‚æ•°.
- adalora_beta2: é»˜è®¤å€¼`0.85`, adaloraçš„EMAå‚æ•°.
- adalora_orth_reg_weight: é»˜è®¤å€¼`0.5`, adaloraçš„æ­£åˆ™åŒ–å‚æ•°.

#### ReFT

ä»¥ä¸‹å‚æ•°`train_type`è®¾ç½®ä¸º`reft`æ—¶ç”Ÿæ•ˆ.

> 1. ReFTæ— æ³•åˆå¹¶tuner
> 2. ReFTå’Œgradient_checkpointingä¸å…¼å®¹
> 3. å¦‚æœä½¿ç”¨DeepSpeedé‡åˆ°é—®é¢˜è¯·æš‚æ—¶å¸è½½DeepSpeed

- ğŸ”¥reft_layers: ReFTåº”ç”¨äºå“ªäº›å±‚ä¸Š, é»˜è®¤ä¸º`None`, ä»£è¡¨æ‰€æœ‰å±‚, å¯ä»¥è¾“å…¥å±‚å·çš„list, ä¾‹å¦‚reft_layers 1 2 3 4`
- ğŸ”¥reft_rank: ReFTçŸ©é˜µçš„rank, é»˜è®¤ä¸º`4`.
- reft_intervention_type: ReFTçš„ç±»å‹, æ”¯æŒ'NoreftIntervention', 'LoreftIntervention', 'ConsreftIntervention', 'LobireftIntervention', 'DireftIntervention', 'NodireftIntervention', é»˜è®¤ä¸º`LoreftIntervention`.
- reft_args: ReFT Interventionä¸­çš„å…¶ä»–æ”¯æŒå‚æ•°, ä»¥json-stringæ ¼å¼è¾“å…¥.

### vLLMå‚æ•°
å‚æ•°å«ä¹‰å¯ä»¥æŸ¥çœ‹[vllmæ–‡æ¡£](https://docs.vllm.ai/en/latest/serving/engine_args.html)ã€‚

- ğŸ”¥vllm_gpu_memory_utilization: GPUå†…å­˜æ¯”ä¾‹ï¼Œå–å€¼èŒƒå›´ä¸º0åˆ°1ã€‚é»˜è®¤å€¼`0.9`ã€‚
  - æ³¨æ„ï¼šè¯¥å‚æ•°åœ¨"ms-swift<3.7"çš„å‚æ•°åä¸º`gpu_memory_utilization`ã€‚ä¸‹é¢çš„`vllm_`å‚æ•°åŒç†ã€‚è‹¥å‡ºç°å‚æ•°ä¸åŒ¹é…é—®é¢˜ï¼Œè¯·æŸ¥çœ‹[ms-swift3.6æ–‡æ¡£](https://swift.readthedocs.io/zh-cn/v3.6/Instruction/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0.html#vllm)ã€‚
- ğŸ”¥vllm_tensor_parallel_size: tpå¹¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º`1`ã€‚
- vllm_pipeline_parallel_size: ppå¹¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º`1`ã€‚
- vllm_data_parallel_size: dpå¹¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º`1`ï¼Œåœ¨`swift deploy/rollout`å‘½ä»¤ä¸­ç”Ÿæ•ˆã€‚
  - è‹¥åœ¨`swift infer`ä¸­ï¼Œä½¿ç”¨`NPROC_PER_NODE`æ¥è®¾ç½®dpå¹¶è¡Œæ•°ã€‚å‚è€ƒè¿™é‡Œçš„[ä¾‹å­](https://github.com/modelscope/ms-swift/blob/main/examples/infer/vllm/mllm_ddp.sh)ã€‚
- vllm_enable_expert_parallel: å¼€å¯ä¸“å®¶å¹¶è¡Œï¼Œé»˜è®¤ä¸ºFalseã€‚
- vllm_max_num_seqs: å•æ¬¡è¿­ä»£ä¸­å¤„ç†çš„æœ€å¤§åºåˆ—æ•°ï¼Œé»˜è®¤ä¸º`256`ã€‚
- ğŸ”¥vllm_max_model_len: æ¨¡å‹æ”¯æŒçš„æœ€å¤§é•¿åº¦ã€‚é»˜è®¤ä¸º`None`ï¼Œå³ä»config.jsonä¸­è¯»å–ã€‚
- vllm_disable_custom_all_reduce: ç¦ç”¨è‡ªå®šä¹‰çš„ all-reduce å†…æ ¸ï¼Œå›é€€åˆ° NCCLã€‚ä¸ºäº†ç¨³å®šæ€§ï¼Œé»˜è®¤ä¸º`True`ã€‚
- vllm_enforce_eager: vllmä½¿ç”¨pytorch eageræ¨¡å¼è¿˜æ˜¯å»ºç«‹cuda graphï¼Œé»˜è®¤ä¸º`False`ã€‚è®¾ç½®ä¸ºTrueå¯ä»¥èŠ‚çº¦æ˜¾å­˜ï¼Œä½†ä¼šå½±å“æ•ˆç‡ã€‚
- vllm_mm_processor_cache_gb: å¤šæ¨¡æ€å¤„ç†å™¨ç¼“å­˜å¤§å°ï¼ˆGiBï¼‰ï¼Œç”¨äºç¼“å­˜å·²å¤„ç†çš„å¤šæ¨¡æ€è¾“å…¥ï¼ˆå¦‚å›¾åƒã€è§†é¢‘ï¼‰é¿å…é‡å¤å¤„ç†ã€‚é»˜è®¤ä¸º`4`ã€‚è®¾ç½®ä¸º`0`å¯ç¦ç”¨ç¼“å­˜ä½†ä¼šé™ä½æ€§èƒ½ï¼ˆä¸æ¨èï¼‰ã€‚ä»…å¯¹å¤šæ¨¡æ€æ¨¡å‹ç”Ÿæ•ˆã€‚
- vllm_disable_cascade_attn: æ˜¯å¦å¼ºåˆ¶å…³é—­V1å¼•æ“çš„cascade attentionå®ç°ä»¥é˜²æ­¢æ½œåœ¨æ•°å€¼è¯¯å·®ï¼Œé»˜è®¤ä¸ºFalseï¼Œç”±vLLMå†…éƒ¨é€»è¾‘å†³å®šæ˜¯å¦ä½¿ç”¨ã€‚
- ğŸ”¥vllm_limit_mm_per_prompt: æ§åˆ¶vllmä½¿ç”¨å¤šå›¾ï¼Œé»˜è®¤ä¸º`None`ã€‚ä¾‹å¦‚ä¼ å…¥`--vllm_limit_mm_per_prompt '{"image": 5, "video": 2}'`ã€‚
- vllm_max_lora_rank: é»˜è®¤ä¸º`16`ã€‚vllmå¯¹äºloraæ”¯æŒçš„å‚æ•°ã€‚
- vllm_quantization: vllmå¯ä»¥åœ¨å†…éƒ¨é‡åŒ–æ¨¡å‹ï¼Œå‚æ•°æ”¯æŒçš„å€¼è¯¦è§[è¿™é‡Œ](https://docs.vllm.ai/en/latest/serving/engine_args.html)ã€‚
- ğŸ”¥vllm_enable_prefix_caching: å¼€å¯vllmçš„è‡ªåŠ¨å‰ç¼€ç¼“å­˜ï¼ŒèŠ‚çº¦é‡å¤æŸ¥è¯¢å‰ç¼€çš„å¤„ç†æ—¶é—´ï¼ŒåŠ å¿«æ¨ç†æ•ˆç‡ã€‚é»˜è®¤ä¸º`None`ï¼Œè·ŸéšvLLMè¡Œä¸ºã€‚
  - è¯¥å‚æ•°åœ¨"ms-swift<3.9.1"çš„é»˜è®¤å€¼ä¸º`False`ã€‚
- vllm_use_async_engine: vLLM backendä¸‹æ˜¯å¦ä½¿ç”¨async engineã€‚éƒ¨ç½²æƒ…å†µï¼ˆswift deployï¼‰é»˜è®¤ä¸ºTrueï¼Œå…¶ä»–æƒ…å†µé»˜è®¤ä¸ºFalseã€‚
- vllm_reasoning_parser: æ¨ç†è§£æå™¨ç±»å‹ï¼Œç”¨äºæ€è€ƒæ¨¡å‹çš„æ€ç»´é“¾å†…å®¹è§£æã€‚é»˜è®¤ä¸º`None`ã€‚ä»…ç”¨äº `swift deploy` å‘½ä»¤ã€‚å¯é€‰çš„ç§ç±»å‚è€ƒ[vLLMæ–‡æ¡£](https://docs.vllm.ai/en/latest/features/reasoning_outputs.html#streaming-chat-completions)ã€‚
- vllm_engine_kwargs: vllmçš„é¢å¤–å‚æ•°ï¼Œæ ¼å¼ä¸ºjsonå­—ç¬¦ä¸²ã€‚é»˜è®¤ä¸ºNoneã€‚

### SGLangå‚æ•°
å‚æ•°å«ä¹‰å¯ä»¥æŸ¥çœ‹[sglangæ–‡æ¡£](https://docs.sglang.ai/backend/server_arguments.html)ã€‚

- ğŸ”¥sglang_tp_size: tpæ•°ã€‚é»˜è®¤ä¸º1ã€‚
- sglang_pp_size: ppæ•°ã€‚é»˜è®¤ä¸º1ã€‚
- sglang_dp_size: dpæ•°ã€‚é»˜è®¤ä¸º1ã€‚
- sglang_ep_size: epæ•°ã€‚é»˜è®¤ä¸º1ã€‚
- sglang_enable_ep_moe: æ˜¯å¦å¯ç”¨ep moeã€‚é»˜è®¤ä¸ºFalseã€‚è¯¥å‚æ•°å·²åœ¨æœ€æ–°sglangä¸­ç§»é™¤ã€‚
- sglang_mem_fraction_static: ç”¨äºé™æ€åˆ†é…æ¨¡å‹æƒé‡å’ŒKVç¼“å­˜å†…å­˜æ± çš„GPUå†…å­˜æ¯”ä¾‹ã€‚å¦‚æœä½ é‡åˆ°GPUå†…å­˜ä¸è¶³é”™è¯¯ï¼Œå¯ä»¥å°è¯•é™ä½è¯¥å€¼ã€‚é»˜è®¤ä¸ºNoneã€‚
- sglang_context_length: æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ã€‚é»˜è®¤ä¸º Noneï¼Œå°†ä½¿ç”¨æ¨¡å‹çš„`config.json`ä¸­çš„å€¼ã€‚
- sglang_disable_cuda_graph: ç¦ç”¨CUDAå›¾ã€‚é»˜è®¤ä¸ºFalseã€‚
- sglang_quantization: é‡åŒ–æ–¹æ³•ã€‚é»˜è®¤ä¸ºNoneã€‚
- sglang_kv_cache_dtype: ç”¨äºk/vç¼“å­˜å­˜å‚¨çš„æ•°æ®ç±»å‹ã€‚'auto'è¡¨ç¤ºå°†ä½¿ç”¨æ¨¡å‹çš„æ•°æ®ç±»å‹ã€‚'fp8_e5m2'å’Œ'fp8_e4m3'é€‚ç”¨äºCUDA 11.8åŠä»¥ä¸Šç‰ˆæœ¬ã€‚é»˜è®¤ä¸º'auto'ã€‚
- sglang_enable_dp_attention: ä¸ºæ³¨æ„åŠ›æœºåˆ¶å¯ç”¨æ•°æ®å¹¶è¡Œï¼Œä¸ºå‰é¦ˆç½‘ç»œï¼ˆFFNï¼‰å¯ç”¨å¼ é‡å¹¶è¡Œã€‚æ•°æ®å¹¶è¡Œçš„è§„æ¨¡ï¼ˆdp sizeï¼‰åº”ç­‰äºå¼ é‡å¹¶è¡Œçš„è§„æ¨¡ï¼ˆtp sizeï¼‰ã€‚ç›®å‰æ”¯æŒDeepSeek-V2/3ä»¥åŠQwen2/3 MoEæ¨¡å‹ã€‚é»˜è®¤ä¸ºFalseã€‚
- sglang_disable_custom_all_reduce: ç¦ç”¨è‡ªå®šä¹‰çš„ all-reduce å†…æ ¸ï¼Œå›é€€åˆ° NCCLã€‚ä¸ºäº†ç¨³å®šæ€§ï¼Œé»˜è®¤ä¸ºTrueã€‚

### LMDeployå‚æ•°
å‚æ•°å«ä¹‰å¯ä»¥æŸ¥çœ‹[lmdeployæ–‡æ¡£](https://lmdeploy.readthedocs.io/en/latest/api/pipeline.html#turbomindengineconfig)ã€‚

- ğŸ”¥lmdeploy_tp: tensorå¹¶è¡Œåº¦ã€‚é»˜è®¤ä¸º`1`ã€‚
- lmdeploy_session_len: æœ€å¤§ä¼šè¯é•¿åº¦ã€‚é»˜è®¤ä¸º`None`ã€‚
- lmdeploy_cache_max_entry_count: k/vç¼“å­˜å ç”¨çš„GPUå†…å­˜ç™¾åˆ†æ¯”ã€‚é»˜è®¤ä¸º`0.8`ã€‚
- lmdeploy_quant_policy: é»˜è®¤ä¸º0ã€‚å½“éœ€è¦å°†k/vé‡åŒ–ä¸º4æˆ–8ä½æ—¶ï¼Œåˆ†åˆ«å°†å…¶è®¾ç½®ä¸º4æˆ–8ã€‚
- lmdeploy_vision_batch_size: ä¼ å…¥VisionConfigçš„max_batch_sizeå‚æ•°ã€‚é»˜è®¤ä¸º`1`ã€‚

### åˆå¹¶å‚æ•°

- ğŸ”¥merge_lora: æ˜¯å¦åˆå¹¶loraï¼Œæœ¬å‚æ•°æ”¯æŒloraã€llamaproã€longloraï¼Œé»˜è®¤ä¸ºFalseã€‚ä¾‹å­å‚æ•°[è¿™é‡Œ](https://github.com/modelscope/ms-swift/blob/main/examples/export/merge_lora.sh)ã€‚
- safe_serialization: æ˜¯å¦å­˜å‚¨ä¸ºsafetensorsï¼Œé»˜è®¤ä¸ºTrueã€‚
- max_shard_size: å•å­˜å‚¨æ–‡ä»¶æœ€å¤§å¤§å°ï¼Œé»˜è®¤'5GB'ã€‚


## é›†æˆå‚æ•°

### è®­ç»ƒå‚æ•°
è®­ç»ƒå‚æ•°é™¤åŒ…å«[åŸºæœ¬å‚æ•°](#åŸºæœ¬å‚æ•°)ã€[Seq2SeqTrainerå‚æ•°](#Seq2SeqTrainerå‚æ•°)ã€[tunerå‚æ•°](#tunerå‚æ•°)å¤–ï¼Œè¿˜åŒ…å«ä¸‹é¢çš„éƒ¨åˆ†:

- add_version: åœ¨output_dirä¸Šé¢å¤–å¢åŠ ç›®å½•`'<ç‰ˆæœ¬å·>-<æ—¶é—´æˆ³>'`é˜²æ­¢æƒé‡è¦†ç›–ï¼Œé»˜è®¤ä¸ºTrueã€‚
- check_model: æ£€æŸ¥æœ¬åœ°æ¨¡å‹æ–‡ä»¶æœ‰æŸåæˆ–ä¿®æ”¹å¹¶ç»™å‡ºæç¤ºï¼Œé»˜è®¤ä¸ºTrueã€‚**å¦‚æœæ˜¯æ–­ç½‘ç¯å¢ƒï¼Œè¯·è®¾ç½®ä¸ºFalse**ã€‚
- ğŸ”¥create_checkpoint_symlink: é¢å¤–åˆ›å»ºcheckpointè½¯é“¾æ¥ï¼Œæ–¹ä¾¿ä¹¦å†™è‡ªåŠ¨åŒ–è®­ç»ƒè„šæœ¬ã€‚best_modelå’Œlast_modelçš„è½¯é“¾æ¥è·¯å¾„åˆ†åˆ«ä¸ºf'{output_dir}/best'å’Œf'{output_dir}/last'ã€‚
- ğŸ”¥packing: æ˜¯å¦ä½¿ç”¨åºåˆ—packingæå‡è®¡ç®—æ•ˆç‡ï¼ˆä¸åŒèŠ‚ç‚¹ä¸è¿›ç¨‹æ›´è´Ÿè½½å‡è¡¡ï¼ŒGPUåˆ©ç”¨ç‡æ›´é«˜ï¼‰å¹¶ç¨³å®šæ˜¾å­˜å ç”¨ï¼Œé»˜è®¤ä¸ºFalseã€‚å½“å‰æ”¯æŒCPT/SFT/DPO/KTO/GKDã€‚
  - æ³¨æ„ï¼šä½¿ç”¨packingè¯·ç»“åˆ`--attn_impl flash_attn`ä½¿ç”¨ä¸”"transformers>=4.44"ï¼Œå…·ä½“æŸ¥çœ‹[è¯¥PR](https://github.com/huggingface/transformers/pull/31629)ã€‚
  - æ³¨æ„ï¼š**packingä¼šå¯¼è‡´æ•°æ®é›†æ ·æœ¬æ•°å‡å°‘ï¼Œè¯·è‡ªè¡Œè°ƒèŠ‚æ¢¯åº¦ç´¯åŠ æ•°å’Œå­¦ä¹ ç‡**ã€‚
- packing_length: packingçš„é•¿åº¦ã€‚é»˜è®¤ä¸ºNoneï¼Œè®¾ç½®ä¸ºmax_lengthã€‚
- lazy_tokenize: æ˜¯å¦ä½¿ç”¨lazy_tokenizeã€‚è‹¥è¯¥å‚æ•°è®¾ç½®ä¸ºFalseï¼Œåˆ™åœ¨è®­ç»ƒä¹‹å‰å¯¹æ‰€æœ‰çš„æ•°æ®é›†æ ·æœ¬è¿›è¡Œtokenizeï¼ˆå¤šæ¨¡æ€æ¨¡å‹åˆ™åŒ…æ‹¬ä»ç£ç›˜ä¸­è¯»å–å›¾ç‰‡ï¼‰ã€‚è¯¥å‚æ•°é»˜è®¤ä¸ºNoneï¼Œåœ¨LLMè®­ç»ƒä¸­é»˜è®¤ä¸ºFalseï¼Œè€ŒMLLMè®­ç»ƒé»˜è®¤ä¸ºTrueï¼ŒèŠ‚çº¦å†…å­˜ã€‚
  - æ³¨æ„ï¼šè‹¥ä½ è¦è¿›è¡Œå›¾åƒçš„æ•°æ®å¢å¼ºï¼Œä½ éœ€è¦å°†lazy_tokenizeï¼ˆæˆ–streamingï¼‰è®¾ç½®ä¸ºTrueï¼Œå¹¶ä¿®æ”¹Templateç±»ä¸­çš„encodeæ–¹æ³•ã€‚
- cached_dataset: è®­ç»ƒä¸­ä½¿ç”¨ç¼“å­˜æ•°æ®é›†ï¼ˆä½¿ç”¨`swift export --to_cached_dataset true ...`å‘½ä»¤äº§ç”Ÿï¼‰ï¼Œé¿å…å¤§å‹æ•°æ®é›†è®­ç»ƒæ—¶ï¼Œtokenizeè¿‡ç¨‹å ç”¨gpuæ—¶é—´ã€‚é»˜è®¤ä¸º`[]`ã€‚ä¾‹å­å‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/export/cached_dataset)ã€‚
  - æ³¨æ„ï¼šcached_datasetæ”¯æŒ`--packing`ï¼Œä½†ä¸æ”¯æŒ`--lazy_tokenize`å’Œ`--streaming`ã€‚
- use_logits_to_keep: é€šè¿‡åœ¨`forward`ä¸­æ ¹æ®labelsä¼ å…¥logits_to_keepï¼Œå‡å°‘æ— æ•ˆlogitsçš„è®¡ç®—ä¸å­˜å‚¨ï¼Œä»è€Œå‡å°‘æ˜¾å­˜å ç”¨å¹¶åŠ å¿«è®­ç»ƒé€Ÿåº¦ã€‚é»˜è®¤ä¸ºNoneï¼Œè¿›è¡Œè‡ªåŠ¨é€‰æ‹©ã€‚
- acc_strategy: è®­ç»ƒå’ŒéªŒè¯æ—¶è®¡ç®—accçš„ç­–ç•¥ã€‚å¯é€‰ä¸º`seq`å’Œ`token`çº§åˆ«çš„accï¼Œé»˜è®¤ä¸º`token`ã€‚
- max_new_tokens: è¦†ç›–ç”Ÿæˆå‚æ•°ã€‚predict_with_generate=Trueæ—¶çš„æœ€å¤§ç”Ÿæˆtokenæ•°é‡ï¼Œé»˜è®¤64ã€‚
- temperature: è¦†ç›–ç”Ÿæˆå‚æ•°ã€‚predict_with_generate=Trueæ—¶çš„temperatureï¼Œé»˜è®¤0ã€‚
- optimizer: pluginçš„è‡ªå®šä¹‰optimizeråç§°ï¼Œé»˜è®¤ä¸ºNoneã€‚å¯é€‰optimizerå‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/blob/main/swift/plugin/optimizer.py)ã€‚
- loss_type: pluginçš„è‡ªå®šä¹‰loss_typeåç§°ã€‚é»˜è®¤ä¸ºNoneï¼Œä½¿ç”¨æ¨¡å‹è‡ªå¸¦æŸå¤±å‡½æ•°ã€‚
- metric: pluginçš„è‡ªå®šä¹‰metricåç§°ã€‚é»˜è®¤ä¸ºNoneï¼Œåœ¨predict_with_generate=Trueçš„æƒ…å†µä¸‹é»˜è®¤è®¾ç½®ä¸º'nlg'ã€‚
- eval_use_evalscope: æ˜¯å¦ä½¿ç”¨evalscopeè¿›è¡Œè®­ç»ƒæ—¶è¯„æµ‹ï¼Œéœ€è¦è®¾ç½®è¯¥å‚æ•°æ¥å¼€å¯è¯„æµ‹ï¼Œå…·ä½“ä½¿ç”¨å‚è€ƒ[ç¤ºä¾‹](../Instruction/è¯„æµ‹.md#è®­ç»ƒä¸­è¯„æµ‹)ã€‚
- eval_dataset: è¯„æµ‹æ•°æ®é›†ï¼Œå¯è®¾ç½®å¤šä¸ªæ•°æ®é›†ï¼Œç”¨ç©ºæ ¼åˆ†å‰²ã€‚
- eval_dataset_args: è¯„æµ‹æ•°æ®é›†å‚æ•°ï¼Œjsonæ ¼å¼ï¼Œå¯è®¾ç½®å¤šä¸ªæ•°æ®é›†çš„å‚æ•°ã€‚
- eval_limit: è¯„æµ‹æ•°æ®é›†é‡‡æ ·æ•°ã€‚
- eval_generation_config: è¯„æµ‹æ—¶æ¨¡å‹æ¨ç†é…ç½®ï¼Œjsonæ ¼å¼ï¼Œé»˜è®¤ä¸º`{'max_tokens': 512}`ã€‚
- use_flash_ckpt: æ˜¯å¦å¯ç”¨[DLRover Flash Checkpoint](https://github.com/intelligent-machine-learning/dlrover)çš„flash checkpointã€‚é»˜è®¤ä¸º`false`ï¼Œå¯ç”¨åï¼Œæƒé‡ä¼šå…ˆä¿å­˜è‡³å…±äº«å†…å­˜ï¼Œä¹‹åå¼‚æ­¥æŒä¹…åŒ–ï¼Œç›®å‰æš‚ä¸æ”¯æŒsafetensorsæ ¼å¼ï¼›å»ºè®®æ­é…`PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True"` ä¸€èµ·ä½¿ç”¨ï¼Œé¿å…è®­ç»ƒè¿‡ç¨‹CUDA OOMã€‚
- early_stop_interval: æ—©åœçš„é—´éš”ï¼Œä¼šæ£€éªŒbest_metricåœ¨early_stop_intervalä¸ªå‘¨æœŸå†…ï¼ˆåŸºäº`save_steps`, å»ºè®®`eval_steps`å’Œ`save_steps`è®¾ä¸ºåŒå€¼ï¼‰æ²¡æœ‰æå‡æ—¶ç»ˆæ­¢è®­ç»ƒã€‚å…·ä½“ä»£ç åœ¨[callback plugin](https://github.com/modelscope/ms-swift/blob/main/swift/plugin/callback.py)ä¸­ã€‚åŒæ—¶ï¼Œå¦‚æœæœ‰è¾ƒä¸ºå¤æ‚çš„æ—©åœéœ€æ±‚ï¼Œç›´æ¥è¦†ç›–callback.pyä¸­çš„å·²æœ‰å®ç°å³å¯ã€‚

#### SWANLAB

- swanlab_token: SwanLabçš„api-keyã€‚
- swanlab_project: swanlabçš„projectï¼Œéœ€è¦åœ¨é¡µé¢ä¸­é¢„å…ˆåˆ›å»ºå¥½:[https://swanlab.cn/space/~](https://swanlab.cn/space/~)ã€‚
- swanlab_workspace: é»˜è®¤ä¸ºNoneï¼Œä¼šä½¿ç”¨api-keyå¯¹åº”çš„usernameã€‚
- swanlab_exp_name: å®éªŒåï¼Œå¯ä»¥ä¸ºç©ºï¼Œä¸ºç©ºæ—¶é»˜è®¤ä¼ å…¥--output_dirçš„å€¼ã€‚
- swanlab_lark_webhook_url: é»˜è®¤ä¸ºNoneã€‚swanlabçš„lark webhook urlï¼Œç”¨äºæ¨é€å®éªŒç»“æœåˆ°é£ä¹¦ã€‚
- swanlab_lark_secret: é»˜è®¤ä¸ºNoneã€‚swanlabçš„lark secretï¼Œç”¨äºæ¨é€å®éªŒç»“æœåˆ°é£ä¹¦ã€‚
- swanlab_mode: å¯é€‰cloudå’Œlocalï¼Œäº‘æ¨¡å¼æˆ–è€…æœ¬åœ°æ¨¡å¼ã€‚


### RLHFå‚æ•°
RLHFå‚æ•°ç»§æ‰¿äº[è®­ç»ƒå‚æ•°](#è®­ç»ƒå‚æ•°)ã€‚

- ğŸ”¥rlhf_type: äººç±»å¯¹é½ç®—æ³•ç±»å‹ï¼Œæ”¯æŒ'dpo'ã€'orpo'ã€'simpo'ã€'kto'ã€'cpo'ã€'rm'ã€'ppo'ã€'grpo'å’Œ'gkd'ã€‚é»˜è®¤ä¸º'dpo'ã€‚
- ref_model: é‡‡ç”¨dpoã€ktoã€ppoã€grpoç®—æ³•ä¸”ä½¿ç”¨å…¨å‚æ•°è®­ç»ƒæ—¶éœ€è¦ä¼ å…¥ã€‚é»˜è®¤ä¸ºNoneï¼Œè®¾ç½®ä¸º`--model`ã€‚
- ref_adapters: é»˜è®¤ä¸º`[]`ã€‚è‹¥ä½ è¦ä½¿ç”¨SFTäº§ç”Ÿçš„LoRAæƒé‡è¿›è¡ŒDPO/KTO/GRPOï¼Œè¯·ä½¿ç”¨"ms-swift>=3.8"ï¼Œå¹¶åœ¨è®­ç»ƒæ—¶è®¾ç½®`--adapters sft_ckpt --ref_adapters sft_ckpt`ã€‚è‹¥æ˜¯æ­¤åœºæ™¯çš„æ–­ç‚¹ç»­è®­ï¼Œåˆ™è®¾ç½®`--resume_from_checkpoint rlhf_ckpt --ref_adapters sft_ckpt`ã€‚
- ref_model_type: åŒmodel_typeã€‚é»˜è®¤ä¸ºNoneã€‚
- ref_model_revision: åŒmodel_revisionã€‚é»˜è®¤ä¸ºNoneã€‚
- ğŸ”¥beta: æ§åˆ¶ä¸å‚è€ƒæ¨¡å‹åå·®ç¨‹åº¦çš„å‚æ•°ã€‚betaå€¼è¶Šé«˜ï¼Œè¡¨ç¤ºä¸å‚è€ƒæ¨¡å‹çš„åå·®è¶Šå°ã€‚é»˜è®¤ä¸º`None`ï¼Œä½¿ç”¨ä¸åŒrlhfç®—æ³•çš„é»˜è®¤å€¼ä¸åŒï¼Œå…¶ä¸­`simpo`ç®—æ³•é»˜è®¤ä¸º`2.`ï¼ŒGRPOé»˜è®¤ä¸º`0.04`ï¼ŒGKDé»˜è®¤ä¸º0.5ï¼Œå…¶ä»–ç®—æ³•é»˜è®¤ä¸º`0.1`ã€‚å…·ä½“å‚è€ƒ[æ–‡æ¡£](./äººç±»å¯¹é½.md)ã€‚
- label_smoothing: æ˜¯å¦ä½¿ç”¨DPO smoothingï¼Œé»˜è®¤å€¼ä¸º`0`ã€‚
- max_completion_length: GRPO/PPO/GKDç®—æ³•ä¸­çš„æœ€å¤§ç”Ÿæˆé•¿åº¦ï¼Œé»˜è®¤ä¸º512ã€‚
- ğŸ”¥rpo_alpha: æ¥è‡ª[RPO è®ºæ–‡](https://arxiv.org/abs/2404.19733)ä¸­çš„å‚æ•°ï¼Œç”¨äºæ§åˆ¶æŸå¤±å‡½æ•°ä¸­NLLé¡¹çš„æƒé‡ï¼ˆå³SFTæŸå¤±ï¼‰ï¼Œ`loss = dpo_loss + rpo_alpha * sft_loss`ï¼Œè®ºæ–‡ä¸­æ¨èè®¾ç½®ä¸º`1.`ã€‚é»˜è®¤ä¸º`None`ï¼Œå³é»˜è®¤ä¸å¼•å…¥sft_lossã€‚
  - **æ³¨æ„**ï¼šåœ¨"ms-swift<3.8"ï¼Œå…¶é»˜è®¤å€¼ä¸º`1.`ã€‚åœ¨"ms-swift>=3.8"è¯¥é»˜è®¤å€¼ä¿®æ”¹ä¸º`None`ã€‚
- ld_alpha: æ¥è‡ª[LD-DPO è®ºæ–‡](https://arxiv.org/abs/2409.06411)ï¼Œå¯¹è¶…å‡ºå…¬å…±å‰ç¼€éƒ¨åˆ†çš„logpsåŠ æƒ $\alpha$ æŠ‘åˆ¶é•¿åº¦åå¥½ã€‚
- discopop_tau: æ¥è‡ª [DiscoPOP è®ºæ–‡](https://arxiv.org/abs/2406.08414)çš„æ¸©åº¦å‚æ•° $\tau$ ï¼Œç”¨äºç¼©æ”¾ log-ratioã€‚é»˜è®¤å€¼0.05ã€‚åœ¨ loss_type ä¸º discopop æ—¶ç”Ÿæ•ˆã€‚
- loss_type: æŸå¤±ç±»å‹ã€‚é»˜è®¤ä¸ºNoneï¼Œä½¿ç”¨ä¸åŒçš„rlhfç®—æ³•ï¼Œå…¶é»˜è®¤å€¼ä¸åŒã€‚
  - DPO: å¯é€‰é¡¹å‚è€ƒ[æ–‡æ¡£](https://huggingface.co/docs/trl/main/en/dpo_trainer#loss-functions)ï¼Œæ”¯æŒä¼ å…¥å¤šä¸ªå€¼å®ç°æ··åˆè®­ç»ƒ([MPO](https://arxiv.org/abs/2411.10442)), ä¼ å…¥å¤šä¸ªå€¼æ—¶éœ€è¦è®¾ç½®å‚æ•° loss_weightsã€‚é»˜è®¤ä¸º`sigmoid`ã€‚
  - GRPO: å‚è€ƒ[GRPOå‚æ•°](#grpoå‚æ•°)ã€‚
- loss_weightsï¼šåœ¨ DPO è®­ç»ƒä¸­è®¾ç½®å¤šä¸ª loss_type æ—¶ï¼Œç”¨äºæŒ‡å®šå„ä¸ªæŸå¤±é¡¹çš„æƒé‡ã€‚
- cpo_alpha: CPO/SimPO loss ä¸­ nll lossçš„ç³»æ•°, é»˜è®¤ä¸º`1.`ã€‚
- simpo_gamma: SimPOç®—æ³•ä¸­çš„reward marginé¡¹ï¼Œè®ºæ–‡å»ºè®®è®¾ç½®ä¸º0.5-1.5ï¼Œé»˜è®¤ä¸º`1.`ã€‚
- desirable_weight: KTOç®—æ³•ä¸­ç”¨äºæŠµæ¶ˆ desirable å’Œ undesirable æ•°é‡ä¸å‡è¡¡çš„å½±å“ï¼Œå¯¹ desirable æŸå¤±æŒ‰è¯¥ç³»æ•°è¿›è¡ŒåŠ æƒï¼Œé»˜è®¤ä¸º`1.`ã€‚
- undesirable_weight: KTOç®—æ³•ä¸­ç”¨äºæŠµæ¶ˆ desirable å’Œ undesirable æ•°é‡ä¸å‡è¡¡çš„å½±å“ï¼Œå¯¹ undesirable æŸå¤±æŒ‰è¯¥ç³»æ•°è¿›è¡ŒåŠ æƒï¼Œé»˜è®¤ä¸º`1.`ã€‚
- center_rewards_coefficient: ç”¨äºRMè®­ç»ƒã€‚ç”¨äºæ¿€åŠ±å¥–åŠ±æ¨¡å‹è¾“å‡ºå‡å€¼ä¸ºé›¶çš„å¥–åŠ±çš„ç³»æ•°ï¼Œå…·ä½“æŸ¥çœ‹è¿™ç¯‡[è®ºæ–‡](https://huggingface.co/papers/2312.09244)ã€‚æ¨èå€¼ï¼š0.01ã€‚
- loss_scale: è¦†ç›–æ¨¡æ¿å‚æ•°ã€‚rlhfè®­ç»ƒæ—¶ï¼Œé»˜è®¤ä¸º'last_round'ã€‚
- temperature: é»˜è®¤ä¸º0.9ï¼Œè¯¥å‚æ•°å°†åœ¨PPOã€GRPOã€GKDä¸­ä½¿ç”¨ã€‚
- lmbda: é»˜è®¤ä¸º0.5ã€‚è¯¥å‚æ•°åœ¨GKDä¸­ä½¿ç”¨ã€‚æ§åˆ¶å­¦ç”Ÿæ•°æ®æ¯”ä¾‹çš„ lambda å‚æ•°ï¼ˆå³ç­–ç•¥å†…å­¦ç”Ÿç”Ÿæˆè¾“å‡ºæ‰€å çš„æ¯”ä¾‹ï¼‰ã€‚è‹¥lmbdaä¸º0ï¼Œåˆ™ä¸ä½¿ç”¨å­¦ç”Ÿç”Ÿæˆæ•°æ®ã€‚
- sft_alpha: é»˜è®¤ä¸º0ã€‚æ§åˆ¶GKDä¸­åŠ å…¥sft_lossçš„æƒé‡ã€‚æœ€åçš„lossä¸º`gkd_loss + sft_alpha * sft_loss`ã€‚
- seq_kd: é»˜è®¤ä¸ºFalseã€‚è¯¥å‚æ•°åœ¨GKDä¸­ä½¿ç”¨ã€‚æ§åˆ¶æ˜¯å¦æ‰§è¡Œåºåˆ—çº§çŸ¥è¯†è’¸é¦ï¼ˆSequence-Level KDï¼‰çš„ seq_kd å‚æ•°ï¼ˆå¯è§†ä¸ºå¯¹æ•™å¸ˆæ¨¡å‹ç”Ÿæˆè¾“å‡ºçš„ç›‘ç£å¼å¾®è°ƒï¼‰ã€‚
  - æ³¨æ„ï¼šä½ å¯ä»¥æå‰å¯¹æ•°æ®é›†å†…å®¹ä½¿ç”¨teacheræ¨¡å‹è¿›è¡Œæ¨ç†ï¼ˆä½¿ç”¨vllm/sglang/lmdeployç­‰æ¨ç†å¼•æ“åŠ é€Ÿï¼‰ï¼Œå¹¶åœ¨è®­ç»ƒæ—¶å°†`seq_kd`è®¾ç½®ä¸ºFalseã€‚æˆ–è€…å°†`seq_kd`è®¾ç½®ä¸ºTrueï¼Œåœ¨è®­ç»ƒæ—¶ä½¿ç”¨teacheræ¨¡å‹ç”Ÿæˆåºåˆ—ï¼ˆèƒ½ä¿è¯å¤šä¸ªepochç”Ÿæˆæ•°æ®çš„ä¸åŒï¼Œä½†æ•ˆç‡è¾ƒæ…¢ï¼‰ã€‚

#### Reward/Teacheræ¨¡å‹å‚æ•°
rewardæ¨¡å‹å‚æ•°å°†åœ¨PPOã€GRPOä¸­ä½¿ç”¨ã€‚

- reward_model: é»˜è®¤ä¸ºNoneã€‚
- reward_adapters: é»˜è®¤ä¸º`[]`ã€‚
- reward_model_type: é»˜è®¤ä¸ºNoneã€‚
- reward_model_revision: é»˜è®¤ä¸ºNoneã€‚
- teacher_model: é»˜è®¤ä¸ºNoneã€‚rlhf_typeä¸º'gkd'æ—¶éœ€ä¼ å…¥æ­¤å‚æ•°ã€‚
- teacher_adapters: é»˜è®¤ä¸º`[]`ã€‚
- teacher_model_type: é»˜è®¤ä¸ºNoneã€‚
- teacher_model_revision: é»˜è®¤ä¸ºNoneã€‚
- teacher_deepspeed: åŒ deepspeed å‚æ•°ï¼Œæ§åˆ¶ teacher model çš„ deepspeed é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨è®­ç»ƒæ¨¡å‹çš„ deepspeed é…ç½®ã€‚

#### PPOå‚æ•°

ä»¥ä¸‹å‚æ•°å«ä¹‰å¯ä»¥å‚è€ƒ[è¿™é‡Œ](https://huggingface.co/docs/trl/main/ppo_trainer)ã€‚
- num_ppo_epochs: é»˜è®¤ä¸º4ã€‚
- whiten_rewards: é»˜è®¤ä¸ºFalseã€‚
- kl_coef: é»˜è®¤ä¸º0.05ã€‚
- cliprange: é»˜è®¤ä¸º0.2ã€‚
- vf_coef: é»˜è®¤ä¸º0.1ã€‚
- cliprange_value: é»˜è®¤ä¸º0.2ã€‚
- gamma: é»˜è®¤ä¸º1.0ã€‚
- lam: é»˜è®¤ä¸º0.95ã€‚
- num_mini_batches: é»˜è®¤ä¸º1ã€‚
- local_rollout_forward_batch_size: é»˜è®¤ä¸º64ã€‚
- num_sample_generations: é»˜è®¤ä¸º10ã€‚
- missing_eos_penalty: é»˜è®¤ä¸ºNoneã€‚


#### GRPOå‚æ•°
- beta: KLæ­£åˆ™ç³»æ•°ï¼Œé»˜è®¤ä¸º0.04ï¼Œè®¾ç½®ä¸º0æ—¶ä¸åŠ è½½ref modelã€‚
- per_device_train_batch_size: æ¯ä¸ªè®¾å¤‡è®­ç»ƒæ‰¹é‡å¤§å°ï¼Œåœ¨GRPOä¸­ï¼ŒæŒ‡ completion çš„æ‰¹æ¬¡å¤§å°ã€‚
- per_device_eval_batch_size: æ¯ä¸ªè®¾å¤‡è¯„ä¼°æ‰¹é‡å¤§å°ï¼Œåœ¨GRPOä¸­ï¼ŒæŒ‡ completion çš„æ‰¹æ¬¡å¤§å°ã€‚
- generation_batch_size: é‡‡æ ·completionæ‰¹é‡å¤§å°ï¼Œéœ€è¦æ˜¯ num_processes * per_device_train_batch_size çš„å€æ•°ï¼Œé»˜è®¤ç­‰äº per_device_batch_size * gradient_accumulation_steps * num_processes
- steps_per_generation: æ¯è½®ç”Ÿæˆçš„ä¼˜åŒ–æ­¥æ•°ï¼Œé»˜è®¤ç­‰äºgradient_accumulation_stepsã€‚ä¸generation_batch_size åªèƒ½åŒæ—¶è®¾ç½®ä¸€ä¸ª
- num_generations: æ¯ä¸ªprompté‡‡æ ·çš„æ•°é‡ï¼Œè®ºæ–‡ä¸­çš„Gå€¼ï¼Œé‡‡æ ·æ‰¹é‡å¤§å°(generation_batch_size æˆ– steps_per_generation Ã— per_device_batch_size Ã— num_processes) å¿…é¡»èƒ½è¢« num_generations æ•´é™¤ã€‚é»˜è®¤ä¸º 8ã€‚
- ds3_gather_for_generation: è¯¥å‚æ•°é€‚ç”¨äºDeepSpeed ZeRO-3ã€‚å¦‚æœå¯ç”¨ï¼Œç­–ç•¥æ¨¡å‹æƒé‡å°†è¢«æ”¶é›†ç”¨äºç”Ÿæˆï¼Œä»è€Œæé«˜ç”Ÿæˆé€Ÿåº¦ã€‚ç„¶è€Œï¼Œç¦ç”¨æ­¤é€‰é¡¹å…è®¸è®­ç»ƒè¶…å‡ºå•ä¸ªGPU VRAMçš„æ¨¡å‹ï¼Œå°½ç®¡ç”Ÿæˆé€Ÿåº¦ä¼šå˜æ…¢ã€‚ç¦ç”¨æ­¤é€‰é¡¹ä¸vLLMç”Ÿæˆä¸å…¼å®¹ã€‚é»˜è®¤ä¸ºTrueã€‚
- reward_funcs: GRPOç®—æ³•å¥–åŠ±å‡½æ•°ï¼Œå¯é€‰é¡¹ä¸º`accuracy`ã€`format`ã€`cosine`ã€`repetition`å’Œ`soft_overlong`ï¼Œè§swift/plugin/orm.pyã€‚ä½ ä¹Ÿå¯ä»¥åœ¨pluginä¸­è‡ªå®šä¹‰è‡ªå·±çš„å¥–åŠ±å‡½æ•°ã€‚é»˜è®¤ä¸º`[]`ã€‚
- reward_weights: æ¯ä¸ªå¥–åŠ±å‡½æ•°çš„æƒé‡ã€‚å¿…é¡»ä¸å¥–åŠ±å‡½æ•°å’Œå¥–åŠ±æ¨¡å‹çš„æ€»æ•°é‡åŒ¹é…ã€‚å¦‚æœä¸º Noneï¼Œåˆ™æ‰€æœ‰å¥–åŠ±çš„æƒé‡éƒ½ç›¸ç­‰ï¼Œä¸º`1.0`ã€‚
  - æç¤ºï¼šå¦‚æœGRPOè®­ç»ƒä¸­åŒ…å«`--reward_model`ï¼Œåˆ™å…¶åŠ åœ¨å¥–åŠ±å‡½æ•°çš„æœ€åä½ç½®ã€‚
- reward_model_plugin: å¥–åŠ±æ¨¡å‹é€»è¾‘ï¼Œé»˜è®¤ä¸ºormé€»è¾‘, è¯¦ç»†è§[è‡ªå®šä¹‰å¥–åŠ±æ¨¡å‹](./GRPO/DeveloperGuide/å¥–åŠ±æ¨¡å‹.md#è‡ªå®šä¹‰å¥–åŠ±æ¨¡å‹)ã€‚
- dataset_shuffle: æ˜¯å¦å¯¹datasetè¿›è¡Œéšæœºæ“ä½œï¼Œé»˜è®¤ä¸ºTrueã€‚
- truncation_strategy: å¯¹è¾“å…¥é•¿åº¦è¶…è¿‡ `max_length`çš„å¤„ç†æ–¹å¼ï¼Œæ”¯æŒ`delete`å’Œ`left`ï¼Œä»£è¡¨åˆ é™¤ã€å·¦ä¾§è£å‰ªï¼Œé»˜è®¤ä¸º`left`, æ³¨æ„å¯¹äºå¤šæ¨¡æ€æ¨¡å‹ï¼Œ
å·¦è£å‰ªå¯èƒ½ä¼šè£å‰ªæ‰å¤šæ¨¡æ€tokenå¯¼è‡´æ¨¡å‹å‰å‘æŠ¥é”™shape mismatchã€‚ä½¿ç”¨`delete`æ–¹å¼ï¼Œå¯¹äºè¶…é•¿æ•°æ®å’Œç¼–ç å¤±è´¥çš„æ ·ä¾‹ä¼šåœ¨åŸæ•°æ®é›†ä¸­é‡é‡‡æ ·å…¶ä»–æ•°æ®ä½œä¸ºè¡¥å……ã€‚
- loss_type: loss å½’ä¸€åŒ–çš„ç±»å‹ï¼Œå¯é€‰é¡¹ä¸º['grpo', 'bnpo', 'dr_grpo'], é»˜è®¤ä¸º'grpo', å…·ä½“æŸ¥çœ‹è¯¥[pr](https://github.com/huggingface/trl/pull/3256#discussion_r2033213348)ã€‚
- log_completions: æ˜¯å¦è®°å½•è®­ç»ƒä¸­çš„æ¨¡å‹ç”Ÿæˆå†…å®¹ï¼Œæ­é… `--report_to wandb` ä½¿ç”¨ã€‚é»˜è®¤ä¸ºFalseã€‚
  - æç¤ºï¼šè‹¥æ²¡æœ‰è®¾ç½®`--report_to wandb`ï¼Œåˆ™ä¼šåœ¨checkpointä¸­åˆ›å»º`completions.jsonl`æ¥å­˜å‚¨ç”Ÿæˆå†…å®¹ã€‚
- use_vllm: æ˜¯å¦ä½¿ç”¨ vLLM ä½œä¸º GRPO ç”Ÿæˆçš„ infer_backendï¼Œé»˜è®¤ä¸ºFalseã€‚
- vllm_mode: vLLM é›†æˆæ¨¡å¼ï¼Œå¯é€‰é¡¹ä¸º `server` å’Œ `colocate`ã€‚server æ¨¡å¼ä½¿ç”¨ `swift rollout` æ‹‰èµ·çš„ vLLM æœåŠ¡å™¨è¿›è¡Œé‡‡æ ·ï¼Œcolocate æ¨¡å¼åœ¨ç¨‹åºå†…éƒ¨ç½² vLLMã€‚ä½¿ç”¨serverç«¯æ—¶ï¼Œ
- vllm_mode server å‚æ•°
  - vllm_server_base_url: vLLM serverçš„Base URL(æ¯”å¦‚ http://local_host:8000), é»˜è®¤ä¸ºNoneã€‚è®¾ç½®åï¼Œå¿½ç•¥hostå’Œportè®¾ç½®ã€‚
  - vllm_server_hostï¼švLLM server hoståœ°å€ï¼Œé»˜è®¤ä¸ºNoneã€‚
  - vllm_server_port vLLM server æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ä¸º8000ã€‚
  - vllm_server_timeout è¿æ¥vLLM serverçš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º 240sã€‚
  - vllm_server_pass_dataset: é€ä¼ é¢å¤–çš„æ•°æ®é›†ä¿¡æ¯åˆ°vLLM serverï¼Œç”¨äºå¤šè½®è®­ç»ƒã€‚
  - async_generate: å¼‚æ­¥rolloutä»¥æé«˜è®­ç»ƒé€Ÿåº¦ï¼Œæ³¨æ„å¼€å¯æ—¶é‡‡æ ·ä¼šä½¿ç”¨ä¸Šä¸€è½®æ›´æ–°çš„æ¨¡å‹è¿›è¡Œé‡‡æ ·ï¼Œä¸æ”¯æŒå¤šè½®åœºæ™¯ã€‚é»˜è®¤`false`.
  - SWIFT_UPDATE_WEIGHTS_BUCKET_SIZEï¼šç¯å¢ƒå˜é‡ï¼Œç”¨äºæ§åˆ¶æƒé‡åŒæ­¥æ—¶çš„ä¼ è¾“æ¡¶å¤§å°ï¼ˆbucket sizeï¼‰ï¼Œé€‚ç”¨äº Server Mode ä¸‹çš„å…¨å‚æ•°è®­ç»ƒï¼Œå•ä½ä¸º MBï¼Œé»˜è®¤å€¼ä¸º 512 MBã€‚
- vllm_mode colocate å‚æ•°ï¼ˆæ›´å¤šå‚æ•°æ”¯æŒå‚è€ƒ[vLLMå‚æ•°](#vLLMå‚æ•°)ã€‚ï¼‰
  - vllm_gpu_memory_utilization: vllmé€ä¼ å‚æ•°ï¼Œé»˜è®¤ä¸º0.9ã€‚
  - vllm_max_model_len: vllmé€ä¼ å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneã€‚
  - vllm_enforce_eager: vllmé€ä¼ å‚æ•°ï¼Œé»˜è®¤ä¸ºFalseã€‚
  - vllm_limit_mm_per_prompt: vllmé€ä¼ å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneã€‚
  - vllm_enable_prefix_caching: vllmé€ä¼ å‚æ•°ï¼Œé»˜è®¤ä¸ºTrueã€‚
  - vllm_tensor_parallel_size: tpå¹¶è¡Œæ•°ï¼Œé»˜è®¤ä¸º`1`ã€‚
  - vllm_enable_lora: æ”¯æŒvLLM Engine åŠ è½½ LoRA adapterï¼Œé»˜è®¤ä¸ºFalseã€‚ç”¨äºåŠ é€ŸLoRAè®­ç»ƒçš„æƒé‡åŒæ­¥ï¼Œå…·ä½“å‚è€ƒ[æ–‡æ¡£](./GRPO/GetStarted/GRPO.md#æƒé‡åŒæ­¥åŠ é€Ÿ)ã€‚
  - sleep_level: è®­ç»ƒæ—¶é‡Šæ”¾ vLLM æ˜¾å­˜ï¼Œå¯é€‰é¡¹ä¸º[0, 1], é»˜è®¤ä¸º0ï¼Œä¸é‡Šæ”¾ã€‚
  - offload_optimizer: æ˜¯å¦åœ¨vLLMæ¨ç†æ—¶offload optimizerå‚æ•°ï¼Œé»˜è®¤ä¸ºFalseã€‚
  - offload_model: æ˜¯å¦åœ¨vLLMæ¨ç†æ—¶ offload æ¨¡å‹ï¼Œé»˜è®¤ä¸ºFalseã€‚
  - completion_length_limit_scope: åœ¨å¤šè½®å¯¹è¯ä¸­ï¼Œ`max_completion_length` çš„é™åˆ¶èŒƒå›´ã€‚
  `total`é™åˆ¶æ‰€æœ‰å¯¹è¯è½®æ¬¡çš„æ€»è¾“å‡ºé•¿åº¦ä¸è¶…è¿‡`max_completion_length`, `per_round`é™åˆ¶æ¯ä¸€è½®çš„è¾“å‡ºé•¿åº¦ã€‚
- num_iterations: æ¯ä¸ªæ‰¹æ¬¡ä»£æ›´æ–°æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚
- epsilon: clip ç³»æ•°ï¼Œé»˜è®¤ä¸º0.2ã€‚
- epsilon_high: upper clip ç³»æ•°ï¼Œé»˜è®¤ä¸ºNoneï¼Œè®¾ç½®åä¸epsilonå…±åŒæ„æˆ[epsilon, epsilon_high]è£å‰ªèŒƒå›´ã€‚
- delta: [INTELLECT-2 tech report](https://huggingface.co/papers/2505.07291)ä¸­åŒä¾§ GRPO ä¸Šç•Œè£å‰ªå€¼ã€‚è‹¥è®¾ç½®ï¼Œå»ºè®®å¤§äº 1 + epsilonã€‚é»˜è®¤ä¸ºNoneã€‚
- sync_ref_model: æ˜¯å¦å®šæœŸåŒæ­¥ref_modelï¼Œé»˜è®¤ä¸ºFalseã€‚
  - ref_model_mixup_alpha: æ§åˆ¶åœ¨æ›´æ–°è¿‡ç¨‹ä¸­modelå’Œå…ˆå‰ref_modelä¹‹é—´çš„æ··åˆã€‚æ›´æ–°å…¬å¼ä¸º $Ï€_{ref} = Î± * Ï€_Î¸ + (1 - Î±) * Ï€_{ref_{prev}}$ã€‚é»˜è®¤ä¸º0.6ã€‚
  - ref_model_sync_stepsï¼šåŒæ­¥é¢‘ç‡ï¼Œé»˜è®¤ä¸º512ã€‚
- move_model_batches: åœ¨æ¨¡å‹å‘vLLMç­‰å¿«é€Ÿæ¨ç†æ¡†æ¶ç§»åŠ¨å‚æ•°æ—¶ï¼Œå°†layersåˆ†ä¸ºå¤šå°‘ä¸ªbatch. é»˜è®¤ä¸ºNone, ä»£è¡¨æ•´ä¸ªæ¨¡å‹ä¸è¿›è¡Œæ‹†åˆ†ï¼Œå¦åˆ™æ‹†åˆ†ä¸ºmove_model_batches+1(élayerå‚æ•°)+1(å¤šæ¨¡æ€éƒ¨åˆ†å‚æ•°)ä¸ªã€‚
- multi_turn_scheduler: å¤šè½®GRPOå‚æ•°, ä¼ å…¥å¯¹åº”çš„pluginåç§°, åŒæ—¶åœ¨plugin/multi_turn.pyä¸­æ·»åŠ å¥½å¯¹åº”çš„å®ç°ã€‚
- max_turns: å¤šè½®GRPOçš„è½®æ•°ä¸Šé™ã€‚é»˜è®¤ä¸ºNoneï¼Œä¸åšé™åˆ¶ã€‚
- dynamic_sampleï¼šç­›é™¤groupå†…å¥–åŠ±æ ‡å‡†å·®ä¸º0çš„æ•°æ®ï¼Œé¢å¤–é‡‡æ ·æ–°æ•°æ®ï¼Œé»˜è®¤ä¸ºFalseã€‚
- max_resample_timesï¼šdynamic_sampleè®¾ç½®ä¸‹é™åˆ¶é‡é‡‡æ ·æ¬¡æ•°ï¼Œé»˜è®¤3æ¬¡ã€‚
- overlong_filterï¼šè·³è¿‡è¶…é•¿æˆªæ–­çš„æ ·æœ¬ï¼Œä¸å‚ä¸lossè®¡ç®—ï¼Œé»˜è®¤ä¸ºFalseã€‚
- top_entropy_quantile: ä»…å¯¹ç†µå€¼å¤„äºå‰æŒ‡å®šåˆ†ä½çš„ token å‚ä¸æŸå¤±è®¡ç®—ï¼Œé»˜è®¤ä¸º1.0ï¼Œå³ä¸è¿‡æ»¤ä½ç†µ tokenï¼Œå…·ä½“å‚è€ƒ[æ–‡æ¡£](./GRPO/AdvancedResearch/entropy_mask.md)
- log_entropy: è®°å½•è®­ç»ƒä¸­çš„ç†µå€¼å˜åŒ–åŠ¨æ€ï¼Œé»˜è®¤ä¸ºFalseï¼Œå…·ä½“å‚è€ƒ[æ–‡æ¡£](./GRPO/GetStarted/GRPO.md#logged-metrics)
- importance_sampling_level: æ§åˆ¶é‡è¦æ€§é‡‡æ ·æ¯”è®¡ç®—ï¼Œå¯é€‰é¡¹ä¸º `token` å’Œ `sequence`ï¼Œ`token` æ¨¡å¼ä¸‹ä¿ç•™åŸå§‹çš„æ¯ä¸ª token çš„å¯¹æ•°æ¦‚ç‡æ¯”ï¼Œ`sequence` æ¨¡å¼ä¸‹åˆ™ä¼šå¯¹åºåˆ—ä¸­æ‰€æœ‰æœ‰æ•ˆ token çš„å¯¹æ•°æ¦‚ç‡æ¯”è¿›è¡Œå¹³å‡ã€‚[GSPOè®ºæ–‡](https://www.arxiv.org/abs/2507.18071)ä¸­ä½¿ç”¨sequenceçº§åˆ«è®¡ç®—æ¥ç¨³å®šè®­ç»ƒï¼Œé»˜è®¤ä¸º`token`ã€‚

cosine å¥–åŠ±å‚æ•°
- cosine_min_len_value_wrongï¼šcosine å¥–åŠ±å‡½æ•°å‚æ•°ï¼Œç”Ÿæˆé”™è¯¯ç­”æ¡ˆæ—¶ï¼Œæœ€å°é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚é»˜è®¤å€¼ä¸º-0.5ã€‚
- cosine_max_len_value_wrongï¼šç”Ÿæˆé”™è¯¯ç­”æ¡ˆæ—¶ï¼Œæœ€å¤§é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚é»˜è®¤å€¼ä¸º0.0ã€‚
- cosine_min_len_value_correctï¼šç”Ÿæˆæ­£ç¡®ç­”æ¡ˆæ—¶ï¼Œæœ€å°é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚é»˜è®¤å€¼ä¸º1.0ã€‚
- cosine_max_len_value_correctï¼šç”Ÿæˆæ­£ç¡®ç­”æ¡ˆæ—¶ï¼Œæœ€å¤§é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚é»˜è®¤å€¼ä¸º0.5ã€‚
- cosine_max_lenï¼šç”Ÿæˆæ–‡æœ¬çš„æœ€å¤§é•¿åº¦é™åˆ¶ã€‚é»˜è®¤ç­‰äº max_completion_lengthã€‚

repetition å¥–åŠ±å‚æ•°
- repetition_n_gramsï¼šç”¨äºæ£€æµ‹é‡å¤çš„ n-gram å¤§å°ã€‚é»˜è®¤å€¼ä¸º3ã€‚
- repetition_max_penaltyï¼šæœ€å¤§æƒ©ç½šå€¼ï¼Œç”¨äºæ§åˆ¶æƒ©ç½šçš„å¼ºåº¦ã€‚é»˜è®¤å€¼ä¸º-1.0ã€‚

soft overlong å¥–åŠ±å‚æ•°
- soft_max_length: è®ºæ–‡ä¸­çš„L_maxï¼Œæ¨¡å‹çš„æœ€å¤§ç”Ÿæˆé•¿åº¦ï¼Œé»˜è®¤ç­‰äºmax_completion_lengthã€‚
- soft_cache_length: è®ºæ–‡ä¸­çš„L_cacheï¼Œæ§åˆ¶é•¿åº¦æƒ©ç½šåŒºé—´ï¼ŒåŒºé—´ä¸º[soft_max_length-soft_cache_length, soft_max_length]ã€‚

### æ¨ç†å‚æ•°

æ¨ç†å‚æ•°é™¤åŒ…å«[åŸºæœ¬å‚æ•°](#åŸºæœ¬å‚æ•°)ã€[åˆå¹¶å‚æ•°](#åˆå¹¶å‚æ•°)ã€[vLLMå‚æ•°](#vllmå‚æ•°)ã€[LMDeployå‚æ•°](#LMDeployå‚æ•°)å¤–ï¼Œè¿˜åŒ…å«ä¸‹é¢çš„éƒ¨åˆ†ï¼š

- ğŸ”¥infer_backend: æ¨ç†åŠ é€Ÿåç«¯ï¼Œæ”¯æŒ'pt'ã€'vllm'ã€'sglang'ã€'lmdeploy'å››ç§æ¨ç†å¼•æ“ã€‚é»˜è®¤ä¸º'pt'ã€‚
- ğŸ”¥max_batch_size: æŒ‡å®šinfer_backendä¸ºptæ—¶ç”Ÿæ•ˆï¼Œç”¨äºæ‰¹é‡æ¨ç†ï¼Œé»˜è®¤ä¸º1ã€‚è‹¥è®¾ç½®ä¸º-1ï¼Œåˆ™ä¸å—é™åˆ¶ã€‚
- ğŸ”¥result_path: æ¨ç†ç»“æœå­˜å‚¨è·¯å¾„ï¼ˆjsonlï¼‰ï¼Œé»˜è®¤ä¸ºNoneï¼Œä¿å­˜åœ¨checkpointç›®å½•ï¼ˆå«args.jsonæ–‡ä»¶ï¼‰æˆ–è€…'./result'ç›®å½•ï¼Œæœ€ç»ˆå­˜å‚¨è·¯å¾„ä¼šåœ¨å‘½ä»¤è¡Œä¸­æ‰“å°ã€‚
  - æ³¨æ„ï¼šè‹¥å·²å­˜åœ¨`result_path`æ–‡ä»¶ï¼Œåˆ™ä¼šè¿›è¡Œè¿½åŠ å†™å…¥ã€‚
- write_batch_size: ç»“æœå†™å…¥`result_path`çš„batch_sizeã€‚é»˜è®¤ä¸º1000ã€‚è‹¥è®¾ç½®ä¸º-1ï¼Œåˆ™ä¸å—é™åˆ¶ã€‚
- metric: å¯¹æ¨ç†çš„ç»“æœè¿›è¡Œè¯„ä¼°ï¼Œç›®å‰æ”¯æŒ'acc'å’Œ'rouge'ã€‚é»˜è®¤ä¸ºNoneï¼Œå³ä¸è¿›è¡Œè¯„ä¼°ã€‚
- val_dataset_sample: æ¨ç†æ•°æ®é›†é‡‡æ ·æ•°ï¼Œé»˜è®¤ä¸ºNoneã€‚
- reranker_use_activation: åœ¨rerankeræ¨ç†æ—¶ï¼Œæ˜¯å¦åœ¨scoreä¹‹åä½¿ç”¨sigmoidï¼Œé»˜è®¤ä¸ºTrueã€‚


### éƒ¨ç½²å‚æ•°

éƒ¨ç½²å‚æ•°ç»§æ‰¿äº[æ¨ç†å‚æ•°](#æ¨ç†å‚æ•°)ã€‚

- host: æœåŠ¡hostï¼Œé»˜è®¤ä¸º'0.0.0.0'ã€‚
- port: ç«¯å£å·ï¼Œé»˜è®¤ä¸º8000ã€‚
- api_key: è®¿é—®éœ€è¦ä½¿ç”¨çš„api_keyï¼Œé»˜è®¤ä¸ºNoneã€‚
- owned_by: é»˜è®¤ä¸º`swift`ã€‚
- ğŸ”¥served_model_name: æä¾›æœåŠ¡çš„æ¨¡å‹åç§°ï¼Œé»˜è®¤ä½¿ç”¨modelçš„åç¼€ã€‚
- verbose: æ‰“å°è¯¦ç»†æ—¥å¿—ï¼Œé»˜è®¤ä¸ºTrueã€‚
  - æ³¨æ„ï¼šåœ¨`swift app`æˆ–è€…`swift eval`æ—¶ï¼Œé»˜è®¤ä¸ºFalseã€‚
- log_interval: tokens/sç»Ÿè®¡å€¼æ‰“å°é—´éš”ï¼Œé»˜è®¤20ç§’ã€‚è®¾ç½®ä¸º-1åˆ™ä¸æ‰“å°ã€‚
- max_logprobs: æœ€å¤šè¿”å›å®¢æˆ·ç«¯çš„logprobsæ•°é‡ï¼Œé»˜è®¤ä¸º20ã€‚

### Rolloutå‚æ•°
Rolloutå‚æ•°ç»§æ‰¿äº[éƒ¨ç½²å‚æ•°](#éƒ¨ç½²å‚æ•°)
- multi_turn_scheduler: å¤šè½®GRPOè®­ç»ƒè§„åˆ’å™¨ï¼Œä¼ å…¥å¯¹åº”çš„pluginåç§°, åŒæ—¶åœ¨plugin/multi_turn.pyä¸­æ·»åŠ å¥½å¯¹åº”çš„å®ç°ã€‚é»˜è®¤ä¸ºNoneï¼Œå…·ä½“å‚è€ƒ[æ–‡æ¡£](./GRPO/DeveloperGuide/å¤šè½®è®­ç»ƒ.md)ã€‚
- max_turns: å¤šè½®GRPOè®­ç»ƒä¸‹çš„æœ€å¤§è½®æ•°ï¼Œé»˜è®¤ä¸ºNoneï¼Œå³ä¸åšçº¦æŸã€‚
- vllm_enable_lora: æ”¯æŒvLLM Engine åŠ è½½ LoRA adapterï¼Œé»˜è®¤ä¸ºFalseã€‚ç”¨äºåŠ é€ŸLoRAè®­ç»ƒçš„æƒé‡åŒæ­¥ï¼Œå…·ä½“å‚è€ƒ[æ–‡æ¡£](./GRPO/GetStarted/GRPO.md#æƒé‡åŒæ­¥åŠ é€Ÿ)ã€‚
- vllm_max_lora_rank: vLLM Engine LoRAå‚æ•°ï¼Œéœ€å¤§äºç­‰äºè®­ç»ƒçš„lora_rankï¼Œå»ºè®®ç­‰äºã€‚é»˜è®¤ä¸º16ã€‚

### Web-UIå‚æ•°
- server_name: web-uiçš„hostï¼Œé»˜è®¤ä¸º'0.0.0.0'ã€‚
- server_port: web-uiçš„portï¼Œé»˜è®¤ä¸º7860ã€‚
- share: é»˜è®¤ä¸ºFalseã€‚
- lang: web-uiçš„è¯­è¨€ï¼Œå¯é€‰ä¸º'zh', 'en'ã€‚é»˜è®¤ä¸º'zh'ã€‚


### Appå‚æ•°

Appå‚æ•°ç»§æ‰¿äº[éƒ¨ç½²å‚æ•°](#éƒ¨ç½²å‚æ•°), [Web-UIå‚æ•°](#Web-UIå‚æ•°)ã€‚
- base_url: æ¨¡å‹éƒ¨ç½²çš„base_urlï¼Œä¾‹å¦‚`http://localhost:8000/v1`ã€‚é»˜è®¤ä¸º`None`ï¼Œä½¿ç”¨æœ¬åœ°éƒ¨ç½²ã€‚
- studio_title: studioçš„æ ‡é¢˜ã€‚é»˜è®¤ä¸ºNoneï¼Œè®¾ç½®ä¸ºæ¨¡å‹åã€‚
- is_multimodal: æ˜¯å¦å¯åŠ¨å¤šæ¨¡æ€ç‰ˆæœ¬çš„appã€‚é»˜è®¤ä¸ºNoneï¼Œè‡ªåŠ¨æ ¹æ®modelåˆ¤æ–­ï¼Œè‹¥æ— æ³•åˆ¤æ–­ï¼Œè®¾ç½®ä¸ºFalseã€‚
- lang: è¦†ç›–Web-UIå‚æ•°ï¼Œé»˜è®¤ä¸º'en'ã€‚

### è¯„æµ‹å‚æ•°

è¯„æµ‹å‚æ•°ç»§æ‰¿äº[éƒ¨ç½²å‚æ•°](#éƒ¨ç½²å‚æ•°)ã€‚

- ğŸ”¥eval_backend: è¯„æµ‹åç«¯ï¼Œé»˜è®¤ä¸º'Native'ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸º'OpenCompass'æˆ–'VLMEvalKit'ã€‚
- ğŸ”¥eval_dataset: è¯„æµ‹æ•°æ®é›†ï¼Œè¯·æŸ¥çœ‹[è¯„æµ‹æ–‡æ¡£](./è¯„æµ‹.md)ã€‚
- eval_limit: æ¯ä¸ªè¯„æµ‹é›†çš„é‡‡æ ·æ•°ï¼Œé»˜è®¤ä¸ºNoneã€‚
- eval_output_dir: è¯„æµ‹å­˜å‚¨ç»“æœçš„æ–‡ä»¶å¤¹ï¼Œé»˜è®¤ä¸º'eval_output'ã€‚
- temperature: è¦†ç›–ç”Ÿæˆå‚æ•°ï¼Œé»˜è®¤ä¸º0ã€‚
- eval_num_proc: è¯„æµ‹æ—¶å®¢æˆ·ç«¯æœ€å¤§å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º16ã€‚
- eval_url: è¯„æµ‹urlï¼Œä¾‹å¦‚`http://localhost:8000/v1`ã€‚ä¾‹å­å¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/eval/eval_url)ã€‚é»˜è®¤ä¸ºNoneï¼Œé‡‡ç”¨æœ¬åœ°éƒ¨ç½²è¯„ä¼°ã€‚
- eval_generation_config: è¯„æµ‹æ—¶æ¨¡å‹æ¨ç†é…ç½®ï¼Œéœ€ä¼ å…¥jsonå­—ç¬¦ä¸²æ ¼å¼ï¼Œä¾‹å¦‚ï¼š`'{"max_new_tokens": 512}'`ï¼›é»˜è®¤ä¸ºNoneã€‚
- extra_eval_args: é¢å¤–è¯„æµ‹å‚æ•°ï¼Œéœ€ä¼ å…¥jsonå­—ç¬¦ä¸²æ ¼å¼ï¼Œé»˜è®¤ä¸ºç©ºã€‚ä»…å¯¹Nativeè¯„æµ‹æœ‰æ•ˆï¼Œæ›´å¤šå‚æ•°è¯´æ˜è¯·æŸ¥çœ‹[è¿™é‡Œ](https://evalscope.readthedocs.io/zh-cn/latest/get_started/parameters.html)
- local_dataset: éƒ¨åˆ†è¯„æµ‹é›†ï¼Œå¦‚`CMB`æ— æ³•ç›´æ¥è¿è¡Œï¼Œéœ€è¦ä¸‹è½½é¢å¤–æ•°æ®åŒ…æ‰å¯ä»¥ä½¿ç”¨ã€‚è®¾ç½®æœ¬å‚æ•°ä¸º`true`å¯ä»¥è‡ªåŠ¨ä¸‹è½½å…¨é‡æ•°æ®åŒ…ï¼Œå¹¶åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»º`data`æ–‡ä»¶å¤¹å¹¶å¼€å§‹è¯„æµ‹ã€‚æ•°æ®åŒ…ä»…ä¼šä¸‹è½½ä¸€æ¬¡ï¼Œåç»­ä¼šä½¿ç”¨ç¼“å­˜ã€‚è¯¥å‚æ•°é»˜è®¤ä¸º`false`ã€‚
  - æ³¨æ„ï¼šé»˜è®¤è¯„æµ‹ä¼šä½¿ç”¨`~/.cache/opencompass`ä¸‹çš„æ•°æ®é›†ï¼Œåœ¨æŒ‡å®šæœ¬å‚æ•°åä¼šç›´æ¥ä½¿ç”¨å½“å‰ç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹ã€‚

### å¯¼å‡ºå‚æ•°

å¯¼å‡ºå‚æ•°é™¤åŒ…å«[åŸºæœ¬å‚æ•°](#åŸºæœ¬å‚æ•°)å’Œ[åˆå¹¶å‚æ•°](#åˆå¹¶å‚æ•°)å¤–ï¼Œè¿˜åŒ…å«ä¸‹é¢çš„éƒ¨åˆ†:

- ğŸ”¥output_dir: å¯¼å‡ºç»“æœå­˜å‚¨è·¯å¾„ã€‚é»˜è®¤ä¸ºNoneï¼Œä¼šè‡ªåŠ¨è®¾ç½®åˆé€‚åç¼€çš„è·¯å¾„ã€‚
- exist_ok: å¦‚æœoutput_dirå­˜åœ¨ï¼Œä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè¿›è¡Œè¦†ç›–ã€‚é»˜è®¤ä¸ºFalseã€‚
- ğŸ”¥quant_method: å¯é€‰ä¸º'gptq'ã€'awq'ã€'bnb'å’Œ'fp8'ï¼Œé»˜è®¤ä¸ºNoneã€‚ä¾‹å­å‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/export/quantize)ã€‚
- quant_n_samples: gptq/awqçš„æ ¡éªŒé›†é‡‡æ ·æ•°ï¼Œé»˜è®¤ä¸º256ã€‚
- max_length: æ ¡å‡†é›†çš„max_length, é»˜è®¤å€¼2048ã€‚
- quant_batch_size: é‡åŒ–batch_sizeï¼Œé»˜è®¤ä¸º1ã€‚
- group_size: é‡åŒ–groupå¤§å°ï¼Œé»˜è®¤ä¸º128ã€‚
- to_cached_dataset: æå‰å¯¹æ•°æ®é›†è¿›è¡Œtokenizeå¹¶å¯¼å‡ºï¼Œé»˜è®¤ä¸ºFalseã€‚ä¾‹å­å‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/tree/main/examples/export/cached_dataset)ã€‚
  - æ³¨æ„ï¼šæ•°æ®packingåœ¨è®­ç»ƒæ—¶è¿›è¡Œï¼Œè€Œä¸åœ¨æ­¤å¤„ã€‚
- to_ollama: äº§ç”Ÿollamaæ‰€éœ€çš„Modelfileæ–‡ä»¶ã€‚é»˜è®¤ä¸ºFalseã€‚
- ğŸ”¥to_mcore: HFæ ¼å¼æƒé‡è½¬æˆMegatronæ ¼å¼ã€‚é»˜è®¤ä¸ºFalseã€‚
- to_hf: Megatronæ ¼å¼æƒé‡è½¬æˆHFæ ¼å¼ã€‚é»˜è®¤ä¸ºFalseã€‚
- mcore_model: mcoreæ ¼å¼æ¨¡å‹è·¯å¾„ã€‚é»˜è®¤ä¸ºNoneã€‚
- mcore_adapters: mcoreæ ¼å¼æ¨¡å‹çš„adapterè·¯å¾„åˆ—è¡¨ï¼Œé»˜è®¤ä¸ºç©ºåˆ—è¡¨ã€‚
- thread_count: `--to_mcore true`æ—¶çš„æ¨¡å‹åˆ‡ç‰‡æ•°ã€‚é»˜è®¤ä¸ºNoneï¼Œæ ¹æ®æ¨¡å‹å¤§å°è‡ªåŠ¨è®¾ç½®ï¼Œä½¿å¾—æœ€å¤§åˆ†ç‰‡å°äº10GBã€‚
- ğŸ”¥test_convert_precision: æµ‹è¯•HFå’ŒMegatronæ ¼å¼æƒé‡è½¬æ¢çš„ç²¾åº¦è¯¯å·®ã€‚é»˜è®¤ä¸ºFalseã€‚
- ğŸ”¥push_to_hub: æ˜¯å¦æ¨é€hubï¼Œé»˜è®¤ä¸ºFalseã€‚ä¾‹å­å‚è€ƒ[è¿™é‡Œ](https://github.com/modelscope/ms-swift/blob/main/examples/export/push_to_hub.sh)ã€‚
- hub_model_id: æ¨é€çš„model_idï¼Œé»˜è®¤ä¸ºNoneã€‚
- hub_private_repo: æ˜¯å¦æ˜¯private repoï¼Œé»˜è®¤ä¸ºFalseã€‚
- commit_message: æäº¤ä¿¡æ¯ï¼Œé»˜è®¤ä¸º'update files'ã€‚

### é‡‡æ ·å‚æ•°

- prm_model: è¿‡ç¨‹å¥–åŠ±æ¨¡å‹çš„ç±»å‹ï¼Œå¯ä»¥æ˜¯æ¨¡å‹idï¼ˆä»¥ptæ–¹å¼æ‹‰èµ·ï¼‰ï¼Œæˆ–è€…pluginä¸­å®šä¹‰çš„prm keyï¼ˆè‡ªå®šä¹‰æ¨ç†è¿‡ç¨‹ï¼‰ã€‚
- orm_model: ç»“æœå¥–åŠ±æ¨¡å‹çš„ç±»å‹ï¼Œé€šå¸¸æ˜¯é€šé…ç¬¦æˆ–æµ‹è¯•ç”¨ä¾‹ç­‰ï¼Œä¸€èˆ¬å®šä¹‰åœ¨pluginä¸­ã€‚
- sampler_typeï¼šé‡‡æ ·ç±»å‹ï¼Œç›®å‰æ”¯æŒ sample, mctsï¼Œæœªæ¥ä¼šæ”¯æŒ dvtsã€‚
- sampler_engineï¼šæ”¯æŒ`pt`, `lmdeploy`, `vllm`, `client`, `no`ï¼Œé»˜è®¤ä¸º`pt`ï¼Œé‡‡æ ·æ¨¡å‹çš„æ¨ç†å¼•æ“ã€‚
- output_dirï¼šè¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä¸º`sample_output`ã€‚
- output_fileï¼šè¾“å‡ºæ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º`None`ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºæ–‡ä»¶åã€‚ä¼ å…¥æ—¶ä¸éœ€è¦ä¼ å…¥ç›®å½•ï¼Œä»…æ”¯æŒjsonlæ ¼å¼ã€‚
- override_exist_fileï¼šå¦‚`output_file`å­˜åœ¨ï¼Œæ˜¯å¦è¦†ç›–ã€‚
- num_sampling_per_gpu_batch_sizeï¼šæ¯æ¬¡é‡‡æ ·çš„batch_sizeã€‚
- num_sampling_per_gpu_batchesï¼šå…±é‡‡æ ·å¤šå°‘batchã€‚
- n_best_to_keepï¼šè¿”å›å¤šå°‘æœ€ä½³sequencesã€‚
- data_rangeï¼šæœ¬é‡‡æ ·å¤„ç†æ•°æ®é›†çš„åˆ†ç‰‡ã€‚ä¼ å…¥æ ¼å¼ä¸º`2 3`ï¼Œä»£è¡¨æ•°æ®é›†åˆ†ä¸º3ä»½å¤„ç†ï¼ˆè¿™æ„å‘³ç€é€šå¸¸æœ‰ä¸‰ä¸ª`swift sample`åœ¨å¹¶è¡Œå¤„ç†ï¼‰ï¼Œæœ¬å®ä¾‹æ­£åœ¨å¤„ç†ç¬¬3ä¸ªåˆ†ç‰‡ã€‚
- temperatureï¼šåœ¨è¿™é‡Œé»˜è®¤ä¸º1.0ã€‚
- prm_thresholdï¼šPRMé˜ˆå€¼ï¼Œä½äºè¯¥é˜ˆå€¼çš„ç»“æœä¼šè¢«è¿‡æ»¤æ‰ï¼Œé»˜è®¤å€¼ä¸º`0`ã€‚
- easy_query_thresholdï¼šå•ä¸ªqueryçš„æ‰€æœ‰é‡‡æ ·ä¸­ï¼ŒORMè¯„ä¼°å¦‚æœæ­£ç¡®ï¼Œå¤§äºè¯¥æ¯”ä¾‹çš„queryä¼šè¢«ä¸¢å¼ƒï¼Œé˜²æ­¢è¿‡äºç®€å•çš„queryå‡ºç°åœ¨ç»“æœä¸­ï¼Œé»˜è®¤ä¸º`None`ï¼Œä»£è¡¨ä¸è¿‡æ»¤ã€‚
- engine_kwargsï¼šä¼ å…¥sampler_engineçš„é¢å¤–å‚æ•°ï¼Œä»¥json stringä¼ å…¥ï¼Œä¾‹å¦‚`{"cache_max_entry_count":0.7}`ã€‚
- num_return_sequencesï¼šé‡‡æ ·è¿”å›çš„åŸå§‹sequenceæ•°é‡ã€‚é»˜è®¤ä¸º64ï¼Œæœ¬å‚æ•°å¯¹`sample`é‡‡æ ·æœ‰æ•ˆã€‚
- cache_filesï¼šä¸ºé¿å…åŒæ—¶åŠ è½½prmå’Œgeneratoré€ æˆæ˜¾å­˜OOMï¼Œå¯ä»¥åˆ†ä¸¤æ­¥è¿›è¡Œé‡‡æ ·ï¼Œç¬¬ä¸€æ­¥å°†prmå’Œormç½®ä¸º`None`ï¼Œåˆ™æ‰€æœ‰ç»“æœéƒ½ä¼šè¾“å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œç¬¬äºŒæ¬¡è¿è¡Œé‡‡æ ·å°†sampler_engineç½®ä¸º`no`å¹¶ä¼ å…¥`--cache_files`ä¸ºä¸Šæ¬¡é‡‡æ ·çš„è¾“å‡ºæ–‡ä»¶ï¼Œåˆ™ä¼šä½¿ç”¨ä¸Šæ¬¡è¾“å‡ºçš„ç»“æœè¿›è¡Œprmå’Œormè¯„ä¼°å¹¶è¾“å‡ºæœ€ç»ˆç»“æœã€‚
  - æ³¨æ„ï¼šä½¿ç”¨cache_filesæ—¶ï¼Œ`--dataset`ä»ç„¶éœ€è¦ä¼ å…¥ï¼Œè¿™æ˜¯å› ä¸ºcache_filesçš„idæ˜¯ç”±åŸå§‹æ•°æ®è®¡ç®—çš„md5ï¼Œéœ€è¦æŠŠä¸¤éƒ¨åˆ†ä¿¡æ¯ç»“åˆä½¿ç”¨ã€‚

#### MCTS
- rollout_depthï¼šrollout æ—¶çš„æœ€å¤§æ·±åº¦ï¼Œé»˜è®¤ä¸º `5`ã€‚
- rollout_start_depthï¼šå¼€å§‹ rollout æ—¶çš„æ·±åº¦ï¼Œä½äºæ­¤æ·±åº¦çš„èŠ‚ç‚¹åªä¼šè¿›è¡Œ expand æ“ä½œï¼Œé»˜è®¤ä¸º `3`ã€‚
- max_iterationsï¼šmcts çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé»˜è®¤ä¸º `100`ã€‚
- process_reward_rateï¼šselect ä¸­è®¡ç®— value æ—¶ process reward å çš„æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º `0.0`ï¼Œå³ä¸ä½¿ç”¨ PRMã€‚
- exploration_rateï¼šUCT ç®—æ³•ä¸­çš„æ¢ç´¢å‚æ•°ï¼Œå€¼è¶Šå¤§è¶Šç…§é¡¾æ¢ç´¢æ¬¡æ•°è¾ƒå°çš„èŠ‚ç‚¹ï¼Œé»˜è®¤ä¸º `0.5`ã€‚
- api_keyï¼šä½¿ç”¨ client ä½œä¸ºæ¨ç†å¼•æ“æ—¶éœ€è¦ï¼Œé»˜è®¤ä¸º `EMPTY`ã€‚
- base_urlï¼šä½¿ç”¨ client ä½œä¸ºæ¨ç†å¼•æ“æ—¶éœ€è¦ï¼Œé»˜è®¤ä¸º 'https://dashscope.aliyuncs.com/compatible-mode/v1'


## ç‰¹å®šæ¨¡å‹å‚æ•°
é™¤äº†ä»¥ä¸Šå‚æ•°å¤–ï¼Œæœ‰äº›æ¨¡å‹è¿˜æ”¯æŒé¢å¤–çš„å…·ä½“æ¨¡å‹å‚æ•°ã€‚è¿™äº›å‚æ•°å«ä¹‰é€šå¸¸å¯ä»¥åœ¨å¯¹åº”æ¨¡å‹å®˜æ–¹repoæˆ–è€…å…¶æ¨ç†ä»£ç ä¸­æ‰¾åˆ°ç›¸åº”å«ä¹‰ã€‚**ms-swiftå¼•å…¥è¿™äº›å‚æ•°ä»¥ç¡®ä¿è®­ç»ƒçš„æ¨¡å‹ä¸å®˜æ–¹æ¨ç†ä»£ç æ•ˆæœå¯¹é½**ã€‚
- ç‰¹å®šæ¨¡å‹å‚æ•°å¯ä»¥é€šè¿‡`--model_kwargs`æˆ–è€…ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œä¾‹å¦‚: `--model_kwargs '{"fps_max_frames": 12}'`æˆ–è€…`FPS_MAX_FRAMES=12`ã€‚
- æ³¨æ„ï¼šè‹¥ä½ åœ¨è®­ç»ƒæ—¶æŒ‡å®šäº†ç‰¹å®šæ¨¡å‹å‚æ•°ï¼Œè¯·åœ¨æ¨ç†æ—¶ä¹Ÿè®¾ç½®å¯¹åº”çš„å‚æ•°ï¼Œè¿™å¯ä»¥æé«˜è®­ç»ƒæ•ˆæœã€‚

### qwen2_vl, qvq, qwen2_5_vl, mimo_vl, keye_vl, keye_vl_1_5
å‚æ•°å«ä¹‰ä¸`qwen_vl_utils<0.0.12`æˆ–è€…`qwen_omni_utils`åº“ä¸­å«ä¹‰ä¸€è‡´ï¼Œå¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://github.com/QwenLM/Qwen2.5-VL/blob/main/qwen-vl-utils/src/qwen_vl_utils/vision_process.py#L24)ã€‚ms-swifté€šè¿‡ä¿®æ”¹è¿™äº›å¸¸æ•°å€¼æ¥æ§åˆ¶å›¾ç‰‡åˆ†è¾¨ç‡å’Œè§†é¢‘å¸§ç‡ï¼Œé¿å…è®­ç»ƒæ—¶OOMã€‚

- IMAGE_FACTOR: é»˜è®¤ä¸º28ã€‚
- MIN_PIXELS: é»˜è®¤ä¸º`4 * 28 * 28`ã€‚å›¾åƒçš„æœ€å°åˆ†è¾¨ç‡ã€‚å»ºè®®è®¾ç½®ä¸º28*28çš„å€æ•°ã€‚
- ğŸ”¥MAX_PIXELS: é»˜è®¤ä¸º`16384 * 28 * 28`ã€‚å›¾åƒçš„æœ€å¤§åˆ†è¾¨ç‡ã€‚å»ºè®®è®¾ç½®ä¸º28*28çš„å€æ•°ã€‚
- MAX_RATIO: é»˜è®¤ä¸º200ã€‚
- VIDEO_MIN_PIXELS: é»˜è®¤ä¸º`128 * 28 * 28`ã€‚è§†é¢‘ä¸­ä¸€å¸§çš„æœ€å°åˆ†è¾¨ç‡ã€‚å»ºè®®è®¾ç½®ä¸º28*28çš„å€æ•°ã€‚
- ğŸ”¥VIDEO_MAX_PIXELS: é»˜è®¤ä¸º`768 * 28 * 28`ã€‚è§†é¢‘ä¸­ä¸€å¸§çš„æœ€å¤§åˆ†è¾¨ç‡ã€‚å»ºè®®è®¾ç½®ä¸º28*28çš„å€æ•°ã€‚
- VIDEO_TOTAL_PIXELS: é»˜è®¤ä¸º`24576 * 28 * 28`ã€‚
- FRAME_FACTOR: é»˜è®¤ä¸º2ã€‚
- FPS: é»˜è®¤ä¸º2.0ã€‚
- FPS_MIN_FRAMES: é»˜è®¤ä¸º4ã€‚ä¸€æ®µè§†é¢‘çš„æœ€å°æŠ½å¸§æ•°ã€‚
- ğŸ”¥FPS_MAX_FRAMES: é»˜è®¤ä¸º768ã€‚ä¸€æ®µè§†é¢‘çš„æœ€å¤§æŠ½å¸§æ•°ã€‚
- ğŸ”¥QWENVL_BBOX_FORMAT: (ms-swift>=3.9.1) groundingæ ¼å¼ä½¿ç”¨'legacy'è¿˜æ˜¯'new'ã€‚'legacy'æ ¼å¼ä¸ºï¼š`<|object_ref_start|>ä¸€åªç‹—<|object_ref_end|><|box_start|>(432,991),(1111,2077)<|box_end|>`ï¼Œ'new'æ ¼å¼å‚è€ƒï¼š[Qwen3-VL cookbook](https://github.com/QwenLM/Qwen3-VL/blob/main/cookbooks/2d_grounding.ipynb)ï¼Œå¹¶å‚è€ƒ[groundingæ•°æ®é›†æ ¼å¼æ–‡æ¡£](../Customization/è‡ªå®šä¹‰æ•°æ®é›†.md#grounding)ã€‚é»˜è®¤ä¸º'legacy'ã€‚
  - æ³¨æ„ï¼šè¯¥ç¯å¢ƒå˜é‡é€‚é…Qwen2/2.5/3-VLå’ŒQwen2.5/3-Omniç³»åˆ—æ¨¡å‹ã€‚

### qwen2_audio
- SAMPLING_RATE: é»˜è®¤ä¸º16000ã€‚

### qwen2_5_omni, qwen3_omni
qwen2_5_omnié™¤äº†åŒ…å«qwen2_5_vlå’Œqwen2_audioçš„æ¨¡å‹ç‰¹å®šå‚æ•°å¤–ï¼Œè¿˜åŒ…å«ä»¥ä¸‹å‚æ•°ï¼š
- USE_AUDIO_IN_VIDEO: é»˜è®¤ä¸ºFalseã€‚æ˜¯å¦ä½¿ç”¨videoä¸­çš„éŸ³é¢‘ä¿¡æ¯ã€‚
- ğŸ”¥ENABLE_AUDIO_OUTPUT: é»˜è®¤ä¸ºNoneï¼Œå³ä½¿ç”¨`config.json`ä¸­çš„å€¼ã€‚è‹¥ä½¿ç”¨zero3è¿›è¡Œè®­ç»ƒï¼Œè¯·è®¾ç½®ä¸ºFalseã€‚
  - æç¤ºï¼šms-swiftåªå¯¹thinkeréƒ¨åˆ†è¿›è¡Œå¾®è°ƒï¼Œå»ºè®®è®¾ç½®ä¸ºFalseä»¥é™ä½æ˜¾å­˜å ç”¨ï¼ˆåªåˆ›å»ºthinkeréƒ¨åˆ†çš„æ¨¡å‹ç»“æ„ï¼‰ã€‚

### qwen3_vl
å‚æ•°å«ä¹‰ä¸`qwen_vl_utils>=0.0.14`åº“ä¸­çš„å«ä¹‰ä¸€è‡´ï¼Œå¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://github.com/QwenLM/Qwen2.5-VL/blob/main/qwen-vl-utils/src/qwen_vl_utils/vision_process.py#L24)ã€‚é€šè¿‡ä¼ å…¥ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¿®æ”¹è¯¥åº“çš„å…¨å±€å˜é‡é»˜è®¤å€¼ã€‚

- SPATIAL_MERGE_SIZE: é»˜è®¤ä¸º2ã€‚
- IMAGE_MIN_TOKEN_NUM: é»˜è®¤ä¸º`4`ï¼Œä»£è¡¨ä¸€å¼ å›¾ç‰‡æœ€å°å›¾åƒtokensçš„ä¸ªæ•°ã€‚
- ğŸ”¥IMAGE_MAX_TOKEN_NUM: é»˜è®¤ä¸º`16384`ï¼Œä»£è¡¨ä¸€å¼ å›¾ç‰‡æœ€å¤§å›¾åƒtokensçš„ä¸ªæ•°ã€‚ï¼ˆç”¨äºé¿å…OOMï¼‰
- VIDEO_MIN_TOKEN_NUM: é»˜è®¤ä¸º`128`ï¼Œä»£è¡¨è§†é¢‘ä¸­ä¸€å¸§çš„æœ€å°è§†é¢‘tokensçš„ä¸ªæ•°ã€‚
- ğŸ”¥VIDEO_MAX_TOKEN_NUM: é»˜è®¤ä¸º`768`ï¼Œä»£è¡¨è§†é¢‘ä¸­ä¸€å¸§çš„æœ€å¤§è§†é¢‘tokensçš„ä¸ªæ•°ã€‚ï¼ˆç”¨äºé¿å…OOMï¼‰
- MAX_RATIO: é»˜è®¤ä¸º200ã€‚
- FRAME_FACTOR: é»˜è®¤ä¸º2ã€‚
- FPS: é»˜è®¤ä¸º2.0ã€‚
- FPS_MIN_FRAMES: é»˜è®¤ä¸º4ã€‚ä»£è¡¨ä¸€æ®µè§†é¢‘çš„æœ€å°æŠ½å¸§æ•°ã€‚
- ğŸ”¥FPS_MAX_FRAMES: é»˜è®¤ä¸º768ï¼Œä»£è¡¨ä¸€æ®µè§†é¢‘çš„æœ€å¤§æŠ½å¸§æ•°ã€‚ï¼ˆç”¨äºé¿å…OOMï¼‰

### internvl, internvl_phi3
å‚æ•°å«ä¹‰å¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://modelscope.cn/models/OpenGVLab/Mini-InternVL-Chat-2B-V1-5)ã€‚
- MAX_NUM: é»˜è®¤ä¸º12ã€‚
- INPUT_SIZE: é»˜è®¤ä¸º448ã€‚

### internvl2, internvl2_phi3, internvl2_5, internvl3, internvl3_5
å‚æ•°å«ä¹‰å¯ä»¥æŸ¥çœ‹[è¿™é‡Œ](https://modelscope.cn/models/OpenGVLab/InternVL2_5-2B)ã€‚
- MAX_NUM: é»˜è®¤ä¸º12ã€‚
- INPUT_SIZE: é»˜è®¤ä¸º448ã€‚
- VIDEO_MAX_NUM: é»˜è®¤ä¸º1ã€‚è§†é¢‘çš„MAX_NUMã€‚
- VIDEO_SEGMENTS: é»˜è®¤ä¸º8ã€‚


### minicpmv2_6, minicpmo2_6, minicpmv4
- MAX_SLICE_NUMS: é»˜è®¤ä¸º9ï¼Œå‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/models/OpenBMB/MiniCPM-V-2_6/file/view/master?fileName=config.json&status=1)ã€‚
- VIDEO_MAX_SLICE_NUMS: é»˜è®¤ä¸º1ï¼Œè§†é¢‘çš„MAX_SLICE_NUMSï¼Œå‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/models/OpenBMB/MiniCPM-V-2_6)ã€‚
- MAX_NUM_FRAMES: é»˜è®¤ä¸º64ï¼Œå‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/models/OpenBMB/MiniCPM-V-2_6)ã€‚

### minicpmo2_6
- INIT_TTS: é»˜è®¤ä¸ºFalseã€‚
- INIT_AUDIO: é»˜è®¤ä¸ºFalseã€‚

### ovis1_6, ovis2
- MAX_PARTITION: é»˜è®¤ä¸º9ï¼Œå‚è€ƒ[è¿™é‡Œ](https://github.com/AIDC-AI/Ovis/blob/d248e34d755a95d24315c40e2489750a869c5dbc/ovis/model/modeling_ovis.py#L312)ã€‚

### ovis2_5
ä»¥ä¸‹å‚æ•°å«ä¹‰å¯ä»¥åœ¨[è¿™é‡Œ](https://modelscope.cn/models/AIDC-AI/Ovis2.5-2B)çš„ç¤ºä¾‹ä»£ç ä¸­æ‰¾åˆ°ã€‚
- MIX_PIXELS: intç±»å‹ï¼Œé»˜è®¤ä¸º`448 * 448`ã€‚
- MAX_PIXELS: intç±»å‹ï¼Œé»˜è®¤ä¸º`1344 * 1792`ã€‚è‹¥å‡ºç°OOMï¼Œå¯ä»¥è°ƒå°è¯¥å€¼ã€‚
- VIDEO_MAX_PIXELS: intç±»å‹ï¼Œé»˜è®¤ä¸º`896 * 896`ã€‚
- NUM_FRAMES: é»˜è®¤ä¸º8ã€‚ç”¨äºè§†é¢‘æŠ½å¸§ã€‚

### mplug_owl3, mplug_owl3_241101
- MAX_NUM_FRAMES: é»˜è®¤ä¸º16ï¼Œå‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/models/iic/mPLUG-Owl3-7B-240728)ã€‚

### xcomposer2_4khd
- HD_NUM: é»˜è®¤ä¸º55ï¼Œå‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/models/Shanghai_AI_Laboratory/internlm-xcomposer2-4khd-7b)ã€‚

### xcomposer2_5
- HD_NUM: å›¾ç‰‡æ•°é‡ä¸º1æ—¶ï¼Œé»˜è®¤å€¼ä¸º24ã€‚å¤§äº1ï¼Œé»˜è®¤ä¸º6ã€‚å‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/models/AI-ModelScope/internlm-xcomposer2d5-7b/file/view/master?fileName=modeling_internlm_xcomposer2.py&status=1#L254)ã€‚

### video_cogvlm2
- NUM_FRAMES: é»˜è®¤ä¸º24ï¼Œå‚è€ƒ[è¿™é‡Œ](https://github.com/zai-org/CogVLM2/blob/main/video_demo/inference.py#L22)ã€‚

### phi3_vision
- NUM_CROPS: é»˜è®¤ä¸º4ï¼Œå‚è€ƒ[è¿™é‡Œ](https://modelscope.cn/models/LLM-Research/Phi-3.5-vision-instruct)ã€‚

### llama3_1_omni
- N_MELS: é»˜è®¤ä¸º128ï¼Œå‚è€ƒ[è¿™é‡Œ](https://github.com/ictnlp/LLaMA-Omni/blob/544d0ff3de8817fdcbc5192941a11cf4a72cbf2b/omni_speech/infer/infer.py#L57)ã€‚

### video_llava
- NUM_FRAMES: é»˜è®¤ä¸º16ã€‚


## å…¶ä»–ç¯å¢ƒå˜é‡
- CUDA_VISIBLE_DEVICES: æ§åˆ¶ä½¿ç”¨å“ªäº›GPUå¡ã€‚é»˜è®¤ä½¿ç”¨æ‰€æœ‰å¡ã€‚
- ASCEND_RT_VISIBLE_DEVICES: æ§åˆ¶ä½¿ç”¨å“ªäº›NPUå¡ï¼ˆåªå¯¹ASCENDå¡ç”Ÿæ•ˆï¼‰ã€‚é»˜è®¤ä½¿ç”¨æ‰€æœ‰å¡ã€‚
- MODELSCOPE_CACHE: æ§åˆ¶ç¼“å­˜è·¯å¾„ã€‚ï¼ˆå¤šæœºè®­ç»ƒæ—¶å»ºè®®è®¾ç½®è¯¥å€¼ï¼Œä»¥ç¡®ä¿ä¸åŒèŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„æ•°æ®é›†ç¼“å­˜ï¼‰
- PYTORCH_CUDA_ALLOC_CONF: æ¨èè®¾ç½®ä¸º`'expandable_segments:True'`ï¼Œè¿™å°†å‡å°‘GPUå†…å­˜ç¢ç‰‡ï¼Œå…·ä½“è¯·å‚è€ƒ[torchæ–‡æ¡£](https://docs.pytorch.org/docs/stable/notes/cuda.html#cuda-memory-management)ã€‚
- NPROC_PER_NODE: torchrunä¸­`--nproc_per_node`çš„å‚æ•°é€ä¼ ã€‚é»˜è®¤ä¸º1ã€‚è‹¥è®¾ç½®äº†`NPROC_PER_NODE`æˆ–è€…`NNODES`ç¯å¢ƒå˜é‡ï¼Œåˆ™ä½¿ç”¨torchrunå¯åŠ¨è®­ç»ƒæˆ–æ¨ç†ã€‚
- MASTER_PORT: torchrunä¸­`--master_port`çš„å‚æ•°é€ä¼ ã€‚é»˜è®¤ä¸º29500ã€‚
- MASTER_ADDR: torchrunä¸­`--master_addr`çš„å‚æ•°é€ä¼ ã€‚
- NNODES: torchrunä¸­`--nnodes`çš„å‚æ•°é€ä¼ ã€‚
- NODE_RANK: torchrunä¸­`--node_rank`çš„å‚æ•°é€ä¼ ã€‚
- LOG_LEVEL: æ—¥å¿—çš„levelï¼Œé»˜è®¤ä¸º'INFO'ï¼Œä½ å¯ä»¥è®¾ç½®ä¸º'WARNING', 'ERROR'ç­‰ã€‚
- SWIFT_DEBUG: åœ¨`engine.infer(...)`æ—¶ï¼Œè‹¥è®¾ç½®ä¸º'1'ï¼ŒPtEngineå°†ä¼šæ‰“å°input_idså’Œgenerate_idsçš„å†…å®¹æ–¹ä¾¿è¿›è¡Œè°ƒè¯•ä¸å¯¹é½ã€‚
- VLLM_USE_V1: ç”¨äºåˆ‡æ¢vLLMä½¿ç”¨V0/V1ç‰ˆæœ¬ã€‚
- SWIFT_TIMEOUT: (ms-swift>=3.10) è‹¥å¤šæ¨¡æ€æ•°æ®é›†ä¸­å­˜åœ¨å›¾åƒURLï¼Œè¯¥å‚æ•°ç”¨äºæ§åˆ¶è·å–å›¾ç‰‡çš„timeoutï¼Œé»˜è®¤ä¸º20sã€‚
- ROOT_IMAGE_DIR: (ms-swift>=3.8) å›¾åƒï¼ˆå¤šæ¨¡æ€ï¼‰èµ„æºçš„æ ¹ç›®å½•ã€‚é€šè¿‡è®¾ç½®è¯¥å‚æ•°ï¼Œå¯ä»¥åœ¨æ•°æ®é›†ä¸­ä½¿ç”¨ç›¸å¯¹äº `ROOT_IMAGE_DIR` çš„ç›¸å¯¹è·¯å¾„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¯ç›¸å¯¹äºè¿è¡Œç›®å½•çš„ç›¸å¯¹è·¯å¾„ã€‚
